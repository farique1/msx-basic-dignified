10 ' Converted with MSX Basic Dignified
20 ' https://github.com/farique1/msx-basic-dignified
30 '
40 ' CHANGE GRAPH KIT
50 ' v1.6.2
60 ' Edit uncompressed graphics on MSX binary files on disk
70 '
80 ' Copyright (C) 1984-2020 - Fred Rique (farique)
90 ' https://github.com/farique1/Change-Graph-Kit
100 '
110 ' New 29-02-2020
120 ' 	Updated some labels to the new Loop Labels.
130 ' 	Updated some REMs to REM Blocks
140 ' 	Enclosed aux routines in Line Toggles
150 ' 	Converted graphics to unicode analogues and changed file format encoding to UTF-8
160 ' 	Fixed Bug saving drawing 1 byte lower
170 '
180 ' New
190 ' 	Fixed error lookup in machines with English language (or in MSX2?)
200 ' 	Improved error reporting routine to output to the new MSX Badig Build Monitor Execution
210 ' 	Improved ON STOP routine and added MSX Badig Build Monitor Execution reporting
220 ' 	Adjusted background and border colors on quit to 4 instead of 5
230 '
240 CLEAR 200,&HDA00
250 DEFINT A-Z:MAXFILES=2
260 ON STOP GOSUB 5690:STOP ON
270 ON ERROR GOTO 5570
280 DIM YL(36)
290 YK=0
300 YJ=-1
310 YI$=""
320 ZY=1:ZX=15:ZW=2:ZV=6:ZU=2:ZT=1
330 SCREEN 0:COLOR ZX,ZY,ZY:WIDTH 40:KEY OFF
340 LOCATE 14,11:PRINT "INITIALIZING"
350 DATA {*&}
360 LOCATE 14,13:PRINT " ERROR MSGS "
370 ' Using the time format in ROM to determine language
380 IF (PEEK(&H2B) AND 112)=32 THEN RESTORE 5920 ELSE RESTORE 5970
390 FOR F=1 TO 36:READ A:YL(F)=A:NEXT
400 LOCATE 14,13:PRINT "LOADING CONF"
410 GOSUB 2850
420 LOCATE 14,13:PRINT " ML SUPPORT "
430 YH=&HDA00
440 YK=3
450 BLOAD "CGKTools.com"
460 YG=0
470 RESTORE 6150
480 GOTO 550
490 ' {ml_fallback}
500 LOCATE 8,8:PRINT " CGKTools.bin not found"
510 LOCATE 8,9:PRINT "Using internal fall back"
520 RESTORE 6030
530 FOR F=0 TO 146:READ A$:LOCATE 18,15:PRINT 147-F:POKE YH+F,VAL("&h"+A$):NEXT:LOCATE 18,15:PRINT "   "
540 YG=-1
550 ' {ml_setup}
560 DEFUSR0=YH+&H08 ' invert_VRAM 		v0=len
570 DEFUSR1=YH+&H0B ' fill_VRAM 		v0-v1=len v2-v3=srt usr(ptrn)
580 DEFUSR2=YH+&H0E ' copy_VRAM 		v0-v1=VRAM v2=width v3=height usr(direc)
590 DEFUSR3=YH+&H11 ' populate_edit 	v0=col_len v1=lin_len
600 DEFUSR4=YH+&H14 ' flip_VRAM		 	v0=len
610 DEFUSR5=YH+&H17 ' rotate_VRAM	 	v0=len
620 DEFUSR6=YH+&H1A ' slide_VRAM	 	v0=len usr(direc)
630 DEF FN YF(X,Y,S)=(X+S+(Y*32)) MOD 256
640 DEF FN YE(X,Y,S)=INT((X+S+(Y*32))/256)
650 ' {start}
660 SCREEN 0:WIDTH 40
670 DEF FN ZZ(X)=ABS(X MOD 16+16) MOD 16
680 ZS=0:ZR=0:ZQ=0:ZP=0
690 YD$="" ' leave blank to enable file request
700 YC$=".bin" ' leave blank to all
710 IF YC$="" THEN YC$=".*"
720 IF YD$<>"" THEN GOTO 1470
730 ' {insert_disk}
740 CLS
750 YK=1
760 LOCATE 14,8:PRINT "Insert disk"
770 LOCATE 11,10:PRINT "and press any key"
780 IF NOT YJ THEN LOCATE 9,18:PRINT YI$
790 IF INKEY$=""THEN790
800 YJ=-1
810 YI$=""
820 CLS
830 FILES "*"+YC$
840 PRINT:PRINT
850 PRINT ":Load":PRINT ":ARROWS choose:ENTER select:SPACE type";
860 FOR F=0 TO 24
870 YB=0+40*F
880 IF CHR$(VPEEK(YB))=":" THEN YA=F-1
890 NEXT
900 X=12:Y=0
910 YB=X+40*Y
920 GOSUB 1170
930 ' {keys}
940 A$=INKEY$
950 LOCATE X,Y:PRINT "{"
960 LOCATE X,Y:PRINT "<"
970 IF A$="" THEN 930
980 LOCATE X,Y:PRINT " "
990 PX=X:PY=Y
1000 IF A$=CHR$(&H1C) THEN X=X+13:GOSUB 1090
1010 IF A$=CHR$(&H1D) THEN X=X-13:GOSUB 1090
1020 IF A$=CHR$(&H1E) THEN Y=Y-1:GOSUB 1090
1030 IF A$=CHR$(&H1F) THEN Y=Y+1:GOSUB 1090
1040 IF A$=CHR$(&H0D) THEN 1440
1050 IF A$=" " THEN 1390
1060 LOCATE X,Y:PRINT "<"
1070 GOSUB 1170
1080 GOTO 930
1090 ' {move_cursor_files}
1100 IF X>=39 THEN X=12
1110 IF X<=0 THEN X=38
1120 IF Y<=0 THEN Y=0
1130 IF Y>=24 THEN Y=24
1140 YB=X+40*Y
1150 IF VPEEK(YB-12)=32 THEN X=PX:Y=PY:YB=X+40*Y
1160 RETURN
1170 ' {show_content}
1180 XZ=0:YD$="":XY$=""
1190 LOCATE 6,YA:PRINT "            "
1200 FOR F=YB-12 TO YB-1
1210 XY$=CHR$(VPEEK(F))
1220 YD$=YD$+XY$
1230 LOCATE 6+XZ,YA:PRINT XY$
1240 XZ=XZ+1
1250 NEXT
1260 RETURN
1270 ' {game_small}
1280 CLS
1290 LOCATE 13,11:PRINT "Sorry"
1300 LOCATE 00,12:PRINT "The game must be over 800 bytes"
1310 LOCATE 05,13:PRINT "Press space to restart"
1320 IF INKEY$<>" "THEN1320
1330 SCREEN 0
1340 RETURN
1350 ' {createStrings}
1360 XX$="W":XW$="_"
1370 FOR F=0 TO 4:XX$=XX$+XX$:XW$=XW$+XW$:NEXT
1380 RETURN
1390 ' {type_name}
1400 YK=2
1410 LOCATE 6,YA:? "            "
1420 LOCATE 6,YA:LINE INPUT YD$
1430 IF YD$="" THEN GOSUB 1170:GOTO 930
1440 ' {continue}
1450 LOCATE 39,YA+1:PRINT
1460 FILES YD$
1470 ' {inicializacao}
1480 CLS:SCREEN 1:WIDTH 32
1490 POKE YH+0,&H20:POKE YH+1,&H03:POKE YH+2,&H00:POKE YH+3,&H04:A=USR1(0)
1500 VPOKE 6914,0:VPOKE 6918,1:VPOKE 6922,2:VPOKE 6926,3:VPOKE 6930,2
1510 LOCATE 10,11:PRINT "INITIALIZING"
1520 LOCATE 10,13:PRINT "    GAME    "
1530 OPEN YD$ AS #1 LEN=1
1540 FIELD #1,1 AS ZJ$
1550 GET #1,3:ZI$=ZJ$:GET #1,2:ZH$=ZJ$:ZG=(ASC(ZI$)*256+ASC(ZH$))-65535!
1560 GET #1,5:ZI$=ZJ$:GET #1,4:ZH$=ZJ$:ZF=(ASC(ZI$)*256+ASC(ZH$))-65535!
1570 ZD=ZF-ZG-1
1580 ZE=0:ZC=800:ZB=8:ZS=-1
1590 ZA=ZE:YZ=16:YY=23:YX=32
1600 IF ZD<800 THEN CLOSE:GOSUB 1270:GOTO 730
1610 LOCATE 10,13:PRINT "   SHAPES   "
1620 LOCATE 15,15:PRINT "06"
1630 FOR F=0 TO 23:READ A:VPOKE &H0008+F,A:NEXT:LOCATE 15,15:PRINT "05"
1640 FOR F=0 TO 7:READ A:VPOKE &H0080+F,A:NEXT:LOCATE 15,15:PRINT "04"
1650 FOR F=0 TO 7:READ A:VPOKE &H00F8+F,A:NEXT:LOCATE 15,15:PRINT "03"
1660 FOR F=0 TO 7:READ A:VPOKE &H0720+F,A:NEXT:LOCATE 15,15:PRINT "02"
1670 FOR F=0 TO 23:READ A:VPOKE &H0740+F,A:NEXT:LOCATE 15,15:PRINT "01"
1680 FOR F=0 TO 31:READ A:VPOKE &H3800+F,A:NEXT:LOCATE 15,15:PRINT "00"
1690 POKE YH+0,&H20:POKE YH+1,&H00:POKE YH+2,&H60:POKE YH+3,&H00:A=USR1(0)
1700 LOCATE 10,13:PRINT "   COLORS   "
1710 GOSUB 2680
1720 ' {search_screen}
1730 CLS
1740 LOCATE 00,0:PRINT "  CHANGE GRAPH KIT WW "+LEFT$(YD$,8)
1750 LOCATE 01,2:PRINT "XWWWWWWWWWWY"
1760 LOCATE 01,3:PRINT "VÄäîû®≤º∆–⁄V"
1770 LOCATE 01,4:PRINT "VÅãïü©≥Ω«—€V"
1780 LOCATE 01,5:PRINT "VÇåñ†™¥æ»“‹V"
1790 LOCATE 01,6:PRINT "VÉçó°´µø…”›V"
1800 LOCATE 01,7:PRINT "VÑéò¢¨∂¿ ‘ﬁV"
1810 LOCATE 01,8:PRINT "VÖèô£≠∑¡À’ﬂV"
1820 LOCATE 01,9:PRINT "VÜêö§Æ∏¬Ã÷‡V"
1830 LOCATE 1,10:PRINT "Váëõ•Øπ√Õ◊·V"
1840 LOCATE 1,11:PRINT "Vàíú¶∞∫ƒŒÿ‚V"
1850 LOCATE 1,12:PRINT "Vâìùß±ª≈œŸ„V"
1860 LOCATE 1,13:PRINT "ZWWWWWWWWWW["
1870 LOCATE 3,15:PRINT "Srt# End#"
1880 LOCATE 1,17:PRINT "C"
1890 LOCATE 3,17:PRINT STRING$(4-LEN(HEX$(ZA)),"0")+HEX$(ZA)
1900 LOCATE 8,17:PRINT STRING$(4-LEN(HEX$(ZA+( YX-1))),"0")+HEX$(ZA+( YX-1))
1910 LOCATE 1,19:PRINT "R"
1920 LOCATE 3,19:PRINT STRING$(4-LEN(HEX$(ZE)),"0")+HEX$(ZE)
1930 LOCATE 8,19:PRINT STRING$(4-LEN(HEX$(ZE+799)),"0")+HEX$(ZE+799)
1940 LOCATE 1,21:PRINT "G"
1950 LOCATE 3,21:PRINT STRING$(4-LEN(HEX$(0)),"0")+HEX$(0)
1960 LOCATE 8,21:PRINT STRING$(4-LEN(HEX$(ZD)),"0")+HEX$(ZD)
1970 LOCATE 13,2:PRINT "XWWWWWWWWWWWWWWWWY"
1980 LOCATE 13,3:PRINT "VCursor Stp #    V":LOCATE 29,3:PRINT RIGHT$(STR$(ZB),1)
1990 LOCATE 13,4:PRINT "VRegion Stp #    V":LOCATE 27,4:PRINT RIGHT$(HEX$(ZC),3)
2000 LOCATE 13,5:PRINT "ZWWWWWWWWWWWWWWWW["
2010 ' {keys_page_start}
2020 ON ZP GOTO 2110
2030 LOCATE 13,7:PRINT "VÍVMove VËVEdit   "
2040 LOCATE 13,9:PRINT "VÈVStep VDVSize   "
2050 LOCATE 13,11:PRINT "VBVClearVRVRefresh"
2060 LOCATE 13,13:PRINT "VTVScan und cursor "
2070 LOCATE 13,15:PRINT "VFVFreeze/Unfreeze"
2080 LOCATE 13,17:PRINT "VEVExplode/Ovrview"
2090 LOCATE 13,19:PRINT "                  "
2100 GOTO 2190
2110 ' {keys_page_2}
2120 LOCATE 13,7:PRINT "VNVNew  VPVExit  "
2130 LOCATE 13,9:PRINT "VQVPrev VWVNext   "
2140 LOCATE 13,11:PRINT "VAVP 4x VSVN 4x   "
2150 LOCATE 13,13:PRINT "VZVSrtVXVMidVCVEnd"
2160 LOCATE 13,15:PRINT "VK LVCfg Save Load"
2170 LOCATE 13,17:PRINT "V1-8VChange Colors"
2180 LOCATE 13,19:PRINT "                  "
2190 ' {keys_page_end}
2200 LOCATE 13,19:PRINT "      VMVMore Keys"
2210 LOCATE 13,21:PRINT "ABBBBBBBBBBBBBBBBC"
2220 GOSUB 3370
2230 IF ZR=-1 THEN LOCATE 2,13:PRINT "WOverviewW"
2240 XV=YY+(YX-2):XU=0
2250 IF YY+(YX-2)>101 THEN XU=8:XV=23+(YY+(YX-2))-103
2260 IF YZ+XU>95 THEN XV=200
2270 VPOKE 6912,YY-1:VPOKE 6913,YZ
2280 VPOKE 6916,XV+1:VPOKE 6917,XU+YZ
2290 XT=ZE/(ZD/141)+105
2300 VPOKE 6920,167:VPOKE 6921,XT
2310 VPOKE 6928,167:VPOKE 6929,XT+(141/(ZD/800))
2320 IF ZQ THEN ZQ=0:GOSUB 3150
2330 ' {read_keyboard_main}
2340 A$=INKEY$
2350 IF A$=CHR$(&H1C) AND (YZ+8<95) AND (ZA+YX-2+80<ZD) THEN YZ=YZ+8:ZA=ZA+80:GOSUB 2970
2360 IF A$=CHR$(&H1D) AND (YZ-8>15) THEN YZ=YZ-8:ZA=ZA-80:GOSUB 2970
2370 IF A$=CHR$(&H1E) AND (YY-ZB>22) THEN YY=YY-ZB:ZA=ZA-ZB:GOSUB 2970
2380 IF A$=CHR$(&H1F) AND (YY+ZB<103) AND (ZA+YX-2+ZB<ZD) THEN YY=YY+ZB:ZA=ZA+ZB:GOSUB 2970
2390 IF A$="1" THEN ZY=ZY-1:GOSUB 2680
2400 IF A$="2" THEN ZY=ZY+1:GOSUB 2680
2410 IF A$="3" THEN ZX=ZX-1:GOSUB 2680
2420 IF A$="4" THEN ZX=ZX+1:GOSUB 2680
2430 IF A$="5" THEN ZW=ZW-1:GOSUB 2680
2440 IF A$="6" THEN ZW=ZW+1:GOSUB 2680
2450 IF A$="7" THEN ZV=ZV-1:GOSUB 2680
2460 IF A$="8" THEN ZV=ZV+1:GOSUB 2680
2470 IF A$=CHR$(&H0D) THEN GOTO 3460
2480 IF A$="E" THEN GOTO 4620
2490 IF A$="D" THEN GOSUB 3060
2500 IF A$=" " THEN GOSUB 3410
2510 IF A$="R" THEN XS=0:GOSUB 3290
2520 IF A$="M" THEN ZP=ABS(ZP-1):GOTO 2010
2530 IF A$="B" THEN POKE YH+0,&H20:POKE YH+1,&H03:POKE YH+2,&H00:POKE YH+3,&H04:A=USR1(0)
2540 IF A$="N" THEN GOSUB 5410:CLOSE:RESTORE 6150:GOTO 650
2550 IF A$="P" THEN GOSUB 5410:CLOSE:CLEAR:SCREEN 0:WIDTH 40:COLOR 15,4,4:NEW
2560 IF A$="K" THEN GOSUB 2740
2570 IF A$="T" THEN GOSUB 2920
2580 IF A$="L" THEN GOSUB 2850:GOSUB 2680
2590 IF A$="Q" THEN XS=ZA-ZE:ZE=(ZE-ZC):GOSUB 3150
2600 IF A$="W" THEN XS=ZA-ZE:ZE=ZE+ZC:GOSUB 3150
2610 IF A$="A" THEN XS=ZA-ZE:ZE=ZE-ZC*4:GOSUB 3150
2620 IF A$="S" THEN XS=ZA-ZE:ZE=ZE+ZC*4:GOSUB 3150
2630 IF A$="Z" THEN XS=ZA-ZE:ZE=&H00:GOSUB 3150
2640 IF A$="X" THEN XS=ZA-ZE:ZE=(ZD/2)-400:GOSUB 3150
2650 IF A$="C" THEN XS=ZA-ZE:ZE=ZD-799:GOSUB 3150
2660 IF A$="F" THEN XS=0:ZS=NOT ZS:IF ZS THEN GOSUB 3370:ELSE:GOSUB 3290
2670 GOTO 2330
2680 ' {set_color}
2690 ZY=FN ZZ(ZY):ZX=FN ZZ(ZX):ZW=FN ZZ(ZW):ZV=FN ZZ(ZV):ZU=FN ZZ(ZU):ZT=FN ZZ(ZT)
2700 COLOR ZX,ZY,ZY
2710 VPOKE 8194,ZV*16+ZY:VPOKE 8195,ZV*16+ZY:VPOKE 8192,ZV*16+ZW:VPOKE 8193,ZW*16+ZY:VPOKE 6915,ZX:VPOKE 6919,ZX:VPOKE 6923,ZX:VPOKE 6927,ZX:VPOKE 6931,ZX
2720 FOR F=0 TO 12:VPOKE 8208+F,ZW*16+ZY:NEXT
2730 RETURN
2740 ' {save_config}
2750 X=12:Y=10:W=8:H=2:GOSUB 5500
2760 POKE YH+0,ZN:POKE YH+1,ZM:POKE YH+2,ZL:POKE YH+3,ZK:A=USR2(0)
2770 LOCATE 12,10:PRINT "XWWWWWWY"
2780 LOCATE 12,11:PRINT "VSAVINGV"
2790 LOCATE 12,12:PRINT "ZWWWWWW["
2800 OPEN "CGKConf.cfg" FOR OUTPUT AS #2
2810 PRINT #2,ZY,ZX,ZW,ZV,ZU,ZT
2820 CLOSE #2
2830 POKE YH+0,ZN:POKE YH+1,ZM:POKE YH+2,ZL:POKE YH+3,ZK:A=USR2(1)
2840 RETURN
2850 ' {load_config}
2860 YK=4
2870 OPEN "CGKConf.cfg" FOR INPUT AS #2
2880 INPUT #2,ZY,ZX,ZW,ZV,ZU,ZT
2890 ' {config_failed}
2900 CLOSE #2
2910 RETURN
2920 ' {refresh_cursor_area}
2930 YV=ZA+(YX-1) 'find formula to cap at gameLength to avoid next if
2940 IF YV>ZD-1 THEN YV=ZD-1
2950 FOR I=ZA TO YV:GET #1,I+1:VPOKE 1024-ZE+I,VPEEK(1024-ZE+I) XOR 255:A$=ZJ$:VPOKE 1024-ZE+I,ASC(A$):NEXT
2960 RETURN
2970 ' {move_scan_sprite}
2980 XV=YY+( YX-2):XU=0
2990 IF YY+( YX-2)>101 THEN XU=8:XV=23+(YY+( YX-2))-103
3000 IF YZ+XU>95 THEN XV=200
3010 VPOKE 6912,YY-1:VPOKE 6913,YZ
3020 VPOKE 6916,XV+1:VPOKE 6917,YZ+XU
3030 LOCATE 3,17:PRINT STRING$(4-LEN(HEX$(ZA)),"0")+HEX$(ZA)
3040 LOCATE 8,17:PRINT STRING$(4-LEN(HEX$(ZA+( YX-1))),"0")+HEX$(ZA+( YX-1))
3050 RETURN
3060 ' {change_sprite_size}
3070 IF YX=32 THEN YX=8 ELSE IF ZA+YX+22<ZD THEN YX=32 ELSE RETURN
3080 XV=YY+(YX-2):XU=0
3090 IF YY+(YX-2)>101 THEN XU=8:XV=23+(YY+(YX-2))-103
3100 IF YZ+XU>95 THEN XV=200
3110 VPOKE 6916,XV+1:VPOKE 6917,YZ+XU
3120 LOCATE 3,17:PRINT STRING$(4-LEN(HEX$(ZA)),"0")+HEX$(ZA)
3130 LOCATE 8,17:PRINT STRING$(4-LEN(HEX$(ZA+( YX-1))),"0")+HEX$(ZA+( YX-1))
3140 RETURN
3150 ' {update_memory_position}
3160 IF ZE<0 THEN ZE=0
3170 IF ZE+799>ZD THEN ZE=ZD-799
3180 ZA=ZE+XS
3190 XT=ZE/(ZD/141)+105
3200 VPOKE 6920,167:VPOKE 6921,XT
3210 VPOKE 6928,167:VPOKE 6929,XT+(141/(ZD/800))
3220 LOCATE 3,17:PRINT STRING$(4-LEN(HEX$(ZA)),"0")+HEX$(ZA)
3230 LOCATE 8,17:PRINT STRING$(4-LEN(HEX$(ZA+7)),"0")+HEX$(ZA+7)
3240 LOCATE 3,19:PRINT STRING$(4-LEN(HEX$(ZE)),"0")+HEX$(ZE)
3250 LOCATE 8,19:PRINT STRING$(4-LEN(HEX$(ZE+799)),"0")+HEX$(ZE+799)
3260 IF ZA+YX>ZD THEN YZ=95-7:YY=103-YX:ZA=ZD-YX+1:GOSUB 2970
3270 IF NOT ZS THEN GOSUB 3290
3280 RETURN
3290 ' {scan}
3300 ZR=0
3310 LOCATE 2,02:PRINT "WWWSCANWWW"
3320 LOCATE 2,13:PRINT "WVÈVStopWW"
3330 FOR F=ZE TO ZE+799
3340 VPOKE 1024-ZE+F,VPEEK(1024-ZE+F) XOR 255:GET #1,F+1:A$=ZJ$:VPOKE 1024-ZE+F,ASC(A$):IF INKEY$=" " THEN F=ZE+800 ELSE NEXT
3350 GOSUB 3370
3360 RETURN
3370 ' {end_scan}
3380 IF ZS THEN LOCATE 2,2:PRINT "WWFREEZEWW" ELSE LOCATE 2,2:PRINT "WWWWWWWWWW"
3390 LOCATE 2,13:PRINT "WWWWWWWWWW"
3400 RETURN
3410 ' {change_movement_step}
3420 ZB=( 8+1)-ZB
3430 ZC=(800+400)-ZC
3440 LOCATE 29,3:PRINT RIGHT$(HEX$(ZB),1):LOCATE 27,4:PRINT RIGHT$(HEX$(ZC),3)
3450 RETURN
3460 ' {edit_screen}
3470 CLS
3480 VPOKE 6920,200:VPOKE 6928,200
3490 POKE YH+0,&H20:POKE YH+1,&H00:POKE YH+2,&H40:POKE YH+3,&H00:A=USR1(0)
3500 LOCATE 00,0:PRINT "  CHANGE GRAPH KIT WW "+LEFT$(YD$,8)
3510 LOCATE 01,2:PRINT "XWWWWWWWWWWY"
3520 LOCATE 01,3:PRINT "VÄäîû®≤º∆–⁄V"
3530 LOCATE 01,4:PRINT "VÅãïü©≥Ω«—€V"
3540 LOCATE 01,5:PRINT "VÇåñ†™¥æ»“‹V"
3550 LOCATE 01,6:PRINT "VÉçó°´µø…”›V"
3560 LOCATE 01,7:PRINT "VÑéò¢¨∂¿ ‘ﬁV"
3570 LOCATE 01,8:PRINT "VÖèô£≠∑¡À’ﬂV"
3580 LOCATE 01,9:PRINT "VÜêö§Æ∏¬Ã÷‡V"
3590 LOCATE 1,10:PRINT "Váëõ•Øπ√Õ◊·V"
3600 LOCATE 1,11:PRINT "Vàíú¶∞∫ƒŒÿ‚V"
3610 LOCATE 1,12:PRINT "Vâìùß±ª≈œŸ„V"
3620 LOCATE 1,13:PRINT "ZWWWWWWWWWW["
3630 LOCATE 1,14:PRINT "XWWY    XWWY"
3640 LOCATE 1,15:PRINT "VHJV    VLNV"
3650 LOCATE 1,16:PRINT "VIKV    VMOV"
3660 LOCATE 1,17:PRINT "ZWW[    ZWW["
3670 LOCATE 5,15:PRINT STRING$(4-LEN(HEX$(ZA)),"0")+HEX$(ZA)
3680 LOCATE 5,16:PRINT STRING$(4-LEN(HEX$(ZA+( YX-1))),"0")+HEX$(ZA+( YX-1))
3690 LOCATE 14,02:PRINT "________________"
3700 LOCATE 14,03:PRINT "________________"
3710 LOCATE 14,04:PRINT "________________"
3720 LOCATE 14,05:PRINT "________________"
3730 LOCATE 14,06:PRINT "________________"
3740 LOCATE 14,07:PRINT "________________"
3750 LOCATE 14,08:PRINT "________________"
3760 LOCATE 14,09:PRINT "________________"
3770 LOCATE 14,10:PRINT "________________"
3780 LOCATE 14,11:PRINT "________________"
3790 LOCATE 14,12:PRINT "________________"
3800 LOCATE 14,13:PRINT "________________"
3810 LOCATE 14,14:PRINT "________________"
3820 LOCATE 14,15:PRINT "________________"
3830 LOCATE 14,16:PRINT "________________"
3840 LOCATE 14,17:PRINT "________________"
3850 VPOKE 6924,15:VPOKE 6925,112
3860 ' {keys_edit_start}
3870 IF YG THEN ZO=0
3880 ON ZO GOTO 3930
3890 LOCATE 01,19:PRINT "VCVCpyVVVPst"
3900 LOCATE 07,21:PRINT "V#VCor"
3910 IF NOT YG THEN LOCATE 01,21:PRINT "VMVKys"
3920 GOTO 3960
3930 ' {keys_edit_2}
3940 LOCATE 01,19:PRINT "VRVRotVTVHmv"
3950 LOCATE 01,21:PRINT "VFVFlpVGVVmv"
3960 ' {keys_edit_end}
3970 LOCATE 13,19:PRINT "VEVErzVÈVTglVLVRld"
3980 LOCATE 13,21:PRINT "VDVInvVSVSavVËVBck"
3990 IF XR>=0 THEN XR=0:XQ=0:XP=0:GOSUB 4250
4000 XR=0
4010 ' {read_keyboard_edit}
4020 A$=INKEY$
4030 IF A$=CHR$(&H1C) AND XQ<YW THEN XQ=XQ+1:VPOKE 6925,112+(XQ*8)
4040 IF A$=CHR$(&H1D) AND XQ>0 THEN XQ=XQ-1:VPOKE 6925,112+(XQ*8)
4050 IF A$=CHR$(&H1E) AND XP>0 THEN XP=XP-1:VPOKE 6924,15+(XP*8)
4060 IF A$=CHR$(&H1F) AND XP<YW THEN XP=XP+1:VPOKE 6924,15+(XP*8)
4070 IF A$="E" THEN XR=2:GOSUB 4250
4080 IF A$="D" THEN XR=1:GOSUB 4250
4090 IF A$="R" THEN XR=3:GOSUB 4250
4100 IF A$="F" THEN XR=4:GOSUB 4250
4110 IF A$="T" THEN XR=5:GOSUB 4250
4120 IF A$="G" THEN XR=6:GOSUB 4250
4130 IF A$="C" THEN FOR F=0 TO YU-1:VPOKE &H0060+F,VPEEK(&H0040+F):NEXT
4140 IF A$="V" THEN FOR F=0 TO YU-1:VPOKE &H0040+F,VPEEK(&H0060+F):NEXT:POKE YH+0,YS:POKE YH+1,YT:A=USR3(0)
4150 IF A$=" " THEN GOSUB 4430
4160 IF A$="S" THEN GOSUB 4500
4170 IF A$="L" THEN XR=0:GOSUB 4250
4180 IF A$="M" THEN ZO=ABS(ZO-1):XR=-1:GOTO 3860
4190 IF A$="1" THEN ZU=ZU-1:GOSUB 4380
4200 IF A$="2" THEN ZU=ZU+1:GOSUB 4380
4210 IF A$="3" THEN ZT=ZT-1:GOSUB 4380
4220 IF A$="4" THEN ZT=ZT+1:GOSUB 4380
4230 IF A$=CHR$(&H0D) THEN VPOKE 6924,200:GOTO 1720
4240 GOTO 4010
4250 ' {fill_edit_area}
4260 YV=ZA+(YX-1) 'find formula to cap at gameLength to avoid next if
4270 IF YV>ZD-1 THEN YV=ZD-1
4280 IF YX=8 THEN YW=7:YU=8:YT=8:YS=1:ELSE YW=15:YU=32:YT=16:YS=2
4290 IF XR=1 THEN POKE YH+0,YU:A=USR0(0)
4300 IF XR=2 THEN POKE YH+0,YU:POKE YH+1,&H00:POKE YH+2,&H40:POKE YH+3,&H00:A=USR1(0)
4310 IF XR=3 AND NOT YG THEN POKE YH+0,YU:A=USR5(0)
4320 IF XR=4 AND NOT YG THEN POKE YH+0,YU:A=USR4(0)
4330 IF XR=5 AND NOT YG THEN POKE YH+0,YU:A=USR6(1)
4340 IF XR=6 AND NOT YG THEN POKE YH+0,YU:A=USR6(0)
4350 IF XR=0 THEN FOR I=ZA TO YV:GET #1,I+1:VPOKE 1024-ZE+I,VPEEK(1024-ZE+I) XOR 255:A$=ZJ$:VPOKE &H0040+I-ZA,ASC(A$):VPOKE 1024-ZE+I,ASC(A$):NEXT
4360 POKE YH+0,YS:POKE YH+1,YT:A=USR3(0)
4370 RETURN
4380 ' {set_minipreview_color}
4390 ZU=FN ZZ(ZU)
4400 ZT=FN ZZ(ZT)
4410 VPOKE 8193,ZU*16+ZT
4420 RETURN
4430 ' {change_bit}
4440 XO=VPEEK ((XQ+14)+(XP+2)*32+6144)
4450 XO=(228+16)-XO
4460 VPOKE (XQ+14)+(XP+2)*32+6144,XO
4470 XN=XP:IF XQ>7 THEN XN=XP+16
4480 VPOKE &H0040+XN,2^(7-(XQ MOD 8)) XOR VPEEK(&H0040+XN)
4490 RETURN
4500 ' {save_drawing}
4510 YV=ZA+(YX-1) 'find formula to cap at gameLength to avoid next if
4520 IF YV>ZD-1 THEN YV=ZD-1
4530 FOR I=ZA TO YV
4540 XM=1024-ZE+I
4550 XL=VPEEK(&H0040+I-ZA)
4560 VPOKE XM,VPEEK(XM) XOR 255
4570 A$=CHR$(XL)
4580 LSET ZJ$=A$:PUT #1,I+1
4590 VPOKE XM,XL
4600 NEXT
4610 RETURN
4620 ' {explode_screen}
4630 CLS
4640 LOCATE 00,0:PRINT "  CHANGE GRAPH KIT WW "+LEFT$(YD$,8)
4650 LOCATE 01,2:PRINT "XWWWWWWWWWWWWWWWWWWWY"
4660 LOCATE 01,3:PRINT "VÄ ä î û ® ≤ º ∆ – ⁄V"
4670 LOCATE 01,4:PRINT "V                   V"
4680 LOCATE 01,5:PRINT "VÅ ã ï ü © ≥ Ω « — €V"
4690 LOCATE 01,6:PRINT "V                   V"
4700 LOCATE 01,7:PRINT "VÇ å ñ † ™ ¥ æ » “ ‹V"
4710 LOCATE 01,8:PRINT "V                   V"
4720 LOCATE 01,9:PRINT "VÉ ç ó ° ´ µ ø … ” ›V"
4730 LOCATE 1,10:PRINT "V                   V"
4740 LOCATE 1,11:PRINT "VÑ é ò ¢ ¨ ∂ ¿   ‘ ﬁV"
4750 LOCATE 1,12:PRINT "V                   V"
4760 LOCATE 1,13:PRINT "VÖ è ô £ ≠ ∑ ¡ À ’ ﬂV"
4770 LOCATE 1,14:PRINT "V                   V"
4780 LOCATE 1,15:PRINT "VÜ ê ö § Æ ∏ ¬ Ã ÷ ‡V"
4790 LOCATE 1,16:PRINT "V                   V"
4800 LOCATE 1,17:PRINT "Vá ë õ • Ø π √ Õ ◊ ·V"
4810 LOCATE 1,18:PRINT "V                   V"
4820 LOCATE 1,19:PRINT "Và í ú ¶ ∞ ∫ ƒ Œ ÿ ‚V"
4830 LOCATE 1,20:PRINT "V                   V"
4840 LOCATE 1,21:PRINT "Vâ ì ù ß ± ª ≈ œ Ÿ „V"
4850 LOCATE 1,22:PRINT "ZWWWWWWWWWWWWWWWWWWW["
4860 LOCATE 23,03:PRINT "VOV Ovrw"
4870 LOCATE 23,21:PRINT "VEV Back"
4880 VPOKE 6912,200:VPOKE 6916,200
4890 VPOKE 6920,200:VPOKE 6928,200
4900 IF ZR THEN GOSUB 5280
4910 ' {explode_keys}
4920 A$=INKEY$
4930 IF A$="O" THEN GOSUB 5090
4940 IF A$=CHR$(&H1C) AND YR<9 AND ZR THEN YR=YR+1:GOSUB 5010
4950 IF A$=CHR$(&H1D) AND YR>0 AND ZR THEN YR=YR-1:GOSUB 5010
4960 IF A$=CHR$(&H1E) AND YQ>0 AND ZR THEN YQ=YQ-1:GOSUB 5010
4970 IF A$=CHR$(&H1F) AND YQ<9 AND ZR THEN YQ=YQ+1:GOSUB 5010
4980 IF A$=CHR$(&H0D) AND ZR THEN ZE=(YQ*YO)+(YR*(YO*10)):ZQ=-1:ZA=ZE:YZ=16:YY=23:IF ZE+799>ZD THEN ZE=ZD-799:YZ=16:YY=23:ZA=ZE:GOTO 1720 ELSE GOTO 1720
4990 IF A$="E" THEN GOTO 1720
5000 GOTO 4910
5010 ' {move_overview_sprite}
5020 VPOKE 6912,(YQ+1)*16+6:VPOKE 6913,(YR+1)*16
5030 VPOKE 6916,(YQ+1)*16+14:VPOKE 6917,(YR+1)*16
5040 YM=(YQ*YO)+(YR*(YO*10))
5050 IF YM+799>ZD THEN YM=ZD-799
5060 LOCATE 27,13:PRINT STRING$(4-LEN(HEX$(YM)),"0")+HEX$(YM)
5070 LOCATE 27,15:PRINT STRING$(4-LEN(HEX$(YM+799)),"0")+HEX$(YM+799)
5080 RETURN
5090 ' {overview}
5100 YP=0
5110 ZR=-1
5120 YO=(ZD/100)
5130 YN=(9*YO)+(9*(YO*10))+8
5140 LOCATE 2,02:PRINT "WWWWWWWSCANWWWWWWWW"
5150 LOCATE 2,22:PRINT "WWWWWWVÈVStopWWWWWW"
5160 FOR F=1 TO YN STEP YO
5170 FOR I=F TO F+7
5180 VPOKE 1024+YP,VPEEK(1024+YP) XOR 255
5190 GET #1,I+1
5200 A$=ZJ$
5210 VPOKE 1024+YP,ASC(A$)
5220 YP=YP+1
5230 IF INKEY$=" " THEN F=YN+1:I=F+8
5240 NEXT
5250 NEXT
5260 GOSUB 5280
5270 RETURN
5280 ' {end_overview}
5290 VPOKE 6912,(YQ+1)*16+6:VPOKE 6913,(YR+1)*16
5300 VPOKE 6916,(YQ+1)*16+14:VPOKE 6917,(YR+1)*16
5310 LOCATE 23,05:PRINT "VÍV Move"
5320 LOCATE 23,07:PRINT "VËV Go"
5330 LOCATE 23,11:PRINT "Region"
5340 YM=(YQ*YO)+(YR*(YO*10))
5350 IF YM+799>ZD THEN YM=ZD-799
5360 LOCATE 23,13:PRINT "St# "+STRING$(4-LEN(HEX$(YM)),"0")+HEX$(YM)
5370 LOCATE 23,15:PRINT "Ed# "+STRING$(4-LEN(HEX$(YM+799)),"0")+HEX$(YM+799)
5380 LOCATE 02,2:PRINT "WWWWWWWWWWWWWWWWWWW"
5390 LOCATE 2,22:PRINT "WWWWWWWWWWWWWWWWWWW"
5400 RETURN
5410 ' {window_requester}
5420 X=5:Y=10:W=21:H=2:GOSUB 5500
5430 POKE YH+0,ZN:POKE YH+1,ZM:POKE YH+2,ZL:POKE YH+3,ZK:A=USR2(0)
5440 LOCATE 5,10:PRINT "XWWWWWWWWWWWWWWWWWWWY"
5450 LOCATE 5,11:PRINT "VAre you sure? (Y/N)V"
5460 LOCATE 5,12:PRINT "ZWWWWWWWWWWWWWWWWWWW["
5470 A$=INKEY$:IF A$<>"Y" AND A$<>"N" THEN 5470
5480 IF A$="N" THEN POKE YH+0,ZN:POKE YH+1,ZM:POKE YH+2,ZL:POKE YH+3,ZK:A=USR2(1):RETURN 2330
5490 RETURN
5500 ' {vram_conversion}
5510 S=&H1800
5520 ZN=FN YF(X,Y,S):ZM=FN YE(X,Y,S)
5530 ZL=W+1:ZK=H+1
5540 IF YG THEN S=0:ZL=FN YF(W,H,S):ZK=FN YE(W,H,S)
5550 RETURN
5560 ' Error Handling Routines
5570 ' {error}
5580 IF ERR=53 AND YK=2 THEN GOTO 5830
5590 IF ERR=56 AND YK=2 THEN GOTO 5830
5600 IF ERR=55 AND YK=4 THEN YK=0:YJ=0:YI$="CONFIG FILE CORRUPTED":RESUME 2890
5610 IF ERR=53 AND YK=4 THEN YK=0:YJ=0:YI$="CONFIG FILE NOT FOUND":RESUME 2890
5620 IF ERR=53 AND YK=3 THEN YK=0:RESUME 490
5630 IF (ERR=53 AND YK=1) OR ERR=70 THEN GOTO 5760
5640 XK=ERR:IF XK>25 THEN XK=XK-24
5650 LOCATE 0,20:PRINTCHR$(&H0D)
5660 FOR F=YL(XK)+1 TO YL(XK+1)-1:PRINT CHR$(PEEK(&H3D75+F));
5670 NEXT
5680 PRINT " (";RIGHT$(STR$(ERR),LEN(STR$(ERR))-1);") at";ERL;CHR$(&H07)
5690 ' {stopped}
5700 CLOSE
5710 STOP OFF
5720 ON ERROR GOTO 0
5730 LOCATE 0,20:PRINTCHR$(&H0D)
5740 PRINT "Break";CHR$(&H07)
5750 END
5760 ' {file_not_found}
5770 PRINT:PRINT "No files found"
5780 PRINT:PRINT "Press space to restart"
5790 IF INKEY$<>" "THEN5790
5800 YK=0
5810 CLS
5820 RESUME 730
5830 ' {bad_file_name}
5840 PRINT:PRINT
5850 IF ERR=53 THEN PRINT YD$;" not found"
5860 IF ERR=56 THEN PRINT "Invalid name"
5870 PRINT:PRINT "Press space to restart"
5880 IF INKEY$<>" "THEN5880
5890 YK=0
5900 RESUME 730
5910 ' Error Messages in ROM
5920 ' {portuguese_ROM}
5930 DATA 0,13,26,43,52,66,75,89,110,132,147
5940 DATA 164,178,192,210,223,239,253,271,287
5950 DATA 304,311,328,344,359,371,383,396,410
5960 DATA 429,444,459,475,501,520,531
5970 ' {english_ROM}
5980 DATA 0,17,30,51,63,85,94,108,130,153,173
5990 DATA 190,205,219,239,255,282,297,321,338
6000 DATA 351,361,382,400,416,437,452,467,483
6010 DATA 498,516,531,545,570,590,604
6020 ' ML Routines at 0xd000. ASM Source on GitHub
6030 ' {ml_routines}
6040 DATA 00,00,00,00,00,00,00,00,c3,14,da,c3,27,da,c3,35
6050 DATA da,c3,5a,da,3a,00,da,47,21,40,00,cd,4a,00,ee,ff
6060 DATA cd,4d,00,23,10,f5,c9,3a,f8,f7,ed,4b,00,da,2a,02
6070 DATA da,cd,56,00,c9,3a,f8,f7,fe,00,ca,4c,da,ed,4b,02
6080 DATA da,ed,5b,00,da,21,93,da,cd,5c,00,c9,ed,4b,02,da
6090 DATA 11,93,da,2a,00,da,cd,59,00,c9,11,40,00,21,4e,18
6100 DATA 3a,00,da,47,c5,3a,01,da,47,c5,eb,cd,4a,00,eb,06
6110 DATA 08,17,f5,38,1a,3e,10,cd,4d,00,f1,23,10,f3,13,d5
6120 DATA 11,18,00,19,d1,c1,10,e1,21,56,18,c1,10,d6,c9,3e
6130 DATA e4,18,e4
6140 ' Character Shapes
6150 ' {character_shapes}
6160 DATA 255,128,128,128,128,128,128,255
6170 DATA 255,0,0,0,0,0,0,255
6180 DATA 255,1,1,1,1,1,1,255
6190 DATA 255,129,129,129,129,129,129,255
6200 DATA 255,255,255,255,255,255,255,255
6210 DATA 0,126,126,126,126,126,126,0
6220 DATA 4,4,36,100,252,96,32,0
6230 DATA 0,0,219,154,82,211,0,0
6240 DATA 231,195,165,24,24,165,195,231
6250 ' Sprite Shapes
6260 DATA 255,129,0,0,0,0,0,0
6270 DATA 129,255,0,0,0,0,0,0
6280 DATA 0,128,128,128,128,128,128,0
6290 DATA 255,129,129,129,129,129,129,255
