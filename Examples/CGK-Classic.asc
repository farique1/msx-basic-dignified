10 ' Converted with MSX Basic Dignified
20 ' https://github.com/farique1/msx-basic-dignified
30 ' CHANGE GRAPH KIT
40 ' v1.5.1
50 ' Edit uncompressed graphics on MSX binary files on disk
60 '
70 ' New
80 '   External .com file ML routines, keeping a simplified version on DATA as a fall back
90 '     New, exclusive in the .com: rotate, slide(move) and flip and improved copy to VRAM
100 '   Better ML DEFINE calls using the new Dignified DEFINEs variables
110 '   Streamlined initialization sequence ML routines and error text only load once
120 '   New mini preview area with Copy and Paste and the editing area address
130 '   Small layout changes with file name now on top line and more space for the step text
140 '   Configuration can now be saved and is automatically load at the start
150 '   Option to scan only the area under the cursor
160 '   Better region map calculation
170 '   Better overview region location report
180 '   Game addresses now starts at position 0 not position 1
190 '   Cursor cannot go or stay beyond game length anymore
200 '   Files now have a minimum limit of 800 bytes to be loaded
210 '   Fixed bug (bad coding) leaking memory on the overview display
220 '	Converted 0 - 1 variables to the new Dignified TRUE - FALSE
230 '   Small code optimizations
240 '
250 ' Copyright (1984 - 2019) - Fred Rique (farique)
260 ' https://github.com/farique1/Change-Graph-Kit
270 '
280 CLEAR 200,&HDA00
290 DEFINT A-Z:MAXFILES=2
300 ON STOP GOSUB 5670:STOP ON
310 ON ERROR GOTO 5580
320 YT=0
330 YS=-1
340 ZY=1:ZX=15:ZW=2:ZV=6:ZU=2:ZT=1
350 GOSUB 2850
360 SCREEN 0:COLOR ZX,ZY,ZY:WIDTH 40:KEY OFF
370 LOCATE 14,11:PRINT "INITIALIZING"
380 LOCATE 14,13:PRINT " ERROR MSGS "
390 DIM YR(36)
400 ' Using the time format in ROM to determine language
410 IF (PEEK(&H2B) AND 112)=32 THEN RESTORE 5880 ELSE RESTORE 5930
420 FOR F=1 TO 36:READ A:YR(F)=A:NEXT
430 LOCATE 14,13:PRINT " ML SUPPORT "
440 YQ=&HDA00
450 YT=3
460 BLOAD "CGKTools.com"
470 YP=0
480 RESTORE 6110
490 GOTO 560
500 ' {ml_fallback}
510 LOCATE 8,8:PRINT " CGKTools.bin not found"
520 LOCATE 8,9:PRINT "Using internal fall back"
530 RESTORE 5990
540 FOR F=0 TO 146:READ A$:LOCATE 18,15:PRINT 147-F:POKE YQ+F,VAL("&h"+A$):NEXT:LOCATE 18,15:PRINT "   "
550 YP=-1
560 ' {ml_setup}
570 DEFUSR0=YQ+&H08 ' invert_VRAM 		v0=len
580 DEFUSR1=YQ+&H0B ' fill_VRAM 		v0-v1=len v2-v3=srt usr(ptrn)
590 DEFUSR2=YQ+&H0E ' copy_VRAM 		v0-v1=VRAM v2=width v3=height usr(direc)
600 DEFUSR3=YQ+&H11 ' populate_edit 	v0=col_len v1=lin_len
610 DEFUSR4=YQ+&H14 ' flip_VRAM		 	v0=len
620 DEFUSR5=YQ+&H17 ' rotate_VRAM	 	v0=len
630 DEFUSR6=YQ+&H1A ' slide_VRAM	 	v0=len usr(direc)
640 DEF FN YO(X,Y,S)=(X+S+(Y*32)) MOD 256
650 DEF FN YN(X,Y,S)=INT((X+S+(Y*32))/256)
660 ' {start}
670 SCREEN 0:WIDTH 40
680 DEF FN ZZ(X)=ABS(X MOD 16+16) MOD 16
690 ZS=0:ZR=0:ZQ=0:ZP=0
700 YM$="" ' leave blank to enable file request
710 YL$=".bin" ' leave blank to all
720 IF YL$="" THEN YL$=".*"
730 IF YM$<>"" THEN GOTO 1360
740 ' {insert_disk}
750 CLS
760 YT=1
770 LOCATE 14,8:PRINT "Insert disk"
780 LOCATE 11,10:PRINT "and press any key"
790 IF NOT YS THEN LOCATE 9,18:PRINT "CONFIG FILE NOT FOUND"
800 A$=INKEY$:IF A$="" GOTO 800
810 CLS
820 FILES "*"+YL$
830 PRINT:PRINT
840 PRINT ":Load":PRINT ":ARROWS choose:ENTER select:SPACE type";
850 FOR F=0 TO 24
860 YK=0+40*F
870 IF CHR$(VPEEK(YK))=":" THEN YJ=F-1
880 NEXT
890 X=12:Y=0
900 YK=X+40*Y
910 GOSUB 1160
920 ' {keys}
930 A$=INKEY$
940 LOCATE X,Y:PRINT "<"
950 LOCATE X,Y:PRINT " "
960 IF A$="" THEN 920
970 LOCATE X,Y:PRINT " "
980 PX=X:PY=Y
990 IF A$=CHR$(&H1C) THEN X=X+13:GOSUB 1080
1000 IF A$=CHR$(&H1D) THEN X=X-13:GOSUB 1080
1010 IF A$=CHR$(&H1E) THEN Y=Y-1:GOSUB 1080
1020 IF A$=CHR$(&H1F) THEN Y=Y+1:GOSUB 1080
1030 IF A$=CHR$(&H0D) THEN GOSUB 1330
1040 IF A$=" " THEN GOTO 1280
1050 LOCATE X,Y:PRINT "<"
1060 GOSUB 1160
1070 GOTO 920
1080 ' {move_cursor_files}
1090 IF X>=39 THEN X=12
1100 IF X<=0 THEN X=38
1110 IF Y<=0 THEN Y=0
1120 IF Y>=24 THEN Y=24
1130 YK=X+40*Y
1140 IF VPEEK(YK-12)=32 THEN X=PX:Y=PY:YK=X+40*Y
1150 RETURN
1160 ' {show_content}
1170 YI=0
1180 YM$=""
1190 YH$=""
1200 LOCATE 6,YJ:PRINT "            "
1210 FOR F=YK-12 TO YK-1
1220 YH$=CHR$(VPEEK(F))
1230 YM$=YM$+YH$
1240 LOCATE 6+YI,YJ:PRINT YH$
1250 YI=YI+1
1260 NEXT
1270 RETURN
1280 ' {type_name}
1290 YT=2
1300 LOCATE 6,YJ:? "            "
1310 LOCATE 6,YJ:LINE INPUT YM$
1320 IF YM$="" THEN GOSUB 1160:GOTO 920
1330 ' {continue}
1340 LOCATE 39,YJ+1:PRINT
1350 FILES YM$
1360 ' {inicializacao}
1370 CLS:SCREEN 1:WIDTH 32
1380 POKE YQ+0,&H20:POKE YQ+1,&H03:POKE YQ+2,&H00:POKE YQ+3,&H04:A=USR1(0)
1390 VPOKE 6914,0:VPOKE 6918,1:VPOKE 6922,2:VPOKE 6926,3:VPOKE 6930,2
1400 LOCATE 10,11:PRINT "INITIALIZING"
1410 LOCATE 10,13:PRINT "    GAME    "
1420 OPEN YM$ AS #1 LEN=1
1430 FIELD #1,1 AS ZJ$
1440 GET #1,3:ZI$=ZJ$:GET #1,2:ZH$=ZJ$:ZG=(ASC(ZI$)*256+ASC(ZH$))-65535!
1450 GET #1,5:ZI$=ZJ$:GET #1,4:ZH$=ZJ$:ZF=(ASC(ZI$)*256+ASC(ZH$))-65535!
1460 YG=ZF-ZG-1
1470 YF=0:YE=8:YD=800:ZS=-1
1480 YC=YF:YB=16:YA=23:XZ=32
1490 IF YG<800 THEN CLOSE:GOTO 5530
1500 LOCATE 10,13:PRINT "   SHAPES   "
1510 LOCATE 15,15:PRINT "06"
1520 FOR F=0 TO 23:READ A:VPOKE &H0008+F,A:NEXT:LOCATE 15,15:PRINT "05"
1530 FOR F=0 TO 7:READ A:VPOKE &H0080+F,A:NEXT:LOCATE 15,15:PRINT "04"
1540 FOR F=0 TO 7:READ A:VPOKE &H00F8+F,A:NEXT:LOCATE 15,15:PRINT "03"
1550 FOR F=0 TO 7:READ A:VPOKE &H0720+F,A:NEXT:LOCATE 15,15:PRINT "02"
1560 FOR F=0 TO 23:READ A:VPOKE &H0740+F,A:NEXT:LOCATE 15,15:PRINT "01"
1570 FOR F=0 TO 31:READ A:VPOKE &H3800+F,A:NEXT:LOCATE 15,15:PRINT "00"
1580 POKE YQ+0,&H20:POKE YQ+1,&H00:POKE YQ+2,&H60:POKE YQ+3,&H00:A=USR1(0)
1590 LOCATE 10,13:PRINT "   COLORS   "
1600 GOSUB 2570
1610 ' {search_screen}
1620 CLS
1630 LOCATE 0,0:PRINT "  CHANGE GRAPH KIT WW "+LEFT$(YM$,8)
1640 LOCATE 1,2:PRINT "XWWWWWWWWWWY"
1650 LOCATE 1,3:PRINT "VÄäîû®≤º∆–⁄V"
1660 LOCATE 1,4:PRINT "VÅãïü©≥Ω«—€V"
1670 LOCATE 1,5:PRINT "VÇåñ†™¥æ»“‹V"
1680 LOCATE 1,6:PRINT "VÉçó°´µø…”›V"
1690 LOCATE 1,7:PRINT "VÑéò¢¨∂¿ ‘ﬁV"
1700 LOCATE 1,8:PRINT "VÖèô£≠∑¡À’ﬂV"
1710 LOCATE 1,9:PRINT "VÜêö§Æ∏¬Ã÷‡V"
1720 LOCATE 1,10:PRINT "Váëõ•Øπ√Õ◊·V"
1730 LOCATE 1,11:PRINT "Vàíú¶∞∫ƒŒÿ‚V"
1740 LOCATE 1,12:PRINT "Vâìùß±ª≈œŸ„V"
1750 LOCATE 1,13:PRINT "ZWWWWWWWWWW["
1760 LOCATE 3,15:PRINT "Srt# End#"
1770 LOCATE 1,17:PRINT "C"
1780 LOCATE 3,17:PRINT STRING$(4-LEN(HEX$(YC)),"0")+HEX$(YC)
1790 LOCATE 8,17:PRINT STRING$(4-LEN(HEX$(YC+( XZ-1))),"0")+HEX$(YC+( XZ-1))
1800 LOCATE 1,19:PRINT "R"
1810 LOCATE 3,19:PRINT STRING$(4-LEN(HEX$(YF)),"0")+HEX$(YF)
1820 LOCATE 8,19:PRINT STRING$(4-LEN(HEX$(YF+799)),"0")+HEX$(YF+799)
1830 LOCATE 1,21:PRINT "G"
1840 LOCATE 3,21:PRINT STRING$(4-LEN(HEX$(0)),"0")+HEX$(0)
1850 LOCATE 8,21:PRINT STRING$(4-LEN(HEX$(YG)),"0")+HEX$(YG)
1860 LOCATE 13,2:PRINT "XWWWWWWWWWWWWWWWWY"
1870 LOCATE 13,3:PRINT "VCursor Stp #   "+RIGHT$(STR$(YE),1)+"V"
1880 LOCATE 13,4:PRINT "VRegion Stp # "+RIGHT$(HEX$(YD),3)+"V"
1890 LOCATE 13,5:PRINT "ZWWWWWWWWWWWWWWWW["
1900 ' {keys_page_start}
1910 ON ZP GOTO 2000
1920 LOCATE 13,7:PRINT "VÍVMove VËVEdit   "
1930 LOCATE 13,9:PRINT "VÈVStep VDVSize   "
1940 LOCATE 13,11:PRINT "VBVClearVRVRefresh"
1950 LOCATE 13,13:PRINT "VTVScan und cursor "
1960 LOCATE 13,15:PRINT "VFVFreeze/Unfreeze"
1970 LOCATE 13,17:PRINT "VEVExplode/Ovrview"
1980 LOCATE 13,19:PRINT "                  "
1990 GOTO 2080
2000 ' {keys_page_2}
2010 LOCATE 13,7:PRINT "VNVNew  VPVExit  "
2020 LOCATE 13,9:PRINT "VQVPrev VWVNext   "
2030 LOCATE 13,11:PRINT "VAVP 4x VSVN 4x   "
2040 LOCATE 13,13:PRINT "VZVSrtVXVMidVCVEnd"
2050 LOCATE 13,15:PRINT "VK LVCfg Save Load"
2060 LOCATE 13,17:PRINT "V1-8VChange Colors"
2070 LOCATE 13,19:PRINT "                  "
2080 ' {keys_page_end}
2090 LOCATE 13,19:PRINT "      VMVMore Keys"
2100 LOCATE 13,21:PRINT "ABBBBBBBBBBBBBBBBC"
2110 GOSUB 3350
2120 IF ZR=-1 THEN LOCATE 2,13:PRINT "WOverviewW"
2130 XY=YA+(XZ-2):XX=0
2140 IF YA+(XZ-2)>101 THEN XX=8:XY=23+(YA+(XZ-2))-103
2150 IF YB+XX>95 THEN XY=200
2160 VPOKE 6912,YA-1:VPOKE 6913,YB
2170 VPOKE 6916,XY+1:VPOKE 6917,XX+YB
2180 XW=YF/(YG/141)+105
2190 VPOKE 6920,167:VPOKE 6921,XW
2200 VPOKE 6928,167:VPOKE 6929,XW+(141/(YG/800))
2210 IF ZQ THEN ZQ=0:GOSUB 3150
2220 ' {read_keyboard_main}
2230 A$=INKEY$
2240 IF A$=CHR$(&H1C) AND (YB+8<95) AND (YC+XZ-2+80<YG) THEN YB=YB+8:YC=YC+80:GOSUB 2970
2250 IF A$=CHR$(&H1D) AND (YB-8>15) THEN YB=YB-8:YC=YC-80:GOSUB 2970
2260 IF A$=CHR$(&H1E) AND (YA-YE>22) THEN YA=YA-YE:YC=YC-YE:GOSUB 2970
2270 IF A$=CHR$(&H1F) AND (YA+YE<103) AND (YC+XZ-2+YE<YG) THEN YA=YA+YE:YC=YC+YE:GOSUB 2970
2280 IF A$="1" THEN ZY=ZY-1:GOSUB 2570
2290 IF A$="2" THEN ZY=ZY+1:GOSUB 2570
2300 IF A$="3" THEN ZX=ZX-1:GOSUB 2570
2310 IF A$="4" THEN ZX=ZX+1:GOSUB 2570
2320 IF A$="5" THEN ZW=ZW-1:GOSUB 2570
2330 IF A$="6" THEN ZW=ZW+1:GOSUB 2570
2340 IF A$="7" THEN ZV=ZV-1:GOSUB 2570
2350 IF A$="8" THEN ZV=ZV+1:GOSUB 2570
2360 IF A$=CHR$(13) THEN GOTO 3440
2370 IF A$="E" THEN GOTO 4580
2380 IF A$="D" THEN GOSUB 3060
2390 IF A$=" " THEN GOSUB 3390
2400 IF A$="R" THEN XV=0:GOSUB 3290
2410 IF A$="M" THEN ZP=ABS(ZP-1):GOTO 1900
2420 IF A$="B" THEN POKE YQ+0,&H20:POKE YQ+1,&H03:POKE YQ+2,&H00:POKE YQ+3,&H04:A=USR1(0)
2430 IF A$="N" THEN GOSUB 5360:CLOSE:RESTORE 6110:GOTO 660
2440 IF A$="P" THEN GOSUB 5360:CLOSE:CLEAR:SCREEN 0:WIDTH 40:COLOR 15,5,5:NEW
2450 IF A$="K" THEN GOSUB 2730
2460 IF A$="L" THEN GOSUB 2850:GOSUB 2570
2470 IF A$="T" THEN GOSUB 2920
2480 IF A$="Q" THEN XV=YC-YF:YF=YF-YD:GOSUB 3150
2490 IF A$="W" THEN XV=YC-YF:YF=YF+YD:GOSUB 3150
2500 IF A$="A" THEN XV=YC-YF:YF=YF-YD*4:GOSUB 3150
2510 IF A$="S" THEN XV=YC-YF:YF=YF+YD*4:GOSUB 3150
2520 IF A$="Z" THEN XV=YC-YF:YF=&H00:GOSUB 3150
2530 IF A$="X" THEN XV=YC-YF:YF=(YG/2)-400:GOSUB 3150
2540 IF A$="C" THEN XV=YC-YF:YF=YG-799:GOSUB 3150
2550 IF A$="F" THEN XV=0:ZS=NOT ZS:IF ZS THEN GOSUB 3350:ELSE:GOSUB 3290
2560 GOTO 2220
2570 ' {set_color}
2580 ZY=FN ZZ(ZY)
2590 ZX=FN ZZ(ZX)
2600 ZW=FN ZZ(ZW)
2610 ZV=FN ZZ(ZV)
2620 ZU=FN ZZ(ZW)
2630 ZT=FN ZZ(ZY)
2640 COLOR ZX,ZY,ZY
2650 VPOKE 8194,ZV*16+ZY
2660 VPOKE 8195,ZV*16+ZY
2670 VPOKE 8192,ZV*16+ZW
2680 VPOKE 8193,ZW*16+ZY
2690 VPOKE 6915,ZX:VPOKE 6919,ZX
2700 VPOKE 6923,ZX:VPOKE 6927,ZX:VPOKE 6931,ZX
2710 FOR F=0 TO 12:VPOKE 8208+F,ZW*16+ZY:NEXT
2720 RETURN
2730 ' {save_config}
2740 X=12:Y=10:W=8:H=2
2750 GOSUB 5470
2760 POKE YQ+0,ZN:POKE YQ+1,ZM:POKE YQ+2,ZL:POKE YQ+3,ZK:A=USR2(0)
2770 LOCATE 12,10:PRINT "XWWWWWWY"
2780 LOCATE 12,11:PRINT "VSAVINGV"
2790 LOCATE 12,12:PRINT "ZWWWWWW[
2800 OPEN "CGKConf.cfg" FOR OUTPUT AS #2
2810 PRINT #2,ZY,ZX,ZW,ZV,ZU,ZT
2820 CLOSE #2
2830 POKE YQ+0,ZN:POKE YQ+1,ZM:POKE YQ+2,ZL:POKE YQ+3,ZK:A=USR2(1)
2840 RETURN
2850 ' {load_config}
2860 YT=4
2870 OPEN "CGKConf.cfg" FOR INPUT AS #2
2880 INPUT #2,ZY,ZX,ZW,ZV,ZU,ZT
2890 CLOSE #2
2900 ' {config_failed}
2910 RETURN
2920 ' {refresh_cursor_area}
2930 ZD=YC+(XZ-1) 'find formula to cap at gameLength to avoid next if
2940 IF ZD>YG-1 THEN ZD=YG-1
2950 FOR I=YC TO ZD:GET #1,I+1:VPOKE 1024-YF+I,VPEEK(1024-YF+I) XOR 255:A$=ZJ$:VPOKE 1024-YF+I,ASC(A$):NEXT
2960 RETURN
2970 ' {move_scan_sprite}
2980 XY=YA+( XZ-2):XX=0
2990 IF YA+( XZ-2)>101 THEN XX=8:XY=23+(YA+( XZ-2))-103
3000 IF YB+XX>95 THEN XY=200
3010 VPOKE 6912,YA-1:VPOKE 6913,YB
3020 VPOKE 6916,XY+1:VPOKE 6917,YB+XX
3030 LOCATE 3,17:PRINT STRING$(4-LEN(HEX$(YC)),"0")+HEX$(YC)
3040 LOCATE 8,17:PRINT STRING$(4-LEN(HEX$(YC+( XZ-1))),"0")+HEX$(YC+( XZ-1))
3050 RETURN
3060 ' {change_sprite_size}
3070 IF XZ=32 THEN XZ=8 ELSE IF YC+XZ+22<YG THEN XZ=32 ELSE RETURN
3080 XY=YA+(XZ-2):XX=0
3090 IF YA+(XZ-2)>101 THEN XX=8:XY=23+(YA+(XZ-2))-103
3100 IF YB+XX>95 THEN XY=200
3110 VPOKE 6916,XY+1:VPOKE 6917,YB+XX
3120 LOCATE 3,17:PRINT STRING$(4-LEN(HEX$(YC)),"0")+HEX$(YC)
3130 LOCATE 8,17:PRINT STRING$(4-LEN(HEX$(YC+( XZ-1))),"0")+HEX$(YC+( XZ-1))
3140 RETURN
3150 ' {update_memory_position}
3160 IF YF<0 THEN YF=0
3170 IF YF+799>YG THEN YF=YG-799
3180 YC=YF+XV
3190 XW=YF/(YG/141)+105
3200 VPOKE 6920,167:VPOKE 6921,XW
3210 VPOKE 6928,167:VPOKE 6929,XW+(141/(YG/800))
3220 LOCATE 3,17:PRINT STRING$(4-LEN(HEX$(YC)),"0")+HEX$(YC)
3230 LOCATE 8,17:PRINT STRING$(4-LEN(HEX$(YC+7)),"0")+HEX$(YC+7)
3240 LOCATE 3,19:PRINT STRING$(4-LEN(HEX$(YF)),"0")+HEX$(YF)
3250 LOCATE 8,19:PRINT STRING$(4-LEN(HEX$(YF+799)),"0")+HEX$(YF+799)
3260 IF YC+XZ>YG THEN YA=103-XZ:YB=95-7:YC=YG-XZ+1:GOSUB 2970
3270 IF NOT ZS THEN 3290
3280 RETURN
3290 ' {scan}
3300 ZR=0
3310 LOCATE 2,2:PRINT "WWWSCANWWW"
3320 LOCATE 2,13:PRINT "WVÈVStopWW"
3330 FOR F=YF TO YF+799
3340 VPOKE 1024-YF+F,VPEEK(1024-YF+F) XOR 255:GET #1,F+1:A$=ZJ$:VPOKE 1024-YF+F,ASC(A$):IF INKEY$=" " THEN 3350 ELSE NEXT
3350 ' {end_scan}
3360 IF ZS THEN LOCATE 2,2:PRINT "WWFREEZEWW" ELSE LOCATE 2,2:PRINT "WWWWWWWWWW"
3370 LOCATE 2,13:PRINT "WWWWWWWWWW"
3380 RETURN
3390 ' {change_movement_step}
3400 IF YE=8 THEN YE=1 ELSE YE=8
3410 IF YD=800 THEN YD=400 ELSE YD=800
3420 LOCATE 29,3:PRINT RIGHT$(HEX$(YE),1):LOCATE 27,4:PRINT RIGHT$(HEX$(YD),3)
3430 RETURN
3440 ' {edit_screen}
3450 CLS
3460 VPOKE 6920,200:VPOKE 6928,200
3470 POKE YQ+0,&H20:POKE YQ+1,&H00:POKE YQ+2,&H40:POKE YQ+3,&H00:A=USR1(0)
3480 LOCATE 0,0:PRINT "  CHANGE GRAPH KIT WW "+LEFT$(YM$,8)
3490 LOCATE 1,2:PRINT "XWWWWWWWWWWY"
3500 LOCATE 1,3:PRINT "VÄäîû®≤º∆–⁄V"
3510 LOCATE 1,4:PRINT "VÅãïü©≥Ω«—€V"
3520 LOCATE 1,5:PRINT "VÇåñ†™¥æ»“‹V"
3530 LOCATE 1,6:PRINT "VÉçó°´µø…”›V"
3540 LOCATE 1,7:PRINT "VÑéò¢¨∂¿ ‘ﬁV"
3550 LOCATE 1,8:PRINT "VÖèô£≠∑¡À’ﬂV"
3560 LOCATE 1,9:PRINT "VÜêö§Æ∏¬Ã÷‡V"
3570 LOCATE 1,10:PRINT "Váëõ•Øπ√Õ◊·V"
3580 LOCATE 1,11:PRINT "Vàíú¶∞∫ƒŒÿ‚V"
3590 LOCATE 1,12:PRINT "Vâìùß±ª≈œŸ„V"
3600 LOCATE 1,13:PRINT "ZWWWWWWWWWW["
3610 LOCATE 1,14:PRINT "XWWRWWWWRWWY"
3620 LOCATE 1,15:PRINT "VHJV    VLNV"
3630 LOCATE 1,16:PRINT "VIKV    VMOV"
3640 LOCATE 1,17:PRINT "ZWWQWWWWQWW["
3650 LOCATE 5,15:PRINT STRING$(4-LEN(HEX$(YC)),"0")+HEX$(YC)
3660 LOCATE 5,16:PRINT STRING$(4-LEN(HEX$(YC+( XZ-1))),"0")+HEX$(YC+( XZ-1))
3670 LOCATE 14,2:PRINT "________________"
3680 LOCATE 14,3:PRINT "________________"
3690 LOCATE 14,4:PRINT "________________"
3700 LOCATE 14,5:PRINT "________________"
3710 LOCATE 14,6:PRINT "________________"
3720 LOCATE 14,7:PRINT "________________"
3730 LOCATE 14,8:PRINT "________________"
3740 LOCATE 14,9:PRINT "________________"
3750 LOCATE 14,10:PRINT "________________"
3760 LOCATE 14,11:PRINT "________________"
3770 LOCATE 14,12:PRINT "________________"
3780 LOCATE 14,13:PRINT "________________"
3790 LOCATE 14,14:PRINT "________________"
3800 LOCATE 14,15:PRINT "________________"
3810 LOCATE 14,16:PRINT "________________"
3820 LOCATE 14,17:PRINT "________________"
3830 VPOKE 6924,15:VPOKE 6925,112
3840 ' {keys_edit_start}
3850 IF YP THEN ZO=0
3860 ON ZO GOTO 3900
3870 LOCATE 01,19:PRINT "VCVCpyVVVPst"
3880 LOCATE 01,21:PRINT "VMVKysV#VCor"
3890 GOTO 3930
3900 ' {keys_edit_2}
3910 LOCATE 01,19:PRINT "VRVRotVTVHmv"
3920 LOCATE 01,21:PRINT "VFVFlpVGVVmv"
3930 ' {keys_edit_end}
3940 LOCATE 13,19:PRINT "VEVErzVÈVTglVLVRld"
3950 LOCATE 13,21:PRINT "VDVInvVSVSavVËVBck"
3960 IF XU=-1 THEN XU=0:GOTO 4100
3970 XT=0:XS=0:XU=0
3980 ' {fill_edit_area}
3990 ZD=YC+(XZ-1) 'find formula to cap at gameLength to avoid next if
4000 IF ZD>YG-1 THEN ZD=YG-1
4010 IF XZ=8 THEN ZE=7:ZC=8:ZB=8:ZA=1:ELSE ZE=15:ZC=32:ZB=16:ZA=2
4020 IF XU=1 THEN POKE YQ+0,ZC:A=USR0(0)
4030 IF XU=2 THEN POKE YQ+0,ZC:POKE YQ+1,&H00:POKE YQ+2,&H40:POKE YQ+3,&H00:A=USR1(0)
4040 IF XU=3 AND NOT YP THEN POKE YQ+0,ZC:A=USR5(0)
4050 IF XU=4 AND NOT YP THEN POKE YQ+0,ZC:A=USR4(0)
4060 IF XU=5 AND NOT YP THEN POKE YQ+0,ZC:A=USR6(1)
4070 IF XU=6 AND NOT YP THEN POKE YQ+0,ZC:A=USR6(0)
4080 IF XU=0 THEN FOR I=YC TO ZD:GET #1,I+1:VPOKE 1024-YF+I,VPEEK(1024-YF+I) XOR 255:A$=ZJ$:VPOKE &H0040+I-YC,ASC(A$):VPOKE 1024-YF+I,ASC(A$):NEXT
4090 POKE YQ+0,ZA:POKE YQ+1,ZB:A=USR3(0)
4100 ' {read_keyboard_edit}
4110 A$=INKEY$
4120 IF A$=CHR$(&H1C) AND XT<ZE THEN XT=XT+1:VPOKE 6925,112+(XT*8)
4130 IF A$=CHR$(&H1D) AND XT>0 THEN XT=XT-1:VPOKE 6925,112+(XT*8)
4140 IF A$=CHR$(&H1E) AND XS>0 THEN XS=XS-1:VPOKE 6924,15+(XS*8)
4150 IF A$=CHR$(&H1F) AND XS<ZE THEN XS=XS+1:VPOKE 6924,15+(XS*8)
4160 IF A$="E" THEN XU=2:GOTO 3980
4170 IF A$="D" THEN XU=1:GOTO 3980
4180 IF A$="R" THEN XU=3:GOTO 3980
4190 IF A$="F" THEN XU=4:GOTO 3980
4200 IF A$="T" THEN XU=5:GOTO 3980
4210 IF A$="G" THEN XU=6:GOTO 3980
4220 IF A$="C" THEN FOR F=0 TO ZC-1:VPOKE &H0060+F,VPEEK(&H0040+F):NEXT
4230 IF A$="V" THEN FOR F=0 TO ZC-1:VPOKE &H0040+F,VPEEK(&H0060+F):NEXT:POKE YQ+0,ZA:POKE YQ+1,ZB:A=USR3(0)
4240 IF A$=" " THEN GOSUB 4390
4250 IF A$="S" THEN GOSUB 4460
4260 IF A$="L" THEN XU=0:GOTO 3980
4270 IF A$="M" THEN ZO=ABS(ZO-1):XU=-1:GOTO 3840
4280 IF A$="1" THEN ZU=ZU-1:GOSUB 4340
4290 IF A$="2" THEN ZU=ZU+1:GOSUB 4340
4300 IF A$="3" THEN ZT=ZT-1:GOSUB 4340
4310 IF A$="4" THEN ZT=ZT+1:GOSUB 4340
4320 IF A$=CHR$(13) THEN VPOKE 6924,200:GOTO 1610
4330 GOTO 4100
4340 ' {set_minipreview_color}
4350 ZU=FN ZZ(ZU)
4360 ZT=FN ZZ(ZT)
4370 VPOKE 8193,ZU*16+ZT
4380 RETURN
4390 ' {change_bit}
4400 XR=VPEEK ((XT+14)+(XS+2)*32+6144)
4410 XR=(228+16)-XR
4420 VPOKE (XT+14)+(XS+2)*32+6144,XR
4430 XQ=XS:IF XT>7 THEN XQ=XS+16
4440 VPOKE &H0040+XQ,2^(7-(XT MOD 8)) XOR VPEEK(&H0040+XQ)
4450 RETURN
4460 ' {save_drawing}
4470 ZD=YC+(XZ-1) 'find formula to cap at gameLength to avoid next if
4480 IF ZD>YG-1 THEN ZD=YG-1
4490 FOR I=YC TO ZD
4500 XP=1024-YF+I
4510 XO=VPEEK(&H0040+I-YC)
4520 VPOKE XP,VPEEK(XP) XOR 255
4530 A$=CHR$(XO)
4540 LSET ZJ$=A$:PUT #1,I
4550 VPOKE XP,XO
4560 NEXT
4570 RETURN
4580 ' {explode_screen}
4590 CLS
4600 LOCATE 0,0:PRINT "  CHANGE GRAPH KIT WW "+LEFT$(YM$,8)
4610 LOCATE 1,2:PRINT "XWWWWWWWWWWWWWWWWWWWY"
4620 LOCATE 1,3:PRINT "VÄ ä î û ® ≤ º ∆ – ⁄V"
4630 LOCATE 1,4:PRINT "V                   V"
4640 LOCATE 1,5:PRINT "VÅ ã ï ü © ≥ Ω « — €V"
4650 LOCATE 1,6:PRINT "V                   V"
4660 LOCATE 1,7:PRINT "VÇ å ñ † ™ ¥ æ » “ ‹V"
4670 LOCATE 1,8:PRINT "V                   V"
4680 LOCATE 1,9:PRINT "VÉ ç ó ° ´ µ ø … ” ›V"
4690 LOCATE 1,10:PRINT "V                   V"
4700 LOCATE 1,11:PRINT "VÑ é ò ¢ ¨ ∂ ¿   ‘ ﬁV"
4710 LOCATE 1,12:PRINT "V                   V"
4720 LOCATE 1,13:PRINT "VÖ è ô £ ≠ ∑ ¡ À ’ ﬂV"
4730 LOCATE 1,14:PRINT "V                   V"
4740 LOCATE 1,15:PRINT "VÜ ê ö § Æ ∏ ¬ Ã ÷ ‡V"
4750 LOCATE 1,16:PRINT "V                   V"
4760 LOCATE 1,17:PRINT "Vá ë õ • Ø π √ Õ ◊ ·V"
4770 LOCATE 1,18:PRINT "V                   V"
4780 LOCATE 1,19:PRINT "Và í ú ¶ ∞ ∫ ƒ Œ ÿ ‚V"
4790 LOCATE 1,20:PRINT "V                   V"
4800 LOCATE 1,21:PRINT "Vâ ì ù ß ± ª ≈ œ Ÿ „V"
4810 LOCATE 1,22:PRINT "ZWWWWWWWWWWWWWWWWWWW["
4820 LOCATE 23,03:PRINT "VOV Ovrw"
4830 LOCATE 23,21:PRINT "VEV Back"
4840 VPOKE 6912,200:VPOKE 6916,200
4850 VPOKE 6920,200:VPOKE 6928,200
4860 IF ZR THEN GOSUB 5220
4870 ' {explode_keys}
4880 A$=INKEY$
4890 IF A$="O" THEN GOSUB 5050
4900 IF A$=CHR$(&H1C) AND YZ<9 AND ZR THEN YZ=YZ+1:GOSUB 4970
4910 IF A$=CHR$(&H1D) AND YZ>0 AND ZR THEN YZ=YZ-1:GOSUB 4970
4920 IF A$=CHR$(&H1F) AND YY<9 AND ZR THEN YY=YY+1:GOSUB 4970
4930 IF A$=CHR$(&H1E) AND YY>0 AND ZR THEN YY=YY-1:GOSUB 4970
4940 IF A$=CHR$(13) AND ZR THEN YF=(YY*YW)+(YZ*(YW*10)):ZQ=-1:YC=YF:YB=16:YA=23:IF YF+799>YG THEN YF=YG-799:YB=16:YA=23:YC=YF:GOTO 1610 ELSE GOTO 1610
4950 IF A$="E" THEN GOTO 1610
4960 GOTO 4870
4970 ' {move_overview_sprite}
4980 VPOKE 6912,(YY+1)*16+6:VPOKE 6913,(YZ+1)*16
4990 VPOKE 6916,(YY+1)*16+14:VPOKE 6917,(YZ+1)*16
5000 YU=(YY*YW)+(YZ*(YW*10))
5010 IF YU+799>YG THEN YU=YG-799
5020 LOCATE 27,13:PRINT STRING$(4-LEN(HEX$(YU)),"0")+HEX$(YU)
5030 LOCATE 27,15:PRINT STRING$(4-LEN(HEX$(YU+799)),"0")+HEX$(YU+799)
5040 RETURN
5050 ' {overview}
5060 YX=0
5070 ZR=-1
5080 YW=(YG/100)
5090 YV=(9*YW)+(9*(YW*10))+8
5100 LOCATE 2,2:PRINT "WWWWWWWSCANWWWWWWWW"
5110 LOCATE 2,22:PRINT "WWWWWVÈVStopWWWWWWW"
5120 FOR F=1 TO YV STEP YW
5130 FOR I=F TO F+7
5140 VPOKE 1024+YX,VPEEK(1024+YX) XOR 255
5150 GET #1,I+1
5160 A$=ZJ$
5170 VPOKE 1024+YX,ASC(A$)
5180 IF INKEY$=" " THEN 5220
5190 YX=YX+1
5200 NEXT
5210 NEXT
5220 ' {end_overview}
5230 VPOKE 6912,(YY+1)*16+6:VPOKE 6913,(YZ+1)*16
5240 VPOKE 6916,(YY+1)*16+14:VPOKE 6917,(YZ+1)*16
5250 LOCATE 23,05:PRINT "VÍV Move"
5260 LOCATE 23,07:PRINT "VËV Go"
5270 LOCATE 23,11:PRINT "Region"
5280 YU=(YY*YW)+(YZ*(YW*10))
5290 IF YU+799>YG THEN YU=YG-799
5300 LOCATE 23,13:PRINT "St# "+STRING$(4-LEN(HEX$(YU)),"0")+HEX$(YU)
5310 LOCATE 23,15:PRINT "Ed# "+STRING$(4-LEN(HEX$(YU+799)),"0")+HEX$(YU+799)
5320 LOCATE 02,2:PRINT "WWWWWWWWWWWWWWWWWWW"
5330 LOCATE 2,22:PRINT "WWWWWWWWWWWWWWWWWWW"
5340 RETURN
5350 END
5360 ' {window_requester}
5370 X=5:Y=10:W=21:H=2
5380 GOSUB 5470
5390 POKE YQ+0,ZN:POKE YQ+1,ZM:POKE YQ+2,ZL:POKE YQ+3,ZK:A=USR2(0)
5400 LOCATE 5,10:PRINT "XWWWWWWWWWWWWWWWWWWWY"
5410 LOCATE 5,11:PRINT "VAre you sure? (Y/N)V"
5420 LOCATE 5,12:PRINT "ZWWWWWWWWWWWWWWWWWWW[
5430 A$=INKEY$:IF A$<>"Y" AND A$<>"N" THEN 5430
5440 IF A$="Y" THEN RETURN
5450 POKE YQ+0,ZN:POKE YQ+1,ZM:POKE YQ+2,ZL:POKE YQ+3,ZK:A=USR2(1)
5460 RETURN 2220
5470 ' {vram_conversion}
5480 S=&H1800
5490 ZN=FN YO(X,Y,S):ZM=FN YN(X,Y,S)
5500 ZL=W+1:ZK=H+1
5510 IF YP THEN S=0:ZL=FN YO(W,H,S):ZK=FN YN(W,H,S)
5520 RETURN
5530 ' {game_small}
5540 LOCATE 13,15:PRINT "Sorry":LOCATE 0,16:PRINT "The game must be over 800 bytes":LOCATE 5,17:PRINT "Press space to restart"
5550 A$=INKEY$:IFA$<>" "THEN5550
5560 SCREEN 0
5570 GOTO 740
5580 ' {error}
5590 IF ERR=53 AND YT=2 THEN GOTO 5780
5600 IF ERR=56 AND YT=2 THEN GOTO 5780
5610 IF ERR=53 AND YT=4 THEN YT=0:YS=0:RESUME 2900
5620 IF ERR=56 AND YT=3 THEN YT=0:RESUME 500
5630 IF (ERR=53 AND YT=1) OR ERR=70 THEN GOTO 5700
5640 XN=ERR:IF XN>25 THEN XN=XN-24
5650 FOR F=YR(XN) TO YR(XN+1):PRINT CHR$(PEEK(&H3D75+F));:NEXT
5660 PRINT " at";ERL
5670 ' {stopped}
5680 CLOSE
5690 END
5700 ' {file_not_found}
5710 PRINT:PRINT "No files found"
5720 PRINT:PRINT "Press space to restart"
5730 A$=INKEY$:IF A$=" " THEN PRINT ELSE 5730
5740 YT=0
5750 CLS
5760 RESUME 740
5770 ON ERROR GOTO 0
5780 ' {input_past_end}
5790 PRINT:PRINT
5800 IF ERR=53 THEN PRINT YM$;" not found"
5810 IF ERR=56 THEN PRINT "Invalid name"
5820 PRINT:PRINT "Press space to restart"
5830 A$=INKEY$:IF A$=" " THEN PRINT ELSE 5830
5840 YT=0
5850 RESUME 740
5860 ON ERROR GOTO 0
5870 ' Error Messages in ROM
5880 ' {portuguese_ROM}
5890 DATA 0,13,26,43,52,66,75,89,110,132,147
5900 DATA 164,178,192,210,223,239,253,271,287
5910 DATA 304,311,328,344,359,371,383,396,410
5920 DATA 429,444,459,475,501,520,531
5930 ' {english_ROM}
5940 DATA 0,17,30,51,63,85,94,108,130,153,173
5950 DATA 190,205,219,239,255,282,297,321,338
5960 DATA 351,361,382,400,416,437,452,467,483
5970 DATA 498,516,531
5980 ' ML Routines at 0xd000 ASM Source on GitHub
5990 ' {ml_routines}
6000 DATA 00,00,00,00,00,00,00,00,c3,14,da,c3,27,da,c3,35
6010 DATA da,c3,5a,da,3a,00,da,47,21,40,00,cd,4a,00,ee,ff
6020 DATA cd,4d,00,23,10,f5,c9,3a,f8,f7,ed,4b,00,da,2a,02
6030 DATA da,cd,56,00,c9,3a,f8,f7,fe,00,ca,4c,da,ed,4b,02
6040 DATA da,ed,5b,00,da,21,93,da,cd,5c,00,c9,ed,4b,02,da
6050 DATA 11,93,da,2a,00,da,cd,59,00,c9,11,40,00,21,4e,18
6060 DATA 3a,00,da,47,c5,3a,01,da,47,c5,eb,cd,4a,00,eb,06
6070 DATA 08,17,f5,38,1a,3e,10,cd,4d,00,f1,23,10,f3,13,d5
6080 DATA 11,18,00,19,d1,c1,10,e1,21,56,18,c1,10,d6,c9,3e
6090 DATA e4,18,e4
6100 ' Character Shapes
6110 ' {character_shapes}
6120 DATA 255,128,128,128,128,128,128,255
6130 DATA 255,0,0,0,0,0,0,255
6140 DATA 255,1,1,1,1,1,1,255
6150 DATA 255,129,129,129,129,129,129,255
6160 DATA 255,255,255,255,255,255,255,255
6170 DATA 0,126,126,126,126,126,126,0
6180 DATA 4,4,36,100,252,96,32,0
6190 DATA 0,0,219,154,82,211,0,0
6200 DATA 231,195,165,24,24,165,195,231
6210 ' Sprite Shapes
6220 DATA 255,129,0,0,0,0,0,0
6230 DATA 129,255,0,0,0,0,0,0
6240 DATA 0,128,128,128,128,128,128,0
6250 DATA 255,129,129,129,129,129,129,255
6260 ' Functions Not Used
6270 ' Create Character Block
6280 C=127
6290 FOR X=2 TO 11
6300 FOR Y=3 TO 12
6310 C=C+1:LOCATE X,Y:PRINT:PRINT CHR$(C)
6320 NEXT
6330 NEXT
6340 END
6350 ' Character Map
6360 FOR I=0 TO 255
6370 X=I MOD 32:Y=I\32
6380 C=I
6390 IF C<32 OR C=127 THEN C=32
6400 LOCATE X,Y:PRINT CHR$(C)
6410 LOCATE X,Y+10:PRINT CHR$(1)+CHR$(C)
6420 NEXT
6430 END
