10 ' Converted with MSX Basic Dignified
20 ' https://github.com/farique1/msx-basic-dignified
30 ' CHANGE GRAPH KIT
40 ' v1.6
50 ' Edit uncompressed graphics on MSX binary files on disk
60 '
70 ' New
80 '   Updated most subroutines to the new FUNC proto-function
90 '	Replaced operators with the new +=, ++, etc where possible
100 '   "|M|Kys" not showing anymore on Edit screen if on ML fallback
110 '   Made DEFINEs for chr$ keys, keyboard scans and screen drawing
120 '   Error handling improvements
130 '   Small code adjustments, cleanup and optimizations
140 '   Fixed bug with a wrong error number when a support file was not found
150 '
160 ' Copyright (1984 - 2020) - Fred Rique (farique)
170 ' https://github.com/farique1/Change-Graph-Kit
180 '
190 CLEAR 200,&HDA00
200 DEFINT A-Z:MAXFILES=2
210 ON STOP GOSUB 5740:STOP ON
220 ON ERROR GOTO 5630
230 DIM YL(36)
240 YK=0
250 YJ=-1
260 YI$=""
270 ZY=1:ZX=15:ZW=2:ZV=6:ZU=2:ZT=1
280 SCREEN 0:COLOR ZX,ZY,ZY:WIDTH 40:KEY OFF
290 LOCATE 14,11:PRINT "INITIALIZING"
300 LOCATE 14,13:PRINT " MAKING STR "
310 GOSUB 1310
320 LOCATE 14,13:PRINT " ERROR MSGS "
330 ' Using the time format in ROM to determine language
340 IF (PEEK(&H2B) AND 112)=32 THEN RESTORE 5960 ELSE RESTORE 6010
350 FOR F=1 TO 36:READ A:YL(F)=A:NEXT
360 LOCATE 14,13:PRINT "LOADING CONF"
370 GOSUB 2910
380 LOCATE 14,13:PRINT " ML SUPPORT "
390 YH=&HDA00
400 YK=3
410 BLOAD "CGKTools.com"
420 YG=0
430 RESTORE 6190
440 GOTO 510
450 ' {ml_fallback}
460 LOCATE 8,8:PRINT " CGKTools.bin not found"
470 LOCATE 8,9:PRINT "Using internal fall back"
480 RESTORE 6070
490 FOR F=0 TO 146:READ A$:LOCATE 18,15:PRINT 147-F:POKE YH+F,VAL("&h"+A$):NEXT:LOCATE 18,15:PRINT "   "
500 YG=-1
510 ' {ml_setup}
520 DEFUSR0=YH+&H08 ' invert_VRAM 		v0=len
530 DEFUSR1=YH+&H0B ' fill_VRAM 		v0-v1=len v2-v3=srt usr(ptrn)
540 DEFUSR2=YH+&H0E ' copy_VRAM 		v0-v1=VRAM v2=width v3=height usr(direc)
550 DEFUSR3=YH+&H11 ' populate_edit 	v0=col_len v1=lin_len
560 DEFUSR4=YH+&H14 ' flip_VRAM		 	v0=len
570 DEFUSR5=YH+&H17 ' rotate_VRAM	 	v0=len
580 DEFUSR6=YH+&H1A ' slide_VRAM	 	v0=len usr(direc)
590 DEF FN YF(X,Y,S)=(X+S+(Y*32)) MOD 256
600 DEF FN YE(X,Y,S)=INT((X+S+(Y*32))/256)
610 ' {start}
620 SCREEN 0:WIDTH 40
630 DEF FN ZZ(X)=ABS(X MOD 16+16) MOD 16
640 ZS=0:ZR=0:ZQ=0:ZP=0
650 YD$="" ' leave blank to enable file request
660 YC$=".bin" ' leave blank to all
670 IF YC$="" THEN YC$=".*"
680 IF YD$<>"" THEN GOTO 1430
690 ' {insert_disk}
700 CLS
710 YK=1
720 LOCATE 14,8:PRINT "Insert disk"
730 LOCATE 11,10:PRINT "and press any key"
740 IF NOT YJ THEN LOCATE 9,18:PRINT YI$
750 IF INKEY$=""THEN750
760 YJ=-1
770 YI$=""
780 CLS
790 FILES "*"+YC$
800 PRINT:PRINT
810 PRINT ":Load":PRINT ":ARROWS choose:ENTER select:SPACE type";
820 FOR F=0 TO 24
830 YB=0+40*F
840 IF CHR$(VPEEK(YB))=":" THEN YA=F-1
850 NEXT
860 X=12:Y=0
870 YB=X+40*Y
880 GOSUB 1130
890 ' {keys}
900 A$=INKEY$
910 LOCATE X,Y:PRINT "{"
920 LOCATE X,Y:PRINT "<"
930 IF A$="" THEN 890
940 LOCATE X,Y:PRINT " "
950 PX=X:PY=Y
960 IF A$=CHR$(&H1C) THEN X=X+13:GOSUB 1050
970 IF A$=CHR$(&H1D) THEN X=X-13:GOSUB 1050
980 IF A$=CHR$(&H1E) THEN Y=Y-1:GOSUB 1050
990 IF A$=CHR$(&H1F) THEN Y=Y+1:GOSUB 1050
1000 IF A$=CHR$(&H0D) THEN 1400
1010 IF A$=" " THEN 1350
1020 LOCATE X,Y:PRINT "<"
1030 GOSUB 1130
1040 GOTO 890
1050 ' {move_cursor_files}
1060 IF X>=39 THEN X=12
1070 IF X<=0 THEN X=38
1080 IF Y<=0 THEN Y=0
1090 IF Y>=24 THEN Y=24
1100 YB=X+40*Y
1110 IF VPEEK(YB-12)=32 THEN X=PX:Y=PY:YB=X+40*Y
1120 RETURN
1130 ' {show_content}
1140 XZ=0:YD$="":XY$=""
1150 LOCATE 6,YA:PRINT "            "
1160 FOR F=YB-12 TO YB-1
1170 XY$=CHR$(VPEEK(F))
1180 YD$=YD$+XY$
1190 LOCATE 6+XZ,YA:PRINT XY$
1200 XZ=XZ+1
1210 NEXT
1220 RETURN
1230 ' {game_small}
1240 CLS
1250 LOCATE 13,11:PRINT "Sorry"
1260 LOCATE 00,12:PRINT "The game must be over 800 bytes"
1270 LOCATE 05,13:PRINT "Press space to restart"
1280 IF INKEY$<>" "THEN1280
1290 SCREEN 0
1300 RETURN
1310 ' {createStrings}
1320 XX$="W":XW$="_"
1330 FOR F=0 TO 4:XX$=XX$+XX$:XW$=XW$+XW$:NEXT
1340 RETURN
1350 ' {type_name}
1360 YK=2
1370 LOCATE 6,YA:? "            "
1380 LOCATE 6,YA:LINE INPUT YD$
1390 IF YD$="" THEN GOSUB 1130:GOTO 890
1400 ' {continue}
1410 LOCATE 39,YA+1:PRINT
1420 FILES YD$
1430 ' {inicializacao}
1440 CLS:SCREEN 1:WIDTH 32
1450 POKE YH+0,&H20:POKE YH+1,&H03:POKE YH+2,&H00:POKE YH+3,&H04:A=USR1(0)
1460 VPOKE 6914,0:VPOKE 6918,1:VPOKE 6922,2:VPOKE 6926,3:VPOKE 6930,2
1470 LOCATE 10,11:PRINT "INITIALIZING"
1480 LOCATE 10,13:PRINT "    GAME    "
1490 OPEN YD$ AS #1 LEN=1
1500 FIELD #1,1 AS ZJ$
1510 GET #1,3:ZI$=ZJ$:GET #1,2:ZH$=ZJ$:ZG=(ASC(ZI$)*256+ASC(ZH$))-65535!
1520 GET #1,5:ZI$=ZJ$:GET #1,4:ZH$=ZJ$:ZF=(ASC(ZI$)*256+ASC(ZH$))-65535!
1530 ZD=ZF-ZG-1
1540 ZE=0:ZC=800:ZB=8:ZS=-1
1550 ZA=ZE:YZ=16:YY=23:YX=32
1560 IF ZD<800 THEN CLOSE:GOSUB 1230:GOTO 690
1570 LOCATE 10,13:PRINT "   SHAPES   "
1580 LOCATE 15,15:PRINT "06"
1590 FOR F=0 TO 23:READ A:VPOKE &H0008+F,A:NEXT:LOCATE 15,15:PRINT "05"
1600 FOR F=0 TO 7:READ A:VPOKE &H0080+F,A:NEXT:LOCATE 15,15:PRINT "04"
1610 FOR F=0 TO 7:READ A:VPOKE &H00F8+F,A:NEXT:LOCATE 15,15:PRINT "03"
1620 FOR F=0 TO 7:READ A:VPOKE &H0720+F,A:NEXT:LOCATE 15,15:PRINT "02"
1630 FOR F=0 TO 23:READ A:VPOKE &H0740+F,A:NEXT:LOCATE 15,15:PRINT "01"
1640 FOR F=0 TO 31:READ A:VPOKE &H3800+F,A:NEXT:LOCATE 15,15:PRINT "00"
1650 POKE YH+0,&H20:POKE YH+1,&H00:POKE YH+2,&H60:POKE YH+3,&H00:A=USR1(0)
1660 LOCATE 10,13:PRINT "   COLORS   "
1670 GOSUB 2640
1680 ' {search_screen}
1690 CLS
1700 LOCATE 0,0:PRINT "  CHANGE GRAPH KIT WW "+LEFT$(YD$,8)
1710 LOCATE 1,2:PRINT "X";LEFT$(XX$,2*10);"Y"
1720 LOCATE 1,3:PRINT "VÄäîû®≤º∆–⁄V"
1730 LOCATE 1,4:PRINT "VÅãïü©≥Ω«—€V"
1740 LOCATE 1,5:PRINT "VÇåñ†™¥æ»“‹V"
1750 LOCATE 1,6:PRINT "VÉçó°´µø…”›V"
1760 LOCATE 1,7:PRINT "VÑéò¢¨∂¿ ‘ﬁV"
1770 LOCATE 1,8:PRINT "VÖèô£≠∑¡À’ﬂV"
1780 LOCATE 1,9:PRINT "VÜêö§Æ∏¬Ã÷‡V"
1790 LOCATE 1,10:PRINT "Váëõ•Øπ√Õ◊·V"
1800 LOCATE 1,11:PRINT "Vàíú¶∞∫ƒŒÿ‚V"
1810 LOCATE 1,12:PRINT "Vâìùß±ª≈œŸ„V"
1820 LOCATE 1,13:PRINT "Z";LEFT$(XX$,2*10);"["
1830 LOCATE 3,15:PRINT "Srt# End#"
1840 LOCATE 1,17:PRINT "C"
1850 LOCATE 3,17:PRINT STRING$(4-LEN(HEX$(ZA)),"0")+HEX$(ZA)
1860 LOCATE 8,17:PRINT STRING$(4-LEN(HEX$(ZA+( YX-1))),"0")+HEX$(ZA+( YX-1))
1870 LOCATE 1,19:PRINT "R"
1880 LOCATE 3,19:PRINT STRING$(4-LEN(HEX$(ZE)),"0")+HEX$(ZE)
1890 LOCATE 8,19:PRINT STRING$(4-LEN(HEX$(ZE+799)),"0")+HEX$(ZE+799)
1900 LOCATE 1,21:PRINT "G"
1910 LOCATE 3,21:PRINT STRING$(4-LEN(HEX$(0)),"0")+HEX$(0)
1920 LOCATE 8,21:PRINT STRING$(4-LEN(HEX$(ZD)),"0")+HEX$(ZD)
1930 LOCATE 13,2:PRINT "X";LEFT$(XX$,2*16);"Y"
1940 LOCATE 13,3:PRINT "VCursor Stp #   "+RIGHT$(STR$(ZB),1)+"V"
1950 LOCATE 13,4:PRINT "VRegion Stp # "+RIGHT$(HEX$(ZC),3)+"V"
1960 LOCATE 13,5:PRINT "Z";LEFT$(XX$,2*16);"["
1970 ' {keys_page_start}
1980 ON ZP GOTO 2070
1990 LOCATE 13,7:PRINT "VÍVMove VËVEdit   "
2000 LOCATE 13,9:PRINT "VÈVStep VDVSize   "
2010 LOCATE 13,11:PRINT "VBVClearVRVRefresh"
2020 LOCATE 13,13:PRINT "VTVScan und cursor "
2030 LOCATE 13,15:PRINT "VFVFreeze/Unfreeze"
2040 LOCATE 13,17:PRINT "VEVExplode/Ovrview"
2050 LOCATE 13,19:PRINT "                  "
2060 GOTO 2150
2070 ' {keys_page_2}
2080 LOCATE 13,7:PRINT "VNVNew  VPVExit  "
2090 LOCATE 13,9:PRINT "VQVPrev VWVNext   "
2100 LOCATE 13,11:PRINT "VAVP 4x VSVN 4x   "
2110 LOCATE 13,13:PRINT "VZVSrtVXVMidVCVEnd"
2120 LOCATE 13,15:PRINT "VK LVCfg Save Load"
2130 LOCATE 13,17:PRINT "V1-8VChange Colors"
2140 LOCATE 13,19:PRINT "                  "
2150 ' {keys_page_end}
2160 LOCATE 13,19:PRINT "      VMVMore Keys"
2170 LOCATE 13,21:PRINT "ABBBBBBBBBBBBBBBBC"
2180 GOSUB 3430
2190 IF ZR=-1 THEN LOCATE 2,13:PRINT "WOverviewW"
2200 XV=YY+(YX-2):XU=0
2210 IF YY+(YX-2)>101 THEN XU=8:XV=23+(YY+(YX-2))-103
2220 IF YZ+XU>95 THEN XV=200
2230 VPOKE 6912,YY-1:VPOKE 6913,YZ
2240 VPOKE 6916,XV+1:VPOKE 6917,XU+YZ
2250 XT=ZE/(ZD/141)+105
2260 VPOKE 6920,167:VPOKE 6921,XT
2270 VPOKE 6928,167:VPOKE 6929,XT+(141/(ZD/800))
2280 IF ZQ THEN ZQ=0:GOSUB 3210
2290 ' {read_keyboard_main}
2300 A$=INKEY$
2310 IF A$=CHR$(&H1C) AND (YZ+8<95) AND (ZA+YX-2+80<ZD) THEN YZ=YZ+8:ZA=ZA+80:GOSUB 3030
2320 IF A$=CHR$(&H1D) AND (YZ-8>15) THEN YZ=YZ-8:ZA=ZA-80:GOSUB 3030
2330 IF A$=CHR$(&H1E) AND (YY-ZB>22) THEN YY=YY-ZB:ZA=ZA-ZB:GOSUB 3030
2340 IF A$=CHR$(&H1F) AND (YY+ZB<103) AND (ZA+YX-2+ZB<ZD) THEN YY=YY+ZB:ZA=ZA+ZB:GOSUB 3030
2350 IF A$="1" THEN ZY=ZY-1:GOSUB 2640
2360 IF A$="2" THEN ZY=ZY+1:GOSUB 2640
2370 IF A$="3" THEN ZX=ZX-1:GOSUB 2640
2380 IF A$="4" THEN ZX=ZX+1:GOSUB 2640
2390 IF A$="5" THEN ZW=ZW-1:GOSUB 2640
2400 IF A$="6" THEN ZW=ZW+1:GOSUB 2640
2410 IF A$="7" THEN ZV=ZV-1:GOSUB 2640
2420 IF A$="8" THEN ZV=ZV+1:GOSUB 2640
2430 IF A$=CHR$(&H0D) THEN GOTO 3520
2440 IF A$="E" THEN GOTO 4680
2450 IF A$="D" THEN GOSUB 3120
2460 IF A$=" " THEN GOSUB 3470
2470 IF A$="R" THEN XS=0:GOSUB 3350
2480 IF A$="M" THEN ZP=ABS(ZP-1):GOTO 1970
2490 IF A$="B" THEN POKE YH+0,&H20:POKE YH+1,&H03:POKE YH+2,&H00:POKE YH+3,&H04:A=USR1(0)
2500 IF A$="N" THEN GOSUB 5470:CLOSE:RESTORE 6190:GOTO 610
2510 IF A$="P" THEN GOSUB 5470:CLOSE:CLEAR:SCREEN 0:WIDTH 40:COLOR 15,5,5:NEW
2520 IF A$="K" THEN GOSUB 2800
2530 IF A$="T" THEN GOSUB 2980
2540 IF A$="L" THEN GOSUB 2910:GOSUB 2640
2550 IF A$="Q" THEN XS=ZA-ZE:ZE=ZE-ZC:GOSUB 3210
2560 IF A$="W" THEN XS=ZA-ZE:ZE=ZE+ZC:GOSUB 3210
2570 IF A$="A" THEN XS=ZA-ZE:ZE=ZE-ZC*4:GOSUB 3210
2580 IF A$="S" THEN XS=ZA-ZE:ZE=ZE+ZC*4:GOSUB 3210
2590 IF A$="Z" THEN XS=ZA-ZE:ZE=&H00:GOSUB 3210
2600 IF A$="X" THEN XS=ZA-ZE:ZE=(ZD/2:GOSUB 3210-400)
2610 IF A$="C" THEN XS=ZA-ZE:ZE=ZD-799:GOSUB 3210
2620 IF A$="F" THEN XS=0:ZS=NOT ZS:IF ZS THEN GOSUB 3430:ELSE:GOSUB 3350
2630 GOTO 2290
2640 ' {set_color}
2650 ZY=FN ZZ(ZY)
2660 ZX=FN ZZ(ZX)
2670 ZW=FN ZZ(ZW)
2680 ZV=FN ZZ(ZV)
2690 ZU=FN ZZ(ZU)
2700 ZT=FN ZZ(ZT)
2710 COLOR ZX,ZY,ZY
2720 VPOKE 8194,ZV*16+ZY
2730 VPOKE 8195,ZV*16+ZY
2740 VPOKE 8192,ZV*16+ZW
2750 VPOKE 8193,ZW*16+ZY
2760 VPOKE 6915,ZX:VPOKE 6919,ZX
2770 VPOKE 6923,ZX:VPOKE 6927,ZX:VPOKE 6931,ZX
2780 FOR F=0 TO 12:VPOKE 8208+F,ZW*16+ZY:NEXT
2790 RETURN
2800 ' {save_config}
2810 X=12:Y=10:W=8:H=2:GOSUB 5560
2820 POKE YH+0,ZN:POKE YH+1,ZM:POKE YH+2,ZL:POKE YH+3,ZK:A=USR2(0)
2830 LOCATE 12,10:PRINT "X";LEFT$(XX$,2*6);"Y"
2840 LOCATE 12,11:PRINT "VSAVINGV"
2850 LOCATE 12,12:PRINT "Z";LEFT$(XX$,2*6);"[
2860 OPEN "CGKConf.cfg" FOR OUTPUT AS #2
2870 PRINT #2,ZY,ZX,ZW,ZV,ZU,ZT
2880 CLOSE #2
2890 POKE YH+0,ZN:POKE YH+1,ZM:POKE YH+2,ZL:POKE YH+3,ZK:A=USR2(1)
2900 RETURN
2910 ' {load_config}
2920 YK=4
2930 OPEN "CGKConf.cfg" FOR INPUT AS #2
2940 INPUT #2,ZY,ZX,ZW,ZV,ZU,ZT
2950 ' {config_failed}
2960 CLOSE #2
2970 RETURN
2980 ' {refresh_cursor_area}
2990 YV=ZA+(YX-1) 'find formula to cap at gameLength to avoid next if
3000 IF YV>ZD-1 THEN YV=ZD-1
3010 FOR I=ZA TO YV:GET #1,I+1:VPOKE 1024-ZE+I,VPEEK(1024-ZE+I) XOR 255:A$=ZJ$:VPOKE 1024-ZE+I,ASC(A$):NEXT
3020 RETURN
3030 ' {move_scan_sprite}
3040 XV=YY+( YX-2):XU=0
3050 IF YY+( YX-2)>101 THEN XU=8:XV=23+(YY+( YX-2))-103
3060 IF YZ+XU>95 THEN XV=200
3070 VPOKE 6912,YY-1:VPOKE 6913,YZ
3080 VPOKE 6916,XV+1:VPOKE 6917,YZ+XU
3090 LOCATE 3,17:PRINT STRING$(4-LEN(HEX$(ZA)),"0")+HEX$(ZA)
3100 LOCATE 8,17:PRINT STRING$(4-LEN(HEX$(ZA+( YX-1))),"0")+HEX$(ZA+( YX-1))
3110 RETURN
3120 ' {change_sprite_size}
3130 IF YX=32 THEN YX=8 ELSE IF ZA+YX+22<ZD THEN YX=32 ELSE RETURN
3140 XV=YY+(YX-2):XU=0
3150 IF YY+(YX-2)>101 THEN XU=8:XV=23+(YY+(YX-2))-103
3160 IF YZ+XU>95 THEN XV=200
3170 VPOKE 6916,XV+1:VPOKE 6917,YZ+XU
3180 LOCATE 3,17:PRINT STRING$(4-LEN(HEX$(ZA)),"0")+HEX$(ZA)
3190 LOCATE 8,17:PRINT STRING$(4-LEN(HEX$(ZA+( YX-1))),"0")+HEX$(ZA+( YX-1))
3200 RETURN
3210 ' {update_memory_position}
3220 IF ZE<0 THEN ZE=0
3230 IF ZE+799>ZD THEN ZE=ZD-799
3240 ZA=ZE+XS
3250 XT=ZE/(ZD/141)+105
3260 VPOKE 6920,167:VPOKE 6921,XT
3270 VPOKE 6928,167:VPOKE 6929,XT+(141/(ZD/800))
3280 LOCATE 3,17:PRINT STRING$(4-LEN(HEX$(ZA)),"0")+HEX$(ZA)
3290 LOCATE 8,17:PRINT STRING$(4-LEN(HEX$(ZA+7)),"0")+HEX$(ZA+7)
3300 LOCATE 3,19:PRINT STRING$(4-LEN(HEX$(ZE)),"0")+HEX$(ZE)
3310 LOCATE 8,19:PRINT STRING$(4-LEN(HEX$(ZE+799)),"0")+HEX$(ZE+799)
3320 IF ZA+YX>ZD THEN YZ=95-7:YY=103-YX:ZA=ZD-YX+1:GOSUB 3030
3330 IF NOT ZS THEN GOSUB 3350
3340 RETURN
3350 ' {scan}
3360 ZR=0
3370 LOCATE 2,2:PRINT LEFT$(XX$,2*3);"SCAN";LEFT$(XX$,2*3)
3380 LOCATE 2,13:PRINT "WVÈVStopWW"
3390 FOR F=ZE TO ZE+799
3400 VPOKE 1024-ZE+F,VPEEK(1024-ZE+F) XOR 255:GET #1,F+1:A$=ZJ$:VPOKE 1024-ZE+F,ASC(A$):IF INKEY$=" " THEN F=ZE+800 ELSE NEXT
3410 GOSUB 3430
3420 RETURN
3430 ' {end_scan}
3440 IF ZS THEN LOCATE 2,2:PRINT "WWFREEZEWW" ELSE LOCATE 2,2:PRINT LEFT$(XX$,2*10)
3450 LOCATE 2,13:PRINT LEFT$(XX$,2*10)
3460 RETURN
3470 ' {change_movement_step}
3480 ZB=( 8+1)-ZB
3490 ZC=(800+400)-ZC
3500 LOCATE 29,3:PRINT RIGHT$(HEX$(ZB),1):LOCATE 27,4:PRINT RIGHT$(HEX$(ZC),3)
3510 RETURN
3520 ' {edit_screen}
3530 CLS
3540 VPOKE 6920,200:VPOKE 6928,200
3550 POKE YH+0,&H20:POKE YH+1,&H00:POKE YH+2,&H40:POKE YH+3,&H00:A=USR1(0)
3560 LOCATE 0,0:PRINT "  CHANGE GRAPH KIT WW "+LEFT$(YD$,8)
3570 LOCATE 1,2:PRINT "X";LEFT$(XX$,2*10);"Y"
3580 LOCATE 1,3:PRINT "VÄäîû®≤º∆–⁄V"
3590 LOCATE 1,4:PRINT "VÅãïü©≥Ω«—€V"
3600 LOCATE 1,5:PRINT "VÇåñ†™¥æ»“‹V"
3610 LOCATE 1,6:PRINT "VÉçó°´µø…”›V"
3620 LOCATE 1,7:PRINT "VÑéò¢¨∂¿ ‘ﬁV"
3630 LOCATE 1,8:PRINT "VÖèô£≠∑¡À’ﬂV"
3640 LOCATE 1,9:PRINT "VÜêö§Æ∏¬Ã÷‡V"
3650 LOCATE 1,10:PRINT "Váëõ•Øπ√Õ◊·V"
3660 LOCATE 1,11:PRINT "Vàíú¶∞∫ƒŒÿ‚V"
3670 LOCATE 1,12:PRINT "Vâìùß±ª≈œŸ„V"
3680 LOCATE 1,13:PRINT "Z";LEFT$(XX$,2*10);"["
3690 LOCATE 1,14:PRINT "X";LEFT$(XX$,2*2);"R";LEFT$(XX$,2*4);"R";LEFT$(XX$,2*2);"Y"
3700 LOCATE 1,15:PRINT "VHJV    VLNV"
3710 LOCATE 1,16:PRINT "VIKV    VMOV"
3720 LOCATE 1,17:PRINT "Z";LEFT$(XX$,2*2);"Q";LEFT$(XX$,2*4);"Q";LEFT$(XX$,2*2);"["
3730 LOCATE 5,15:PRINT STRING$(4-LEN(HEX$(ZA)),"0")+HEX$(ZA)
3740 LOCATE 5,16:PRINT STRING$(4-LEN(HEX$(ZA+( YX-1))),"0")+HEX$(ZA+( YX-1))
3750 LOCATE 14,2:PRINT LEFT$(XW$,2*16)
3760 LOCATE 14,3:PRINT LEFT$(XW$,2*16)
3770 LOCATE 14,4:PRINT LEFT$(XW$,2*16)
3780 LOCATE 14,5:PRINT LEFT$(XW$,2*16)
3790 LOCATE 14,6:PRINT LEFT$(XW$,2*16)
3800 LOCATE 14,7:PRINT LEFT$(XW$,2*16)
3810 LOCATE 14,8:PRINT LEFT$(XW$,2*16)
3820 LOCATE 14,9:PRINT LEFT$(XW$,2*16)
3830 LOCATE 14,10:PRINT LEFT$(XW$,2*16)
3840 LOCATE 14,11:PRINT LEFT$(XW$,2*16)
3850 LOCATE 14,12:PRINT LEFT$(XW$,2*16)
3860 LOCATE 14,13:PRINT LEFT$(XW$,2*16)
3870 LOCATE 14,14:PRINT LEFT$(XW$,2*16)
3880 LOCATE 14,15:PRINT LEFT$(XW$,2*16)
3890 LOCATE 14,16:PRINT LEFT$(XW$,2*16)
3900 LOCATE 14,17:PRINT LEFT$(XW$,2*16)
3910 VPOKE 6924,15:VPOKE 6925,112
3920 ' {keys_edit_start}
3930 IF YG THEN ZO=0
3940 ON ZO GOTO 3990
3950 LOCATE 01,19:PRINT "VCVCpyVVVPst"
3960 LOCATE 07,21:PRINT "V#VCor"
3970 IF NOT YG THEN LOCATE 01,21:PRINT "VMVKys"
3980 GOTO 4020
3990 ' {keys_edit_2}
4000 LOCATE 01,19:PRINT "VRVRotVTVHmv"
4010 LOCATE 01,21:PRINT "VFVFlpVGVVmv"
4020 ' {keys_edit_end}
4030 LOCATE 13,19:PRINT "VEVErzVÈVTglVLVRld"
4040 LOCATE 13,21:PRINT "VDVInvVSVSavVËVBck"
4050 IF XR>=0 THEN XR=0:XQ=0:XP=0:GOSUB 4310
4060 XR=0
4070 ' {read_keyboard_edit}
4080 A$=INKEY$
4090 IF A$=CHR$(&H1C) AND XQ<YW THEN XQ=XQ+1:VPOKE 6925,112+(XQ*8)
4100 IF A$=CHR$(&H1D) AND XQ>0 THEN XQ=XQ-1:VPOKE 6925,112+(XQ*8)
4110 IF A$=CHR$(&H1E) AND XP>0 THEN XP=XP-1:VPOKE 6924,15+(XP*8)
4120 IF A$=CHR$(&H1F) AND XP<YW THEN XP=XP+1:VPOKE 6924,15+(XP*8)
4130 IF A$="E" THEN XR=2:GOSUB 4310
4140 IF A$="D" THEN XR=1:GOSUB 4310
4150 IF A$="R" THEN XR=3:GOSUB 4310
4160 IF A$="F" THEN XR=4:GOSUB 4310
4170 IF A$="T" THEN XR=5:GOSUB 4310
4180 IF A$="G" THEN XR=6:GOSUB 4310
4190 IF A$="C" THEN FOR F=0 TO YU-1:VPOKE &H0060+F,VPEEK(&H0040+F):NEXT
4200 IF A$="V" THEN FOR F=0 TO YU-1:VPOKE &H0040+F,VPEEK(&H0060+F):NEXT:POKE YH+0,YS:POKE YH+1,YT:A=USR3(0)
4210 IF A$=" " THEN GOSUB 4490
4220 IF A$="S" THEN GOSUB 4560
4230 IF A$="L" THEN XR=0:GOSUB 4310
4240 IF A$="M" THEN ZO=ABS(ZO-1):XR=-1:GOTO 3920
4250 IF A$="1" THEN ZU=ZU-1:GOSUB 4440
4260 IF A$="2" THEN ZU=ZU+1:GOSUB 4440
4270 IF A$="3" THEN ZT=ZT-1:GOSUB 4440
4280 IF A$="4" THEN ZT=ZT+1:GOSUB 4440
4290 IF A$=CHR$(&H0D) THEN VPOKE 6924,200:GOTO 1680
4300 GOTO 4070
4310 ' {fill_edit_area}
4320 YV=ZA+(YX-1) 'find formula to cap at gameLength to avoid next if
4330 IF YV>ZD-1 THEN YV=ZD-1
4340 IF YX=8 THEN YW=7:YU=8:YT=8:YS=1:ELSE YW=15:YU=32:YT=16:YS=2
4350 IF XR=1 THEN POKE YH+0,YU:A=USR0(0)
4360 IF XR=2 THEN POKE YH+0,YU:POKE YH+1,&H00:POKE YH+2,&H40:POKE YH+3,&H00:A=USR1(0)
4370 IF XR=3 AND NOT YG THEN POKE YH+0,YU:A=USR5(0)
4380 IF XR=4 AND NOT YG THEN POKE YH+0,YU:A=USR4(0)
4390 IF XR=5 AND NOT YG THEN POKE YH+0,YU:A=USR6(1)
4400 IF XR=6 AND NOT YG THEN POKE YH+0,YU:A=USR6(0)
4410 IF XR=0 THEN FOR I=ZA TO YV:GET #1,I+1:VPOKE 1024-ZE+I,VPEEK(1024-ZE+I) XOR 255:A$=ZJ$:VPOKE &H0040+I-ZA,ASC(A$):VPOKE 1024-ZE+I,ASC(A$):NEXT
4420 POKE YH+0,YS:POKE YH+1,YT:A=USR3(0)
4430 RETURN
4440 ' {set_minipreview_color}
4450 ZU=FN ZZ(ZU)
4460 ZT=FN ZZ(ZT)
4470 VPOKE 8193,ZU*16+ZT
4480 RETURN
4490 ' {change_bit}
4500 XO=VPEEK ((XQ+14)+(XP+2)*32+6144)
4510 XO=(228+16)-XO
4520 VPOKE (XQ+14)+(XP+2)*32+6144,XO
4530 XN=XP:IF XQ>7 THEN XN=XP+16
4540 VPOKE &H0040+XN,2^(7-(XQ MOD 8)) XOR VPEEK(&H0040+XN)
4550 RETURN
4560 ' {save_drawing}
4570 YV=ZA+(YX-1) 'find formula to cap at gameLength to avoid next if
4580 IF YV>ZD-1 THEN YV=ZD-1
4590 FOR I=ZA TO YV
4600 XM=1024-ZE+I
4610 XL=VPEEK(&H0040+I-ZA)
4620 VPOKE XM,VPEEK(XM) XOR 255
4630 A$=CHR$(XL)
4640 LSET ZJ$=A$:PUT #1,I
4650 VPOKE XM,XL
4660 NEXT
4670 RETURN
4680 ' {explode_screen}
4690 CLS
4700 LOCATE 0,0:PRINT "  CHANGE GRAPH KIT WW "+LEFT$(YD$,8)
4710 LOCATE 1,2:PRINT "X";LEFT$(XX$,2*19);"Y"
4720 LOCATE 1,3:PRINT "VÄ ä î û ® ≤ º ∆ – ⁄V"
4730 LOCATE 1,4:PRINT "V                   V"
4740 LOCATE 1,5:PRINT "VÅ ã ï ü © ≥ Ω « — €V"
4750 LOCATE 1,6:PRINT "V                   V"
4760 LOCATE 1,7:PRINT "VÇ å ñ † ™ ¥ æ » “ ‹V"
4770 LOCATE 1,8:PRINT "V                   V"
4780 LOCATE 1,9:PRINT "VÉ ç ó ° ´ µ ø … ” ›V"
4790 LOCATE 1,10:PRINT "V                   V"
4800 LOCATE 1,11:PRINT "VÑ é ò ¢ ¨ ∂ ¿   ‘ ﬁV"
4810 LOCATE 1,12:PRINT "V                   V"
4820 LOCATE 1,13:PRINT "VÖ è ô £ ≠ ∑ ¡ À ’ ﬂV"
4830 LOCATE 1,14:PRINT "V                   V"
4840 LOCATE 1,15:PRINT "VÜ ê ö § Æ ∏ ¬ Ã ÷ ‡V"
4850 LOCATE 1,16:PRINT "V                   V"
4860 LOCATE 1,17:PRINT "Vá ë õ • Ø π √ Õ ◊ ·V"
4870 LOCATE 1,18:PRINT "V                   V"
4880 LOCATE 1,19:PRINT "Và í ú ¶ ∞ ∫ ƒ Œ ÿ ‚V"
4890 LOCATE 1,20:PRINT "V                   V"
4900 LOCATE 1,21:PRINT "Vâ ì ù ß ± ª ≈ œ Ÿ „V"
4910 LOCATE 1,22:PRINT "Z";LEFT$(XX$,2*19);"["
4920 LOCATE 23,03:PRINT "VOV Ovrw"
4930 LOCATE 23,21:PRINT "VEV Back"
4940 VPOKE 6912,200:VPOKE 6916,200
4950 VPOKE 6920,200:VPOKE 6928,200
4960 IF ZR THEN GOSUB 5340
4970 ' {explode_keys}
4980 A$=INKEY$
4990 IF A$="O" THEN GOSUB 5150
5000 IF A$=CHR$(&H1C) AND YR<9 AND ZR THEN YR=YR+1:GOSUB 5070
5010 IF A$=CHR$(&H1D) AND YR>0 AND ZR THEN YR=YR-1:GOSUB 5070
5020 IF A$=CHR$(&H1E) AND YQ>0 AND ZR THEN YQ=YQ-1:GOSUB 5070
5030 IF A$=CHR$(&H1F) AND YQ<9 AND ZR THEN YQ=YQ+1:GOSUB 5070
5040 IF A$=CHR$(&H0D) AND ZR THEN ZE=(YQ*YO)+(YR*(YO*10)):ZQ=-1:ZA=ZE:YZ=16:YY=23:IF ZE+799>ZD THEN ZE=ZD-799:YZ=16:YY=23:ZA=ZE:GOTO 1680 ELSE GOTO 1680
5050 IF A$="E" THEN GOTO 1680
5060 GOTO 4970
5070 ' {move_overview_sprite}
5080 VPOKE 6912,(YQ+1)*16+6:VPOKE 6913,(YR+1)*16
5090 VPOKE 6916,(YQ+1)*16+14:VPOKE 6917,(YR+1)*16
5100 YM=(YQ*YO)+(YR*(YO*10))
5110 IF YM+799>ZD THEN YM=ZD-799
5120 LOCATE 27,13:PRINT STRING$(4-LEN(HEX$(YM)),"0")+HEX$(YM)
5130 LOCATE 27,15:PRINT STRING$(4-LEN(HEX$(YM+799)),"0")+HEX$(YM+799)
5140 RETURN
5150 ' {overview}
5160 YP=0
5170 ZR=-1
5180 YO=(ZD/100)
5190 YN=(9*YO)+(9*(YO*10))+8
5200 LOCATE 2,2:PRINT LEFT$(XX$,2*7);"SCAN";LEFT$(XX$,2*8)
5210 LOCATE 2,22:PRINT LEFT$(XX$,2*5);"VÈVStop";LEFT$(XX$,2*7)
5220 FOR F=1 TO YN STEP YO
5230 FOR I=F TO F+7
5240 VPOKE 1024+YP,VPEEK(1024+YP) XOR 255
5250 GET #1,I+1
5260 A$=ZJ$
5270 VPOKE 1024+YP,ASC(A$)
5280 YP=YP+1
5290 IF INKEY$=" " THEN F=YN+1:I=F+8
5300 NEXT
5310 NEXT
5320 GOSUB 5340
5330 RETURN
5340 ' {end_overview}
5350 VPOKE 6912,(YQ+1)*16+6:VPOKE 6913,(YR+1)*16
5360 VPOKE 6916,(YQ+1)*16+14:VPOKE 6917,(YR+1)*16
5370 LOCATE 23,05:PRINT "VÍV Move"
5380 LOCATE 23,07:PRINT "VËV Go"
5390 LOCATE 23,11:PRINT "Region"
5400 YM=(YQ*YO)+(YR*(YO*10))
5410 IF YM+799>ZD THEN YM=ZD-799
5420 LOCATE 23,13:PRINT "St# "+STRING$(4-LEN(HEX$(YM)),"0")+HEX$(YM)
5430 LOCATE 23,15:PRINT "Ed# "+STRING$(4-LEN(HEX$(YM+799)),"0")+HEX$(YM+799)
5440 LOCATE 02,2:PRINT LEFT$(XX$,2*19)
5450 LOCATE 2,22:PRINT LEFT$(XX$,2*19)
5460 RETURN
5470 ' {window_requester}
5480 X=5:Y=10:W=21:H=2:GOSUB 5560
5490 POKE YH+0,ZN:POKE YH+1,ZM:POKE YH+2,ZL:POKE YH+3,ZK:A=USR2(0)
5500 LOCATE 5,10:PRINT "X";LEFT$(XX$,2*19);"Y"
5510 LOCATE 5,11:PRINT "VAre you sure? (Y/N)V"
5520 LOCATE 5,12:PRINT "Z";LEFT$(XX$,2*19);"[
5530 A$=INKEY$:IF A$<>"Y" AND A$<>"N" THEN 5530
5540 IF A$="N" THEN POKE YH+0,ZN:POKE YH+1,ZM:POKE YH+2,ZL:POKE YH+3,ZK:A=USR2(1):RETURN 2290
5550 RETURN
5560 ' {vram_conversion}
5570 S=&H1800
5580 ZN=FN YF(X,Y,S):ZM=FN YE(X,Y,S)
5590 ZL=W+1:ZK=H+1
5600 IF YG THEN S=0:ZL=FN YF(W,H,S):ZK=FN YE(W,H,S)
5610 RETURN
5620 ' Error Handling Routines
5630 ' {error}
5640 IF ERR=53 AND YK=2 THEN GOTO 5860
5650 IF ERR=56 AND YK=2 THEN GOTO 5860
5660 IF ERR=55 AND YK=4 THEN YK=0:YJ=0:YI$="CONFIG FILE CORRUPTED":RESUME 2950:ON ERROR GOTO 0
5670 IF ERR=53 AND YK=4 THEN YK=0:YJ=0:YI$="CONFIG FILE NOT FOUND":RESUME 2950:ON ERROR GOTO 0
5680 IF ERR=53 AND YK=3 THEN YK=0:RESUME 450:ON ERROR GOTO 0
5690 IF (ERR=53 AND YK=1) OR ERR=70 THEN GOTO 5780
5700 XK=ERR:IF XK>25 THEN XK=XK-24
5710 LOCATE 0,21
5720 FOR F=YL(XK) TO YL(XK+1):PRINT CHR$(PEEK(&H3D75+F));:NEXT
5730 PRINT " at";ERL;"(";ERR;") "
5740 ' {stopped}
5750 CLOSE
5760 LOCATE 0,22
5770 END
5780 ' {file_not_found}
5790 PRINT:PRINT "No files found"
5800 PRINT:PRINT "Press space to restart"
5810 IF INKEY$<>" "THEN5810
5820 YK=0
5830 CLS
5840 RESUME 690
5850 ON ERROR GOTO 0
5860 ' {bad_file_name}
5870 PRINT:PRINT
5880 IF ERR=53 THEN PRINT YD$;" not found"
5890 IF ERR=56 THEN PRINT "Invalid name"
5900 PRINT:PRINT "Press space to restart"
5910 IF INKEY$<>" "THEN5910
5920 YK=0
5930 RESUME 690
5940 ON ERROR GOTO 0
5950 ' Error Messages in ROM
5960 ' {portuguese_ROM}
5970 DATA 0,13,26,43,52,66,75,89,110,132,147
5980 DATA 164,178,192,210,223,239,253,271,287
5990 DATA 304,311,328,344,359,371,383,396,410
6000 DATA 429,444,459,475,501,520,531
6010 ' {english_ROM}
6020 DATA 0,17,30,51,63,85,94,108,130,153,173
6030 DATA 190,205,219,239,255,282,297,321,338
6040 DATA 351,361,382,400,416,437,452,467,483
6050 DATA 498,516,531
6060 ' ML Routines at 0xd000. ASM Source on GitHub
6070 ' {ml_routines}
6080 DATA 00,00,00,00,00,00,00,00,c3,14,da,c3,27,da,c3,35
6090 DATA da,c3,5a,da,3a,00,da,47,21,40,00,cd,4a,00,ee,ff
6100 DATA cd,4d,00,23,10,f5,c9,3a,f8,f7,ed,4b,00,da,2a,02
6110 DATA da,cd,56,00,c9,3a,f8,f7,fe,00,ca,4c,da,ed,4b,02
6120 DATA da,ed,5b,00,da,21,93,da,cd,5c,00,c9,ed,4b,02,da
6130 DATA 11,93,da,2a,00,da,cd,59,00,c9,11,40,00,21,4e,18
6140 DATA 3a,00,da,47,c5,3a,01,da,47,c5,eb,cd,4a,00,eb,06
6150 DATA 08,17,f5,38,1a,3e,10,cd,4d,00,f1,23,10,f3,13,d5
6160 DATA 11,18,00,19,d1,c1,10,e1,21,56,18,c1,10,d6,c9,3e
6170 DATA e4,18,e4
6180 ' Character Shapes
6190 ' {character_shapes}
6200 DATA 255,128,128,128,128,128,128,255
6210 DATA 255,0,0,0,0,0,0,255
6220 DATA 255,1,1,1,1,1,1,255
6230 DATA 255,129,129,129,129,129,129,255
6240 DATA 255,255,255,255,255,255,255,255
6250 DATA 0,126,126,126,126,126,126,0
6260 DATA 4,4,36,100,252,96,32,0
6270 DATA 0,0,219,154,82,211,0,0
6280 DATA 231,195,165,24,24,165,195,231
6290 ' Sprite Shapes
6300 DATA 255,129,0,0,0,0,0,0
6310 DATA 129,255,0,0,0,0,0,0
6320 DATA 0,128,128,128,128,128,128,0
6330 DATA 255,129,129,129,129,129,129,255
6340 ' Functions Not Used
6350 ' Create Character Block
6360 C=127
6370 FOR X=2 TO 11
6380 FOR Y=3 TO 12
6390 C=C+1:LOCATE X,Y:PRINT:PRINT CHR$(C)
6400 NEXT
6410 NEXT
6420 END
6430 ' Character Map
6440 FOR I=0 TO 255
6450 X=I MOD 32:Y=I\32
6460 C=I
6470 IF C<32 OR C=127 THEN C=32
6480 LOCATE X,Y:PRINT CHR$(C)
6490 LOCATE X,Y+10:PRINT CHR$(1)+CHR$(C)
6500 NEXT
6510 END
