10 'Converted with MSX Basic Dignified
20 'https://github.com/farique1/msx-basic-dignified
30 '
40 'CHANGE GRAPH KIT
50 'v1.6.2
60 'Edit uncompressed graphics on MSX binary files on disk
70 '
80 'Copyright (C) 1984-2020 - Fred Rique (farique)
90 'https://github.com/farique1/Change-Graph-Kit
100 '
110 'New 29-02-2020
120 '	Updated some labels to the new Loop Labels.
130 '	Updated some REMs to REM Blocks
140 '	Enclosed aux routines in Line Toggles
150 '	Converted graphics to unicode analogues and changed file format encoding to UTF-8
160 '	Fixed Bug saving drawing 1 byte lower
170 '
180 'New
190 '	Fixed error lookup in machines with English language (or in MSX2?)
200 '	Improved error reporting routine to output to the new MSX Badig Build Monitor Execution
210 '	Improved ON STOP routine and added MSX Badig Build Monitor Execution reporting
220 '	Adjusted background and border colors on quit to 4 instead of 5
230 '
240 CLEAR200,&HDA00
250 DEFINTA-Z:MAXFILES=2
260 ONSTOPGOSUB5240:STOPON
270 ONERRORGOTO5130
280 DIMYL(36)
290 YK=0
300 YJ=-1
310 YI$=""
320 ZY=1:ZX=15:ZW=2:ZV=6:ZU=2:ZT=1
330 SCREEN0:COLORZX,ZY,ZY:WIDTH40:KEYOFF
340 LOCATE14,11:PRINT"INITIALIZING"
350 DATA{*&}
360 LOCATE14,13:PRINT" ERROR MSGS "
370 ' Using the time format in ROM to determine language
380 IF(PEEK(&H2B)AND112)=32THENRESTORE5440ELSERESTORE5480
390 FORF=1TO36:READA:YL(F)=A:NEXT
400 LOCATE14,13:PRINT"LOADING CONF"
410 GOSUB2660
420 LOCATE14,13:PRINT" ML SUPPORT "
430 YH=&HDA00
440 YK=3
450 BLOAD"CGKTools.com"
460 YG=0
470 RESTORE5640
480 GOTO540
490 LOCATE8,8:PRINT" CGKTools.bin not found"
500 LOCATE8,9:PRINT"Using internal fall back"
510 RESTORE5530
520 FORF=0TO146:READA$:LOCATE18,15:PRINT147-F:POKEYH+F,VAL("&h"+A$):NEXT:LOCATE18,15:PRINT"   "
530 YG=-1
540 DEFUSR0=YH+&H08' invert_VRAM 		v0=len
550 DEFUSR1=YH+&H0B' fill_VRAM 		v0-v1=len v2-v3=srt usr(ptrn)
560 DEFUSR2=YH+&H0E' copy_VRAM 		v0-v1=VRAM v2=width v3=height usr(direc)
570 DEFUSR3=YH+&H11' populate_edit 	v0=col_len v1=lin_len
580 DEFUSR4=YH+&H14' flip_VRAM		 	v0=len
590 DEFUSR5=YH+&H17' rotate_VRAM	 	v0=len
600 DEFUSR6=YH+&H1A' slide_VRAM	 	v0=len usr(direc)
610 DEFFNYF(X,Y,S)=(X+S+(Y*32))MOD256
620 DEFFNYE(X,Y,S)=INT((X+S+(Y*32))/256)
630 SCREEN0:WIDTH40
640 DEFFNZZ(X)=ABS(XMOD16+16)MOD16
650 ZS=0:ZR=0:ZQ=0:ZP=0
660 YD$=""' leave blank to enable file request
670 YC$=".bin"' leave blank to all
680 IFYC$=""THENYC$=".*"
690 IFYD$<>""THEN1360
700 CLS
710 YK=1
720 LOCATE14,8:PRINT"Insert disk"
730 LOCATE11,10:PRINT"and press any key"
740 IFNOTYJTHENLOCATE9,18:PRINTYI$
750 IFINKEY$=""THEN750
760 YJ=-1
770 YI$=""
780 CLS
790 FILES"*"+YC$
800 PRINT:PRINT
810 PRINT":Load":PRINT":ARROWS choose:ENTER select:SPACE type";
820 FORF=0TO24
830 YB=0+40*F
840 IFCHR$(VPEEK(YB))=":"THENYA=F-1
850 NEXT
860 X=12:Y=0
870 YB=X+40*Y
880 GOSUB1110
890 A$=INKEY$
900 LOCATEX,Y:PRINT"{"
910 LOCATEX,Y:PRINT"<"
920 IFA$=""THEN890
930 LOCATEX,Y:PRINT" "
940 PX=X:PY=Y
950 IFA$=CHR$(&H1C)THENX=X+13:GOSUB1040
960 IFA$=CHR$(&H1D)THENX=X-13:GOSUB1040
970 IFA$=CHR$(&H1E)THENY=Y-1:GOSUB1040
980 IFA$=CHR$(&H1F)THENY=Y+1:GOSUB1040
990 IFA$=CHR$(&H0D)THEN1340
1000 IFA$=" "THEN1300
1010 LOCATEX,Y:PRINT"<"
1020 GOSUB1110
1030 GOTO890
1040 IFX>=39THENX=12
1050 IFX<=0THENX=38
1060 IFY<=0THENY=0
1070 IFY>=24THENY=24
1080 YB=X+40*Y
1090 IFVPEEK(YB-12)=32THENX=PX:Y=PY:YB=X+40*Y
1100 RETURN
1110 XZ=0:YD$="":XY$=""
1120 LOCATE6,YA:PRINT"            "
1130 FORF=YB-12TOYB-1
1140 XY$=CHR$(VPEEK(F))
1150 YD$=YD$+XY$
1160 LOCATE6+XZ,YA:PRINTXY$
1170 XZ=XZ+1
1180 NEXT
1190 RETURN
1200 CLS
1210 LOCATE13,11:PRINT"Sorry"
1220 LOCATE00,12:PRINT"The game must be over 800 bytes"
1230 LOCATE05,13:PRINT"Press space to restart"
1240 IFINKEY$<>" "THEN1240
1250 SCREEN0
1260 RETURN
1270 XX$="W":XW$="_"
1280 FORF=0TO4:XX$=XX$+XX$:XW$=XW$+XW$:NEXT
1290 RETURN
1300 YK=2
1310 LOCATE6,YA:?"            "
1320 LOCATE6,YA:LINEINPUTYD$
1330 IFYD$=""THENGOSUB1110:GOTO890
1340 LOCATE39,YA+1:PRINT
1350 FILESYD$
1360 CLS:SCREEN1:WIDTH32
1370 POKEYH+0,&H20:POKEYH+1,&H03:POKEYH+2,&H00:POKEYH+3,&H04:A=USR1(0)
1380 VPOKE6914,0:VPOKE6918,1:VPOKE6922,2:VPOKE6926,3:VPOKE6930,2
1390 LOCATE10,11:PRINT"INITIALIZING"
1400 LOCATE10,13:PRINT"    GAME    "
1410 OPENYD$AS#1LEN=1
1420 FIELD#1,1ASZJ$
1430 GET#1,3:ZI$=ZJ$:GET#1,2:ZH$=ZJ$:ZG=(ASC(ZI$)*256+ASC(ZH$))-65535!
1440 GET#1,5:ZI$=ZJ$:GET#1,4:ZH$=ZJ$:ZF=(ASC(ZI$)*256+ASC(ZH$))-65535!
1450 ZD=ZF-ZG-1
1460 ZE=0:ZC=800:ZB=8:ZS=-1
1470 ZA=ZE:YZ=16:YY=23:YX=32
1480 IFZD<800THENCLOSE:GOSUB1200:GOTO700
1490 LOCATE10,13:PRINT"   SHAPES   "
1500 LOCATE15,15:PRINT"06"
1510 FORF=0TO23:READA:VPOKE&H0008+F,A:NEXT:LOCATE15,15:PRINT"05"
1520 FORF=0TO7:READA:VPOKE&H0080+F,A:NEXT:LOCATE15,15:PRINT"04"
1530 FORF=0TO7:READA:VPOKE&H00F8+F,A:NEXT:LOCATE15,15:PRINT"03"
1540 FORF=0TO7:READA:VPOKE&H0720+F,A:NEXT:LOCATE15,15:PRINT"02"
1550 FORF=0TO23:READA:VPOKE&H0740+F,A:NEXT:LOCATE15,15:PRINT"01"
1560 FORF=0TO31:READA:VPOKE&H3800+F,A:NEXT:LOCATE15,15:PRINT"00"
1570 POKEYH+0,&H20:POKEYH+1,&H00:POKEYH+2,&H60:POKEYH+3,&H00:A=USR1(0)
1580 LOCATE10,13:PRINT"   COLORS   "
1590 GOSUB2510
1600 CLS
1610 LOCATE00,0:PRINT"  CHANGE GRAPH KIT WW "+LEFT$(YD$,8)
1620 LOCATE01,2:PRINT"XWWWWWWWWWWY"
1630 LOCATE01,3:PRINT"VÄäîû®≤º∆–⁄V"
1640 LOCATE01,4:PRINT"VÅãïü©≥Ω«—€V"
1650 LOCATE01,5:PRINT"VÇåñ†™¥æ»“‹V"
1660 LOCATE01,6:PRINT"VÉçó°´µø…”›V"
1670 LOCATE01,7:PRINT"VÑéò¢¨∂¿ ‘ﬁV"
1680 LOCATE01,8:PRINT"VÖèô£≠∑¡À’ﬂV"
1690 LOCATE01,9:PRINT"VÜêö§Æ∏¬Ã÷‡V"
1700 LOCATE1,10:PRINT"Váëõ•Øπ√Õ◊·V"
1710 LOCATE1,11:PRINT"Vàíú¶∞∫ƒŒÿ‚V"
1720 LOCATE1,12:PRINT"Vâìùß±ª≈œŸ„V"
1730 LOCATE1,13:PRINT"ZWWWWWWWWWW["
1740 LOCATE3,15:PRINT"Srt# End#"
1750 LOCATE1,17:PRINT"C"
1760 LOCATE3,17:PRINTSTRING$(4-LEN(HEX$(ZA)),"0")+HEX$(ZA)
1770 LOCATE8,17:PRINTSTRING$(4-LEN(HEX$(ZA+(YX-1))),"0")+HEX$(ZA+(YX-1))
1780 LOCATE1,19:PRINT"R"
1790 LOCATE3,19:PRINTSTRING$(4-LEN(HEX$(ZE)),"0")+HEX$(ZE)
1800 LOCATE8,19:PRINTSTRING$(4-LEN(HEX$(ZE+799)),"0")+HEX$(ZE+799)
1810 LOCATE1,21:PRINT"G"
1820 LOCATE3,21:PRINTSTRING$(4-LEN(HEX$(0)),"0")+HEX$(0)
1830 LOCATE8,21:PRINTSTRING$(4-LEN(HEX$(ZD)),"0")+HEX$(ZD)
1840 LOCATE13,2:PRINT"XWWWWWWWWWWWWWWWWY"
1850 LOCATE13,3:PRINT"VCursor Stp #    V":LOCATE29,3:PRINTRIGHT$(STR$(ZB),1)
1860 LOCATE13,4:PRINT"VRegion Stp #    V":LOCATE27,4:PRINTRIGHT$(HEX$(ZC),3)
1870 LOCATE13,5:PRINT"ZWWWWWWWWWWWWWWWW["
1880 ONZPGOTO1970
1890 LOCATE13,7:PRINT"VÍVMove VËVEdit   "
1900 LOCATE13,9:PRINT"VÈVStep VDVSize   "
1910 LOCATE13,11:PRINT"VBVClearVRVRefresh"
1920 LOCATE13,13:PRINT"VTVScan und cursor "
1930 LOCATE13,15:PRINT"VFVFreeze/Unfreeze"
1940 LOCATE13,17:PRINT"VEVExplode/Ovrview"
1950 LOCATE13,19:PRINT"                  "
1960 GOTO2040
1970 LOCATE13,7:PRINT"VNVNew  VPVExit  "
1980 LOCATE13,9:PRINT"VQVPrev VWVNext   "
1990 LOCATE13,11:PRINT"VAVP 4x VSVN 4x   "
2000 LOCATE13,13:PRINT"VZVSrtVXVMidVCVEnd"
2010 LOCATE13,15:PRINT"VK LVCfg Save Load"
2020 LOCATE13,17:PRINT"V1-8VChange Colors"
2030 LOCATE13,19:PRINT"                  "
2040 LOCATE13,19:PRINT"      VMVMore Keys"
2050 LOCATE13,21:PRINT"ABBBBBBBBBBBBBBBBC"
2060 GOSUB3110
2070 IFZR=-1THENLOCATE2,13:PRINT"WOverviewW"
2080 XV=YY+(YX-2):XU=0
2090 IFYY+(YX-2)>101THENXU=8:XV=23+(YY+(YX-2))-103
2100 IFYZ+XU>95THENXV=200
2110 VPOKE6912,YY-1:VPOKE6913,YZ
2120 VPOKE6916,XV+1:VPOKE6917,XU+YZ
2130 XT=ZE/(ZD/141)+105
2140 VPOKE6920,167:VPOKE6921,XT
2150 VPOKE6928,167:VPOKE6929,XT+(141/(ZD/800))
2160 IFZQTHENZQ=0:GOSUB2910
2170 A$=INKEY$
2180 IFA$=CHR$(&H1C)AND(YZ+8<95)AND(ZA+YX-2+80<ZD)THENYZ=YZ+8:ZA=ZA+80:GOSUB2750
2190 IFA$=CHR$(&H1D)AND(YZ-8>15)THENYZ=YZ-8:ZA=ZA-80:GOSUB2750
2200 IFA$=CHR$(&H1E)AND(YY-ZB>22)THENYY=YY-ZB:ZA=ZA-ZB:GOSUB2750
2210 IFA$=CHR$(&H1F)AND(YY+ZB<103)AND(ZA+YX-2+ZB<ZD)THENYY=YY+ZB:ZA=ZA+ZB:GOSUB2750
2220 IFA$="1"THENZY=ZY-1:GOSUB2510
2230 IFA$="2"THENZY=ZY+1:GOSUB2510
2240 IFA$="3"THENZX=ZX-1:GOSUB2510
2250 IFA$="4"THENZX=ZX+1:GOSUB2510
2260 IFA$="5"THENZW=ZW-1:GOSUB2510
2270 IFA$="6"THENZW=ZW+1:GOSUB2510
2280 IFA$="7"THENZV=ZV-1:GOSUB2510
2290 IFA$="8"THENZV=ZV+1:GOSUB2510
2300 IFA$=CHR$(&H0D)THEN3180
2310 IFA$="E"THEN4250
2320 IFA$="D"THENGOSUB2830
2330 IFA$=" "THENGOSUB3140
2340 IFA$="R"THENXS=0:GOSUB3040
2350 IFA$="M"THENZP=ABS(ZP-1):GOTO1880
2360 IFA$="B"THENPOKEYH+0,&H20:POKEYH+1,&H03:POKEYH+2,&H00:POKEYH+3,&H04:A=USR1(0)
2370 IFA$="N"THENGOSUB4990:CLOSE:RESTORE5640:GOTO630
2380 IFA$="P"THENGOSUB4990:CLOSE:CLEAR:SCREEN0:WIDTH40:COLOR15,4,4:NEW
2390 IFA$="K"THENGOSUB2560
2400 IFA$="T"THENGOSUB2710
2410 IFA$="L"THENGOSUB2660:GOSUB2510
2420 IFA$="Q"THENXS=ZA-ZE:ZE=(ZE-ZC):GOSUB2910
2430 IFA$="W"THENXS=ZA-ZE:ZE=ZE+ZC:GOSUB2910
2440 IFA$="A"THENXS=ZA-ZE:ZE=ZE-ZC*4:GOSUB2910
2450 IFA$="S"THENXS=ZA-ZE:ZE=ZE+ZC*4:GOSUB2910
2460 IFA$="Z"THENXS=ZA-ZE:ZE=&H00:GOSUB2910
2470 IFA$="X"THENXS=ZA-ZE:ZE=(ZD/2)-400:GOSUB2910
2480 IFA$="C"THENXS=ZA-ZE:ZE=ZD-799:GOSUB2910
2490 IFA$="F"THENXS=0:ZS=NOTZS:IFZSTHENGOSUB3110:ELSE:GOSUB3040
2500 GOTO2170
2510 ZY=FNZZ(ZY):ZX=FNZZ(ZX):ZW=FNZZ(ZW):ZV=FNZZ(ZV):ZU=FNZZ(ZU):ZT=FNZZ(ZT)
2520 COLORZX,ZY,ZY
2530 VPOKE8194,ZV*16+ZY:VPOKE8195,ZV*16+ZY:VPOKE8192,ZV*16+ZW:VPOKE8193,ZW*16+ZY:VPOKE6915,ZX:VPOKE6919,ZX:VPOKE6923,ZX:VPOKE6927,ZX:VPOKE6931,ZX
2540 FORF=0TO12:VPOKE8208+F,ZW*16+ZY:NEXT
2550 RETURN
2560 X=12:Y=10:W=8:H=2:GOSUB5070
2570 POKEYH+0,ZN:POKEYH+1,ZM:POKEYH+2,ZL:POKEYH+3,ZK:A=USR2(0)
2580 LOCATE12,10:PRINT"XWWWWWWY"
2590 LOCATE12,11:PRINT"VSAVINGV"
2600 LOCATE12,12:PRINT"ZWWWWWW["
2610 OPEN"CGKConf.cfg"FOROUTPUTAS#2
2620 PRINT#2,ZY,ZX,ZW,ZV,ZU,ZT
2630 CLOSE#2
2640 POKEYH+0,ZN:POKEYH+1,ZM:POKEYH+2,ZL:POKEYH+3,ZK:A=USR2(1)
2650 RETURN
2660 YK=4
2670 OPEN"CGKConf.cfg"FORINPUTAS#2
2680 INPUT#2,ZY,ZX,ZW,ZV,ZU,ZT
2690 CLOSE#2
2700 RETURN
2710 YV=ZA+(YX-1)'find formula to cap at gameLength to avoid next if
2720 IFYV>ZD-1THENYV=ZD-1
2730 FORI=ZATOYV:GET#1,I+1:VPOKE1024-ZE+I,VPEEK(1024-ZE+I)XOR255:A$=ZJ$:VPOKE1024-ZE+I,ASC(A$):NEXT
2740 RETURN
2750 XV=YY+(YX-2):XU=0
2760 IFYY+(YX-2)>101THENXU=8:XV=23+(YY+(YX-2))-103
2770 IFYZ+XU>95THENXV=200
2780 VPOKE6912,YY-1:VPOKE6913,YZ
2790 VPOKE6916,XV+1:VPOKE6917,YZ+XU
2800 LOCATE3,17:PRINTSTRING$(4-LEN(HEX$(ZA)),"0")+HEX$(ZA)
2810 LOCATE8,17:PRINTSTRING$(4-LEN(HEX$(ZA+(YX-1))),"0")+HEX$(ZA+(YX-1))
2820 RETURN
2830 IFYX=32THENYX=8ELSEIFZA+YX+22<ZDTHENYX=32ELSERETURN
2840 XV=YY+(YX-2):XU=0
2850 IFYY+(YX-2)>101THENXU=8:XV=23+(YY+(YX-2))-103
2860 IFYZ+XU>95THENXV=200
2870 VPOKE6916,XV+1:VPOKE6917,YZ+XU
2880 LOCATE3,17:PRINTSTRING$(4-LEN(HEX$(ZA)),"0")+HEX$(ZA)
2890 LOCATE8,17:PRINTSTRING$(4-LEN(HEX$(ZA+(YX-1))),"0")+HEX$(ZA+(YX-1))
2900 RETURN
2910 IFZE<0THENZE=0
2920 IFZE+799>ZDTHENZE=ZD-799
2930 ZA=ZE+XS
2940 XT=ZE/(ZD/141)+105
2950 VPOKE6920,167:VPOKE6921,XT
2960 VPOKE6928,167:VPOKE6929,XT+(141/(ZD/800))
2970 LOCATE3,17:PRINTSTRING$(4-LEN(HEX$(ZA)),"0")+HEX$(ZA)
2980 LOCATE8,17:PRINTSTRING$(4-LEN(HEX$(ZA+7)),"0")+HEX$(ZA+7)
2990 LOCATE3,19:PRINTSTRING$(4-LEN(HEX$(ZE)),"0")+HEX$(ZE)
3000 LOCATE8,19:PRINTSTRING$(4-LEN(HEX$(ZE+799)),"0")+HEX$(ZE+799)
3010 IFZA+YX>ZDTHENYZ=95-7:YY=103-YX:ZA=ZD-YX+1:GOSUB2750
3020 IFNOTZSTHENGOSUB3040
3030 RETURN
3040 ZR=0
3050 LOCATE2,02:PRINT"WWWSCANWWW"
3060 LOCATE2,13:PRINT"WVÈVStopWW"
3070 FORF=ZETOZE+799
3080 VPOKE1024-ZE+F,VPEEK(1024-ZE+F)XOR255:GET#1,F+1:A$=ZJ$:VPOKE1024-ZE+F,ASC(A$):IFINKEY$=" "THENF=ZE+800ELSENEXT
3090 GOSUB3110
3100 RETURN
3110 IFZSTHENLOCATE2,2:PRINT"WWFREEZEWW"ELSELOCATE2,2:PRINT"WWWWWWWWWW"
3120 LOCATE2,13:PRINT"WWWWWWWWWW"
3130 RETURN
3140 ZB=(8+1)-ZB
3150 ZC=(800+400)-ZC
3160 LOCATE29,3:PRINTRIGHT$(HEX$(ZB),1):LOCATE27,4:PRINTRIGHT$(HEX$(ZC),3)
3170 RETURN
3180 CLS
3190 VPOKE6920,200:VPOKE6928,200
3200 POKEYH+0,&H20:POKEYH+1,&H00:POKEYH+2,&H40:POKEYH+3,&H00:A=USR1(0)
3210 LOCATE00,0:PRINT"  CHANGE GRAPH KIT WW "+LEFT$(YD$,8)
3220 LOCATE01,2:PRINT"XWWWWWWWWWWY"
3230 LOCATE01,3:PRINT"VÄäîû®≤º∆–⁄V"
3240 LOCATE01,4:PRINT"VÅãïü©≥Ω«—€V"
3250 LOCATE01,5:PRINT"VÇåñ†™¥æ»“‹V"
3260 LOCATE01,6:PRINT"VÉçó°´µø…”›V"
3270 LOCATE01,7:PRINT"VÑéò¢¨∂¿ ‘ﬁV"
3280 LOCATE01,8:PRINT"VÖèô£≠∑¡À’ﬂV"
3290 LOCATE01,9:PRINT"VÜêö§Æ∏¬Ã÷‡V"
3300 LOCATE1,10:PRINT"Váëõ•Øπ√Õ◊·V"
3310 LOCATE1,11:PRINT"Vàíú¶∞∫ƒŒÿ‚V"
3320 LOCATE1,12:PRINT"Vâìùß±ª≈œŸ„V"
3330 LOCATE1,13:PRINT"ZWWWWWWWWWW["
3340 LOCATE1,14:PRINT"XWWY    XWWY"
3350 LOCATE1,15:PRINT"VHJV    VLNV"
3360 LOCATE1,16:PRINT"VIKV    VMOV"
3370 LOCATE1,17:PRINT"ZWW[    ZWW["
3380 LOCATE5,15:PRINTSTRING$(4-LEN(HEX$(ZA)),"0")+HEX$(ZA)
3390 LOCATE5,16:PRINTSTRING$(4-LEN(HEX$(ZA+(YX-1))),"0")+HEX$(ZA+(YX-1))
3400 LOCATE14,02:PRINT"________________"
3410 LOCATE14,03:PRINT"________________"
3420 LOCATE14,04:PRINT"________________"
3430 LOCATE14,05:PRINT"________________"
3440 LOCATE14,06:PRINT"________________"
3450 LOCATE14,07:PRINT"________________"
3460 LOCATE14,08:PRINT"________________"
3470 LOCATE14,09:PRINT"________________"
3480 LOCATE14,10:PRINT"________________"
3490 LOCATE14,11:PRINT"________________"
3500 LOCATE14,12:PRINT"________________"
3510 LOCATE14,13:PRINT"________________"
3520 LOCATE14,14:PRINT"________________"
3530 LOCATE14,15:PRINT"________________"
3540 LOCATE14,16:PRINT"________________"
3550 LOCATE14,17:PRINT"________________"
3560 VPOKE6924,15:VPOKE6925,112
3570 IFYGTHENZO=0
3580 ONZOGOTO3630
3590 LOCATE01,19:PRINT"VCVCpyVVVPst"
3600 LOCATE07,21:PRINT"V#VCor"
3610 IFNOTYGTHENLOCATE01,21:PRINT"VMVKys"
3620 GOTO3650
3630 LOCATE01,19:PRINT"VRVRotVTVHmv"
3640 LOCATE01,21:PRINT"VFVFlpVGVVmv"
3650 LOCATE13,19:PRINT"VEVErzVÈVTglVLVRld"
3660 LOCATE13,21:PRINT"VDVInvVSVSavVËVBck"
3670 IFXR>=0THENXR=0:XQ=0:XP=0:GOSUB3920
3680 XR=0
3690 A$=INKEY$
3700 IFA$=CHR$(&H1C)ANDXQ<YWTHENXQ=XQ+1:VPOKE6925,112+(XQ*8)
3710 IFA$=CHR$(&H1D)ANDXQ>0THENXQ=XQ-1:VPOKE6925,112+(XQ*8)
3720 IFA$=CHR$(&H1E)ANDXP>0THENXP=XP-1:VPOKE6924,15+(XP*8)
3730 IFA$=CHR$(&H1F)ANDXP<YWTHENXP=XP+1:VPOKE6924,15+(XP*8)
3740 IFA$="E"THENXR=2:GOSUB3920
3750 IFA$="D"THENXR=1:GOSUB3920
3760 IFA$="R"THENXR=3:GOSUB3920
3770 IFA$="F"THENXR=4:GOSUB3920
3780 IFA$="T"THENXR=5:GOSUB3920
3790 IFA$="G"THENXR=6:GOSUB3920
3800 IFA$="C"THENFORF=0TOYU-1:VPOKE&H0060+F,VPEEK(&H0040+F):NEXT
3810 IFA$="V"THENFORF=0TOYU-1:VPOKE&H0040+F,VPEEK(&H0060+F):NEXT:POKEYH+0,YS:POKEYH+1,YT:A=USR3(0)
3820 IFA$=" "THENGOSUB4080
3830 IFA$="S"THENGOSUB4140
3840 IFA$="L"THENXR=0:GOSUB3920
3850 IFA$="M"THENZO=ABS(ZO-1):XR=-1:GOTO3570
3860 IFA$="1"THENZU=ZU-1:GOSUB4040
3870 IFA$="2"THENZU=ZU+1:GOSUB4040
3880 IFA$="3"THENZT=ZT-1:GOSUB4040
3890 IFA$="4"THENZT=ZT+1:GOSUB4040
3900 IFA$=CHR$(&H0D)THENVPOKE6924,200:GOTO1600
3910 GOTO3690
3920 YV=ZA+(YX-1)'find formula to cap at gameLength to avoid next if
3930 IFYV>ZD-1THENYV=ZD-1
3940 IFYX=8THENYW=7:YU=8:YT=8:YS=1:ELSEYW=15:YU=32:YT=16:YS=2
3950 IFXR=1THENPOKEYH+0,YU:A=USR0(0)
3960 IFXR=2THENPOKEYH+0,YU:POKEYH+1,&H00:POKEYH+2,&H40:POKEYH+3,&H00:A=USR1(0)
3970 IFXR=3ANDNOTYGTHENPOKEYH+0,YU:A=USR5(0)
3980 IFXR=4ANDNOTYGTHENPOKEYH+0,YU:A=USR4(0)
3990 IFXR=5ANDNOTYGTHENPOKEYH+0,YU:A=USR6(1)
4000 IFXR=6ANDNOTYGTHENPOKEYH+0,YU:A=USR6(0)
4010 IFXR=0THENFORI=ZATOYV:GET#1,I+1:VPOKE1024-ZE+I,VPEEK(1024-ZE+I)XOR255:A$=ZJ$:VPOKE&H0040+I-ZA,ASC(A$):VPOKE1024-ZE+I,ASC(A$):NEXT
4020 POKEYH+0,YS:POKEYH+1,YT:A=USR3(0)
4030 RETURN
4040 ZU=FNZZ(ZU)
4050 ZT=FNZZ(ZT)
4060 VPOKE8193,ZU*16+ZT
4070 RETURN
4080 XO=VPEEK((XQ+14)+(XP+2)*32+6144)
4090 XO=(228+16)-XO
4100 VPOKE(XQ+14)+(XP+2)*32+6144,XO
4110 XN=XP:IFXQ>7THENXN=XP+16
4120 VPOKE&H0040+XN,2^(7-(XQMOD8))XORVPEEK(&H0040+XN)
4130 RETURN
4140 YV=ZA+(YX-1)'find formula to cap at gameLength to avoid next if
4150 IFYV>ZD-1THENYV=ZD-1
4160 FORI=ZATOYV
4170 XM=1024-ZE+I
4180 XL=VPEEK(&H0040+I-ZA)
4190 VPOKEXM,VPEEK(XM)XOR255
4200 A$=CHR$(XL)
4210 LSETZJ$=A$:PUT#1,I+1
4220 VPOKEXM,XL
4230 NEXT
4240 RETURN
4250 CLS
4260 LOCATE00,0:PRINT"  CHANGE GRAPH KIT WW "+LEFT$(YD$,8)
4270 LOCATE01,2:PRINT"XWWWWWWWWWWWWWWWWWWWY"
4280 LOCATE01,3:PRINT"VÄ ä î û ® ≤ º ∆ – ⁄V"
4290 LOCATE01,4:PRINT"V                   V"
4300 LOCATE01,5:PRINT"VÅ ã ï ü © ≥ Ω « — €V"
4310 LOCATE01,6:PRINT"V                   V"
4320 LOCATE01,7:PRINT"VÇ å ñ † ™ ¥ æ » “ ‹V"
4330 LOCATE01,8:PRINT"V                   V"
4340 LOCATE01,9:PRINT"VÉ ç ó ° ´ µ ø … ” ›V"
4350 LOCATE1,10:PRINT"V                   V"
4360 LOCATE1,11:PRINT"VÑ é ò ¢ ¨ ∂ ¿   ‘ ﬁV"
4370 LOCATE1,12:PRINT"V                   V"
4380 LOCATE1,13:PRINT"VÖ è ô £ ≠ ∑ ¡ À ’ ﬂV"
4390 LOCATE1,14:PRINT"V                   V"
4400 LOCATE1,15:PRINT"VÜ ê ö § Æ ∏ ¬ Ã ÷ ‡V"
4410 LOCATE1,16:PRINT"V                   V"
4420 LOCATE1,17:PRINT"Vá ë õ • Ø π √ Õ ◊ ·V"
4430 LOCATE1,18:PRINT"V                   V"
4440 LOCATE1,19:PRINT"Và í ú ¶ ∞ ∫ ƒ Œ ÿ ‚V"
4450 LOCATE1,20:PRINT"V                   V"
4460 LOCATE1,21:PRINT"Vâ ì ù ß ± ª ≈ œ Ÿ „V"
4470 LOCATE1,22:PRINT"ZWWWWWWWWWWWWWWWWWWW["
4480 LOCATE23,03:PRINT"VOV Ovrw"
4490 LOCATE23,21:PRINT"VEV Back"
4500 VPOKE6912,200:VPOKE6916,200
4510 VPOKE6920,200:VPOKE6928,200
4520 IFZRTHENGOSUB4870
4530 A$=INKEY$
4540 IFA$="O"THENGOSUB4690
4550 IFA$=CHR$(&H1C)ANDYR<9ANDZRTHENYR=YR+1:GOSUB4620
4560 IFA$=CHR$(&H1D)ANDYR>0ANDZRTHENYR=YR-1:GOSUB4620
4570 IFA$=CHR$(&H1E)ANDYQ>0ANDZRTHENYQ=YQ-1:GOSUB4620
4580 IFA$=CHR$(&H1F)ANDYQ<9ANDZRTHENYQ=YQ+1:GOSUB4620
4590 IFA$=CHR$(&H0D)ANDZRTHENZE=(YQ*YO)+(YR*(YO*10)):ZQ=-1:ZA=ZE:YZ=16:YY=23:IFZE+799>ZDTHENZE=ZD-799:YZ=16:YY=23:ZA=ZE:1600ELSE1600
4600 IFA$="E"THEN1600
4610 GOTO4530
4620 VPOKE6912,(YQ+1)*16+6:VPOKE6913,(YR+1)*16
4630 VPOKE6916,(YQ+1)*16+14:VPOKE6917,(YR+1)*16
4640 YM=(YQ*YO)+(YR*(YO*10))
4650 IFYM+799>ZDTHENYM=ZD-799
4660 LOCATE27,13:PRINTSTRING$(4-LEN(HEX$(YM)),"0")+HEX$(YM)
4670 LOCATE27,15:PRINTSTRING$(4-LEN(HEX$(YM+799)),"0")+HEX$(YM+799)
4680 RETURN
4690 YP=0
4700 ZR=-1
4710 YO=(ZD/100)
4720 YN=(9*YO)+(9*(YO*10))+8
4730 LOCATE2,02:PRINT"WWWWWWWSCANWWWWWWWW"
4740 LOCATE2,22:PRINT"WWWWWWVÈVStopWWWWWW"
4750 FORF=1TOYNSTEPYO
4760 FORI=FTOF+7
4770 VPOKE1024+YP,VPEEK(1024+YP)XOR255
4780 GET#1,I+1
4790 A$=ZJ$
4800 VPOKE1024+YP,ASC(A$)
4810 YP=YP+1
4820 IFINKEY$=" "THENF=YN+1:I=F+8
4830 NEXT
4840 NEXT
4850 GOSUB4870
4860 RETURN
4870 VPOKE6912,(YQ+1)*16+6:VPOKE6913,(YR+1)*16
4880 VPOKE6916,(YQ+1)*16+14:VPOKE6917,(YR+1)*16
4890 LOCATE23,05:PRINT"VÍV Move"
4900 LOCATE23,07:PRINT"VËV Go"
4910 LOCATE23,11:PRINT"Region"
4920 YM=(YQ*YO)+(YR*(YO*10))
4930 IFYM+799>ZDTHENYM=ZD-799
4940 LOCATE23,13:PRINT"St# "+STRING$(4-LEN(HEX$(YM)),"0")+HEX$(YM)
4950 LOCATE23,15:PRINT"Ed# "+STRING$(4-LEN(HEX$(YM+799)),"0")+HEX$(YM+799)
4960 LOCATE02,2:PRINT"WWWWWWWWWWWWWWWWWWW"
4970 LOCATE2,22:PRINT"WWWWWWWWWWWWWWWWWWW"
4980 RETURN
4990 X=5:Y=10:W=21:H=2:GOSUB5070
5000 POKEYH+0,ZN:POKEYH+1,ZM:POKEYH+2,ZL:POKEYH+3,ZK:A=USR2(0)
5010 LOCATE5,10:PRINT"XWWWWWWWWWWWWWWWWWWWY"
5020 LOCATE5,11:PRINT"VAre you sure? (Y/N)V"
5030 LOCATE5,12:PRINT"ZWWWWWWWWWWWWWWWWWWW["
5040 A$=INKEY$:IFA$<>"Y"ANDA$<>"N"THEN5040
5050 IFA$="N"THENPOKEYH+0,ZN:POKEYH+1,ZM:POKEYH+2,ZL:POKEYH+3,ZK:A=USR2(1):RETURN2170
5060 RETURN
5070 S=&H1800
5080 ZN=FNYF(X,Y,S):ZM=FNYE(X,Y,S)
5090 ZL=W+1:ZK=H+1
5100 IFYGTHENS=0:ZL=FNYF(W,H,S):ZK=FNYE(W,H,S)
5110 RETURN
5120 ' Error Handling Routines
5130 IFERR=53ANDYK=2THEN5360
5140 IFERR=56ANDYK=2THEN5360
5150 IFERR=55ANDYK=4THENYK=0:YJ=0:YI$="CONFIG FILE CORRUPTED":RESUME2690
5160 IFERR=53ANDYK=4THENYK=0:YJ=0:YI$="CONFIG FILE NOT FOUND":RESUME2690
5170 IFERR=53ANDYK=3THENYK=0:RESUME490
5180 IF(ERR=53ANDYK=1)ORERR=70THEN5300
5190 XK=ERR:IFXK>25THENXK=XK-24
5200 LOCATE0,20:PRINTCHR$(&H0D)
5210 FORF=YL(XK)+1TOYL(XK+1)-1:PRINTCHR$(PEEK(&H3D75+F));
5220 NEXT
5230 PRINT" (";RIGHT$(STR$(ERR),LEN(STR$(ERR))-1);") at";ERL;CHR$(&H07)
5240 CLOSE
5250 STOPOFF
5260 ONERRORGOTO0
5270 LOCATE0,20:PRINTCHR$(&H0D)
5280 PRINT"Break";CHR$(&H07)
5290 END
5300 PRINT:PRINT"No files found"
5310 PRINT:PRINT"Press space to restart"
5320 IFINKEY$<>" "THEN5320
5330 YK=0
5340 CLS
5350 RESUME700
5360 PRINT:PRINT
5370 IFERR=53THENPRINTYD$;" not found"
5380 IFERR=56THENPRINT"Invalid name"
5390 PRINT:PRINT"Press space to restart"
5400 IFINKEY$<>" "THEN5400
5410 YK=0
5420 RESUME700
5430 ' Error Messages in ROM
5440 DATA0,13,26,43,52,66,75,89,110,132,147
5450 DATA164,178,192,210,223,239,253,271,287
5460 DATA304,311,328,344,359,371,383,396,410
5470 DATA429,444,459,475,501,520,531
5480 DATA0,17,30,51,63,85,94,108,130,153,173
5490 DATA190,205,219,239,255,282,297,321,338
5500 DATA351,361,382,400,416,437,452,467,483
5510 DATA498,516,531,545,570,590,604
5520 ' ML Routines at 0xd000. ASM Source on GitHub
5530 DATA00,00,00,00,00,00,00,00,c3,14,da,c3,27,da,c3,35
5540 DATAda,c3,5a,da,3a,00,da,47,21,40,00,cd,4a,00,ee,ff
5550 DATAcd,4d,00,23,10,f5,c9,3a,f8,f7,ed,4b,00,da,2a,02
5560 DATAda,cd,56,00,c9,3a,f8,f7,fe,00,ca,4c,da,ed,4b,02
5570 DATAda,ed,5b,00,da,21,93,da,cd,5c,00,c9,ed,4b,02,da
5580 DATA11,93,da,2a,00,da,cd,59,00,c9,11,40,00,21,4e,18
5590 DATA3a,00,da,47,c5,3a,01,da,47,c5,eb,cd,4a,00,eb,06
5600 DATA08,17,f5,38,1a,3e,10,cd,4d,00,f1,23,10,f3,13,d5
5610 DATA11,18,00,19,d1,c1,10,e1,21,56,18,c1,10,d6,c9,3e
5620 DATAe4,18,e4
5630 ' Character Shapes
5640 DATA255,128,128,128,128,128,128,255
5650 DATA255,0,0,0,0,0,0,255
5660 DATA255,1,1,1,1,1,1,255
5670 DATA255,129,129,129,129,129,129,255
5680 DATA255,255,255,255,255,255,255,255
5690 DATA0,126,126,126,126,126,126,0
5700 DATA4,4,36,100,252,96,32,0
5710 DATA0,0,219,154,82,211,0,0
5720 DATA231,195,165,24,24,165,195,231
5730 ' Sprite Shapes
5740 DATA255,129,0,0,0,0,0,0
5750 DATA129,255,0,0,0,0,0,0
5760 DATA0,128,128,128,128,128,128,0
5770 DATA255,129,129,129,129,129,129,255
