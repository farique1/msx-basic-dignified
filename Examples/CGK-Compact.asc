10 'Converted with MSX Basic Dignified
20 'https://github.com/farique1/msx-basic-dignified
30 ' CHANGE GRAPH KIT
40 ' v1.5.1
50 ' Edit uncompressed graphics on MSX binary files on disk
60 '
70 ' New
80 '   External .com file ML routines, keeping a simplified version on DATA as a fall back
90 '     New, exclusive in the .com: rotate, slide(move), flip and improved copy to VRAM
100 '   Better ML DEFINE calls using the new Dignified DEFINEs variables
110 '   Streamlined initialization sequence ML routines and error text only load once
120 '   New mini preview area with Copy and Paste and the editing area address
130 '   Small layout changes with file name now on top line and more space for the step text
140 '   Configuration can now be saved and is automatically load at the start. Color only
150 '   Option to scan only the area under the cursor
160 '   Better region map calculation
170 '   Better overview region location report
180 '   Game addresses now starts at position 0 not position 1
190 '   Cursor cannot go or stay beyond game length anymore
200 '   Files now have a minimum limit of 800 bytes to be loaded
210 '   Fixed bug (bad coding) leaking memory on the overview display
220 '	Converted 0 - 1 variables to the new Dignified TRUE - FALSE
230 '   Small code optimizations
240 '
250 ' Copyright (1984 - 2019) - Fred Rique (farique)
260 ' https://github.com/farique1/Change-Graph-Kit
270 '
280 CLEAR200,&HDA00
290 DEFINTA-Z:MAXFILES=2
300 ONSTOPGOSUB5230:STOPON
310 ONERRORGOTO5150
320 YT=0
330 YS=-1
340 ZY=1:ZX=15:ZW=2:ZV=6:ZU=2:ZT=1
350 GOSUB2680
360 SCREEN0:COLORZX,ZY,ZY:WIDTH40:KEYOFF
370 LOCATE14,11:PRINT"INITIALIZING"
380 LOCATE14,13:PRINT" ERROR MSGS "
390 DIMYR(36)
400 ' Using the time format in ROM to determine language
410 IF(PEEK(&H2B)AND112)=32THENRESTORE5410ELSERESTORE5450
420 FORF=1TO36:READA:YR(F)=A:NEXT
430 LOCATE14,13:PRINT" ML SUPPORT "
440 YQ=&HDA00
450 YT=3
460 BLOAD"CGKTools.com"
470 YP=0
480 RESTORE5610
490 GOTO550
500 LOCATE8,8:PRINT" CGKTools.bin not found"
510 LOCATE8,9:PRINT"Using internal fall back"
520 RESTORE5500
530 FORF=0TO146:READA$:LOCATE18,15:PRINT147-F:POKEYQ+F,VAL("&h"+A$):NEXT:LOCATE18,15:PRINT"   "
540 YP=-1
550 DEFUSR0=YQ+&H08' invert_VRAM 		v0=len
560 DEFUSR1=YQ+&H0B' fill_VRAM 		v0-v1=len v2-v3=srt usr(ptrn)
570 DEFUSR2=YQ+&H0E' copy_VRAM 		v0-v1=VRAM v2=width v3=height usr(direc)
580 DEFUSR3=YQ+&H11' populate_edit 	v0=col_len v1=lin_len
590 DEFUSR4=YQ+&H14' flip_VRAM		 	v0=len
600 DEFUSR5=YQ+&H17' rotate_VRAM	 	v0=len
610 DEFUSR6=YQ+&H1A' slide_VRAM	 	v0=len usr(direc)
620 DEFFNYO(X,Y,S)=(X+S+(Y*32))MOD256
630 DEFFNYN(X,Y,S)=INT((X+S+(Y*32))/256)
640 SCREEN0:WIDTH40
650 DEFFNZZ(X)=ABS(XMOD16+16)MOD16
660 ZS=0:ZR=0:ZQ=0:ZP=0
670 YM$=""' leave blank to enable file request
680 YL$=".bin"' leave blank to all
690 IFYL$=""THENYL$=".*"
700 IFYM$<>""GOTO1270
710 CLS
720 YT=1
730 LOCATE14,8:PRINT"Insert disk"
740 LOCATE11,10:PRINT"and press any key"
750 IFNOTYSTHENLOCATE9,18:PRINT"CONFIG FILE NOT FOUND"
760 A$=INKEY$:IFA$=""GOTO760
770 CLS
780 FILES"*"+YL$
790 PRINT:PRINT
800 PRINT":Load":PRINT":ARROWS choose:ENTER select:SPACE type";
810 FORF=0TO24
820 YK=0+40*F
830 IFCHR$(VPEEK(YK))=":"THENYJ=F-1
840 NEXT
850 X=12:Y=0
860 YK=X+40*Y
870 GOSUB1100
880 A$=INKEY$
890 LOCATEX,Y:PRINT"<"
900 LOCATEX,Y:PRINT" "
910 IFA$=""THEN880
920 LOCATEX,Y:PRINT" "
930 PX=X:PY=Y
940 IFA$=CHR$(&H1C)THENX=X+13:GOSUB1030
950 IFA$=CHR$(&H1D)THENX=X-13:GOSUB1030
960 IFA$=CHR$(&H1E)THENY=Y-1:GOSUB1030
970 IFA$=CHR$(&H1F)THENY=Y+1:GOSUB1030
980 IFA$=CHR$(&H0D)THENGOSUB1250
990 IFA$=" "GOTO1210
1000 LOCATEX,Y:PRINT"<"
1010 GOSUB1100
1020 GOTO880
1030 IFX>=39THENX=12
1040 IFX<=0THENX=38
1050 IFY<=0THENY=0
1060 IFY>=24THENY=24
1070 YK=X+40*Y
1080 IFVPEEK(YK-12)=32THENX=PX:Y=PY:YK=X+40*Y
1090 RETURN
1100 YI=0
1110 YM$=""
1120 YH$=""
1130 LOCATE6,YJ:PRINT"            "
1140 FORF=YK-12TOYK-1
1150 YH$=CHR$(VPEEK(F))
1160 YM$=YM$+YH$
1170 LOCATE6+YI,YJ:PRINTYH$
1180 YI=YI+1
1190 NEXT
1200 RETURN
1210 YT=2
1220 LOCATE6,YJ:?"            "
1230 LOCATE6,YJ:LINEINPUTYM$
1240 IFYM$=""THENGOSUB1100:GOTO880
1250 LOCATE39,YJ+1:PRINT
1260 FILESYM$
1270 CLS:SCREEN1:WIDTH32
1280 POKEYQ+0,&H20:POKEYQ+1,&H03:POKEYQ+2,&H00:POKEYQ+3,&H04:A=USR1(0)
1290 VPOKE6914,0:VPOKE6918,1:VPOKE6922,2:VPOKE6926,3:VPOKE6930,2
1300 LOCATE10,11:PRINT"INITIALIZING"
1310 LOCATE10,13:PRINT"    GAME    "
1320 OPENYM$AS#1LEN=1
1330 FIELD#1,1ASZJ$
1340 GET#1,3:ZI$=ZJ$:GET#1,2:ZH$=ZJ$:ZG=(ASC(ZI$)*256+ASC(ZH$))-65535!
1350 GET#1,5:ZI$=ZJ$:GET#1,4:ZH$=ZJ$:ZF=(ASC(ZI$)*256+ASC(ZH$))-65535!
1360 YG=ZF-ZG-1
1370 YF=0:YE=8:YD=800:ZS=-1
1380 YC=YF:YB=16:YA=23:XZ=32
1390 IFYG<800THENCLOSE:GOTO5110
1400 LOCATE10,13:PRINT"   SHAPES   "
1410 LOCATE15,15:PRINT"06"
1420 FORF=0TO23:READA:VPOKE&H0008+F,A:NEXT:LOCATE15,15:PRINT"05"
1430 FORF=0TO7:READA:VPOKE&H0080+F,A:NEXT:LOCATE15,15:PRINT"04"
1440 FORF=0TO7:READA:VPOKE&H00F8+F,A:NEXT:LOCATE15,15:PRINT"03"
1450 FORF=0TO7:READA:VPOKE&H0720+F,A:NEXT:LOCATE15,15:PRINT"02"
1460 FORF=0TO23:READA:VPOKE&H0740+F,A:NEXT:LOCATE15,15:PRINT"01"
1470 FORF=0TO31:READA:VPOKE&H3800+F,A:NEXT:LOCATE15,15:PRINT"00"
1480 POKEYQ+0,&H20:POKEYQ+1,&H00:POKEYQ+2,&H60:POKEYQ+3,&H00:A=USR1(0)
1490 LOCATE10,13:PRINT"   COLORS   "
1500 GOSUB2420
1510 CLS
1520 LOCATE0,0:PRINT"  CHANGE GRAPH KIT WW "+LEFT$(YM$,8)
1530 LOCATE1,2:PRINT"XWWWWWWWWWWY"
1540 LOCATE1,3:PRINT"VÄäîû®≤º∆–⁄V"
1550 LOCATE1,4:PRINT"VÅãïü©≥Ω«—€V"
1560 LOCATE1,5:PRINT"VÇåñ†™¥æ»“‹V"
1570 LOCATE1,6:PRINT"VÉçó°´µø…”›V"
1580 LOCATE1,7:PRINT"VÑéò¢¨∂¿ ‘ﬁV"
1590 LOCATE1,8:PRINT"VÖèô£≠∑¡À’ﬂV"
1600 LOCATE1,9:PRINT"VÜêö§Æ∏¬Ã÷‡V"
1610 LOCATE1,10:PRINT"Váëõ•Øπ√Õ◊·V"
1620 LOCATE1,11:PRINT"Vàíú¶∞∫ƒŒÿ‚V"
1630 LOCATE1,12:PRINT"Vâìùß±ª≈œŸ„V"
1640 LOCATE1,13:PRINT"ZWWWWWWWWWW["
1650 LOCATE3,15:PRINT"Srt# End#"
1660 LOCATE1,17:PRINT"C"
1670 LOCATE3,17:PRINTSTRING$(4-LEN(HEX$(YC)),"0")+HEX$(YC)
1680 LOCATE8,17:PRINTSTRING$(4-LEN(HEX$(YC+(XZ-1))),"0")+HEX$(YC+(XZ-1))
1690 LOCATE1,19:PRINT"R"
1700 LOCATE3,19:PRINTSTRING$(4-LEN(HEX$(YF)),"0")+HEX$(YF)
1710 LOCATE8,19:PRINTSTRING$(4-LEN(HEX$(YF+799)),"0")+HEX$(YF+799)
1720 LOCATE1,21:PRINT"G"
1730 LOCATE3,21:PRINTSTRING$(4-LEN(HEX$(0)),"0")+HEX$(0)
1740 LOCATE8,21:PRINTSTRING$(4-LEN(HEX$(YG)),"0")+HEX$(YG)
1750 LOCATE13,2:PRINT"XWWWWWWWWWWWWWWWWY"
1760 LOCATE13,3:PRINT"VCursor Stp #   "+RIGHT$(STR$(YE),1)+"V"
1770 LOCATE13,4:PRINT"VRegion Stp # "+RIGHT$(HEX$(YD),3)+"V"
1780 LOCATE13,5:PRINT"ZWWWWWWWWWWWWWWWW["
1790 ONZPGOTO1880
1800 LOCATE13,7:PRINT"VÍVMove VËVEdit   "
1810 LOCATE13,9:PRINT"VÈVStep VDVSize   "
1820 LOCATE13,11:PRINT"VBVClearVRVRefresh"
1830 LOCATE13,13:PRINT"VTVScan und cursor "
1840 LOCATE13,15:PRINT"VFVFreeze/Unfreeze"
1850 LOCATE13,17:PRINT"VEVExplode/Ovrview"
1860 LOCATE13,19:PRINT"                  "
1870 GOTO1950
1880 LOCATE13,7:PRINT"VNVNew  VPVExit  "
1890 LOCATE13,9:PRINT"VQVPrev VWVNext   "
1900 LOCATE13,11:PRINT"VAVP 4x VSVN 4x   "
1910 LOCATE13,13:PRINT"VZVSrtVXVMidVCVEnd"
1920 LOCATE13,15:PRINT"VK LVCfg Save Load"
1930 LOCATE13,17:PRINT"V1-8VChange Colors"
1940 LOCATE13,19:PRINT"                  "
1950 LOCATE13,19:PRINT"      VMVMore Keys"
1960 LOCATE13,21:PRINT"ABBBBBBBBBBBBBBBBC"
1970 GOSUB3110
1980 IFZR=-1THENLOCATE2,13:PRINT"WOverviewW"
1990 XY=YA+(XZ-2):XX=0
2000 IFYA+(XZ-2)>101THENXX=8:XY=23+(YA+(XZ-2))-103
2010 IFYB+XX>95THENXY=200
2020 VPOKE6912,YA-1:VPOKE6913,YB
2030 VPOKE6916,XY+1:VPOKE6917,XX+YB
2040 XW=YF/(YG/141)+105
2050 VPOKE6920,167:VPOKE6921,XW
2060 VPOKE6928,167:VPOKE6929,XW+(141/(YG/800))
2070 IFZQTHENZQ=0:GOSUB2930
2080 A$=INKEY$
2090 IFA$=CHR$(&H1C)AND(YB+8<95)AND(YC+XZ-2+80<YG)THENYB=YB+8:YC=YC+80:GOSUB2770
2100 IFA$=CHR$(&H1D)AND(YB-8>15)THENYB=YB-8:YC=YC-80:GOSUB2770
2110 IFA$=CHR$(&H1E)AND(YA-YE>22)THENYA=YA-YE:YC=YC-YE:GOSUB2770
2120 IFA$=CHR$(&H1F)AND(YA+YE<103)AND(YC+XZ-2+YE<YG)THENYA=YA+YE:YC=YC+YE:GOSUB2770
2130 IFA$="1"THENZY=ZY-1:GOSUB2420
2140 IFA$="2"THENZY=ZY+1:GOSUB2420
2150 IFA$="3"THENZX=ZX-1:GOSUB2420
2160 IFA$="4"THENZX=ZX+1:GOSUB2420
2170 IFA$="5"THENZW=ZW-1:GOSUB2420
2180 IFA$="6"THENZW=ZW+1:GOSUB2420
2190 IFA$="7"THENZV=ZV-1:GOSUB2420
2200 IFA$="8"THENZV=ZV+1:GOSUB2420
2210 IFA$=CHR$(13)GOTO3180
2220 IFA$="E"GOTO4230
2230 IFA$="D"THENGOSUB2850
2240 IFA$=" "THENGOSUB3140
2250 IFA$="R"THENXV=0:GOSUB3060
2260 IFA$="M"THENZP=ABS(ZP-1):GOTO1790
2270 IFA$="B"THENPOKEYQ+0,&H20:POKEYQ+1,&H03:POKEYQ+2,&H00:POKEYQ+3,&H04:A=USR1(0)
2280 IFA$="N"THENGOSUB4960:CLOSE:RESTORE5610:GOTO640
2290 IFA$="P"THENGOSUB4960:CLOSE:CLEAR:SCREEN0:WIDTH40:COLOR15,5,5:NEW
2300 IFA$="K"THENGOSUB2570
2310 IFA$="L"THENGOSUB2680:GOSUB2420
2320 IFA$="T"THENGOSUB2730
2330 IFA$="Q"THENXV=YC-YF:YF=YF-YD:GOSUB2930
2340 IFA$="W"THENXV=YC-YF:YF=YF+YD:GOSUB2930
2350 IFA$="A"THENXV=YC-YF:YF=YF-YD*4:GOSUB2930
2360 IFA$="S"THENXV=YC-YF:YF=YF+YD*4:GOSUB2930
2370 IFA$="Z"THENXV=YC-YF:YF=&H00:GOSUB2930
2380 IFA$="X"THENXV=YC-YF:YF=(YG/2)-400:GOSUB2930
2390 IFA$="C"THENXV=YC-YF:YF=YG-799:GOSUB2930
2400 IFA$="F"THENXV=0:ZS=NOTZS:IFZSTHENGOSUB3110:ELSE:GOSUB3060
2410 GOTO2080
2420 ZY=FNZZ(ZY)
2430 ZX=FNZZ(ZX)
2440 ZW=FNZZ(ZW)
2450 ZV=FNZZ(ZV)
2460 ZU=FNZZ(ZW)
2470 ZT=FNZZ(ZY)
2480 COLORZX,ZY,ZY
2490 VPOKE8194,ZV*16+ZY
2500 VPOKE8195,ZV*16+ZY
2510 VPOKE8192,ZV*16+ZW
2520 VPOKE8193,ZW*16+ZY
2530 VPOKE6915,ZX:VPOKE6919,ZX
2540 VPOKE6923,ZX:VPOKE6927,ZX:VPOKE6931,ZX
2550 FORF=0TO12:VPOKE8208+F,ZW*16+ZY:NEXT
2560 RETURN
2570 X=12:Y=10:W=8:H=2
2580 GOSUB5060
2590 POKEYQ+0,ZN:POKEYQ+1,ZM:POKEYQ+2,ZL:POKEYQ+3,ZK:A=USR2(0)
2600 LOCATE12,10:PRINT"XWWWWWWY"
2610 LOCATE12,11:PRINT"VSAVINGV"
2620 LOCATE12,12:PRINT"ZWWWWWW[
2630 OPEN"CGKConf.cfg"FOROUTPUTAS#2
2640 PRINT#2,ZY,ZX,ZW,ZV,ZU,ZT
2650 CLOSE#2
2660 POKEYQ+0,ZN:POKEYQ+1,ZM:POKEYQ+2,ZL:POKEYQ+3,ZK:A=USR2(1)
2670 RETURN
2680 YT=4
2690 OPEN"CGKConf.cfg"FORINPUTAS#2
2700 INPUT#2,ZY,ZX,ZW,ZV,ZU,ZT
2710 CLOSE#2
2720 RETURN
2730 ZD=YC+(XZ-1)'find formula to cap at gameLength to avoid next if
2740 IFZD>YG-1THENZD=YG-1
2750 FORI=YCTOZD:GET#1,I+1:VPOKE1024-YF+I,VPEEK(1024-YF+I)XOR255:A$=ZJ$:VPOKE1024-YF+I,ASC(A$):NEXT
2760 RETURN
2770 XY=YA+(XZ-2):XX=0
2780 IFYA+(XZ-2)>101THENXX=8:XY=23+(YA+(XZ-2))-103
2790 IFYB+XX>95THENXY=200
2800 VPOKE6912,YA-1:VPOKE6913,YB
2810 VPOKE6916,XY+1:VPOKE6917,YB+XX
2820 LOCATE3,17:PRINTSTRING$(4-LEN(HEX$(YC)),"0")+HEX$(YC)
2830 LOCATE8,17:PRINTSTRING$(4-LEN(HEX$(YC+(XZ-1))),"0")+HEX$(YC+(XZ-1))
2840 RETURN
2850 IFXZ=32THENXZ=8ELSEIFYC+XZ+22<YGTHENXZ=32ELSERETURN
2860 XY=YA+(XZ-2):XX=0
2870 IFYA+(XZ-2)>101THENXX=8:XY=23+(YA+(XZ-2))-103
2880 IFYB+XX>95THENXY=200
2890 VPOKE6916,XY+1:VPOKE6917,YB+XX
2900 LOCATE3,17:PRINTSTRING$(4-LEN(HEX$(YC)),"0")+HEX$(YC)
2910 LOCATE8,17:PRINTSTRING$(4-LEN(HEX$(YC+(XZ-1))),"0")+HEX$(YC+(XZ-1))
2920 RETURN
2930 IFYF<0THENYF=0
2940 IFYF+799>YGTHENYF=YG-799
2950 YC=YF+XV
2960 XW=YF/(YG/141)+105
2970 VPOKE6920,167:VPOKE6921,XW
2980 VPOKE6928,167:VPOKE6929,XW+(141/(YG/800))
2990 LOCATE3,17:PRINTSTRING$(4-LEN(HEX$(YC)),"0")+HEX$(YC)
3000 LOCATE8,17:PRINTSTRING$(4-LEN(HEX$(YC+7)),"0")+HEX$(YC+7)
3010 LOCATE3,19:PRINTSTRING$(4-LEN(HEX$(YF)),"0")+HEX$(YF)
3020 LOCATE8,19:PRINTSTRING$(4-LEN(HEX$(YF+799)),"0")+HEX$(YF+799)
3030 IFYC+XZ>YGTHENYA=103-XZ:YB=95-7:YC=YG-XZ+1:GOSUB2770
3040 IFNOTZSTHEN3060
3050 RETURN
3060 ZR=0
3070 LOCATE2,2:PRINT"WWWSCANWWW"
3080 LOCATE2,13:PRINT"WVÈVStopWW"
3090 FORF=YFTOYF+799
3100 VPOKE1024-YF+F,VPEEK(1024-YF+F)XOR255:GET#1,F+1:A$=ZJ$:VPOKE1024-YF+F,ASC(A$):IFINKEY$=" "THEN3110ELSENEXT
3110 IFZSTHENLOCATE2,2:PRINT"WWFREEZEWW"ELSELOCATE2,2:PRINT"WWWWWWWWWW"
3120 LOCATE2,13:PRINT"WWWWWWWWWW"
3130 RETURN
3140 IFYE=8THENYE=1ELSEYE=8
3150 IFYD=800THENYD=400ELSEYD=800
3160 LOCATE29,3:PRINTRIGHT$(HEX$(YE),1):LOCATE27,4:PRINTRIGHT$(HEX$(YD),3)
3170 RETURN
3180 CLS
3190 VPOKE6920,200:VPOKE6928,200
3200 POKEYQ+0,&H20:POKEYQ+1,&H00:POKEYQ+2,&H40:POKEYQ+3,&H00:A=USR1(0)
3210 LOCATE0,0:PRINT"  CHANGE GRAPH KIT WW "+LEFT$(YM$,8)
3220 LOCATE1,2:PRINT"XWWWWWWWWWWY"
3230 LOCATE1,3:PRINT"VÄäîû®≤º∆–⁄V"
3240 LOCATE1,4:PRINT"VÅãïü©≥Ω«—€V"
3250 LOCATE1,5:PRINT"VÇåñ†™¥æ»“‹V"
3260 LOCATE1,6:PRINT"VÉçó°´µø…”›V"
3270 LOCATE1,7:PRINT"VÑéò¢¨∂¿ ‘ﬁV"
3280 LOCATE1,8:PRINT"VÖèô£≠∑¡À’ﬂV"
3290 LOCATE1,9:PRINT"VÜêö§Æ∏¬Ã÷‡V"
3300 LOCATE1,10:PRINT"Váëõ•Øπ√Õ◊·V"
3310 LOCATE1,11:PRINT"Vàíú¶∞∫ƒŒÿ‚V"
3320 LOCATE1,12:PRINT"Vâìùß±ª≈œŸ„V"
3330 LOCATE1,13:PRINT"ZWWWWWWWWWW["
3340 LOCATE1,14:PRINT"XWWRWWWWRWWY"
3350 LOCATE1,15:PRINT"VHJV    VLNV"
3360 LOCATE1,16:PRINT"VIKV    VMOV"
3370 LOCATE1,17:PRINT"ZWWQWWWWQWW["
3380 LOCATE5,15:PRINTSTRING$(4-LEN(HEX$(YC)),"0")+HEX$(YC)
3390 LOCATE5,16:PRINTSTRING$(4-LEN(HEX$(YC+(XZ-1))),"0")+HEX$(YC+(XZ-1))
3400 LOCATE14,2:PRINT"________________"
3410 LOCATE14,3:PRINT"________________"
3420 LOCATE14,4:PRINT"________________"
3430 LOCATE14,5:PRINT"________________"
3440 LOCATE14,6:PRINT"________________"
3450 LOCATE14,7:PRINT"________________"
3460 LOCATE14,8:PRINT"________________"
3470 LOCATE14,9:PRINT"________________"
3480 LOCATE14,10:PRINT"________________"
3490 LOCATE14,11:PRINT"________________"
3500 LOCATE14,12:PRINT"________________"
3510 LOCATE14,13:PRINT"________________"
3520 LOCATE14,14:PRINT"________________"
3530 LOCATE14,15:PRINT"________________"
3540 LOCATE14,16:PRINT"________________"
3550 LOCATE14,17:PRINT"________________"
3560 VPOKE6924,15:VPOKE6925,112
3570 IFYPTHENZO=0
3580 ONZOGOTO3620
3590 LOCATE01,19:PRINT"VCVCpyVVVPst"
3600 LOCATE01,21:PRINT"VMVKysV#VCor"
3610 GOTO3640
3620 LOCATE01,19:PRINT"VRVRotVTVHmv"
3630 LOCATE01,21:PRINT"VFVFlpVGVVmv"
3640 LOCATE13,19:PRINT"VEVErzVÈVTglVLVRld"
3650 LOCATE13,21:PRINT"VDVInvVSVSavVËVBck"
3660 IFXU=-1THENXU=0:GOTO3790
3670 XT=0:XS=0:XU=0
3680 ZD=YC+(XZ-1)'find formula to cap at gameLength to avoid next if
3690 IFZD>YG-1THENZD=YG-1
3700 IFXZ=8THENZE=7:ZC=8:ZB=8:ZA=1:ELSEZE=15:ZC=32:ZB=16:ZA=2
3710 IFXU=1THENPOKEYQ+0,ZC:A=USR0(0)
3720 IFXU=2THENPOKEYQ+0,ZC:POKEYQ+1,&H00:POKEYQ+2,&H40:POKEYQ+3,&H00:A=USR1(0)
3730 IFXU=3ANDNOTYPTHENPOKEYQ+0,ZC:A=USR5(0)
3740 IFXU=4ANDNOTYPTHENPOKEYQ+0,ZC:A=USR4(0)
3750 IFXU=5ANDNOTYPTHENPOKEYQ+0,ZC:A=USR6(1)
3760 IFXU=6ANDNOTYPTHENPOKEYQ+0,ZC:A=USR6(0)
3770 IFXU=0THENFORI=YCTOZD:GET#1,I+1:VPOKE1024-YF+I,VPEEK(1024-YF+I)XOR255:A$=ZJ$:VPOKE&H0040+I-YC,ASC(A$):VPOKE1024-YF+I,ASC(A$):NEXT
3780 POKEYQ+0,ZA:POKEYQ+1,ZB:A=USR3(0)
3790 A$=INKEY$
3800 IFA$=CHR$(&H1C)ANDXT<ZETHENXT=XT+1:VPOKE6925,112+(XT*8)
3810 IFA$=CHR$(&H1D)ANDXT>0THENXT=XT-1:VPOKE6925,112+(XT*8)
3820 IFA$=CHR$(&H1E)ANDXS>0THENXS=XS-1:VPOKE6924,15+(XS*8)
3830 IFA$=CHR$(&H1F)ANDXS<ZETHENXS=XS+1:VPOKE6924,15+(XS*8)
3840 IFA$="E"THENXU=2:GOTO3680
3850 IFA$="D"THENXU=1:GOTO3680
3860 IFA$="R"THENXU=3:GOTO3680
3870 IFA$="F"THENXU=4:GOTO3680
3880 IFA$="T"THENXU=5:GOTO3680
3890 IFA$="G"THENXU=6:GOTO3680
3900 IFA$="C"THENFORF=0TOZC-1:VPOKE&H0060+F,VPEEK(&H0040+F):NEXT
3910 IFA$="V"THENFORF=0TOZC-1:VPOKE&H0040+F,VPEEK(&H0060+F):NEXT:POKEYQ+0,ZA:POKEYQ+1,ZB:A=USR3(0)
3920 IFA$=" "THENGOSUB4060
3930 IFA$="S"THENGOSUB4120
3940 IFA$="L"THENXU=0:GOTO3680
3950 IFA$="M"THENZO=ABS(ZO-1):XU=-1:GOTO3570
3960 IFA$="1"THENZU=ZU-1:GOSUB4020
3970 IFA$="2"THENZU=ZU+1:GOSUB4020
3980 IFA$="3"THENZT=ZT-1:GOSUB4020
3990 IFA$="4"THENZT=ZT+1:GOSUB4020
4000 IFA$=CHR$(13)THENVPOKE6924,200:GOTO1510
4010 GOTO3790
4020 ZU=FNZZ(ZU)
4030 ZT=FNZZ(ZT)
4040 VPOKE8193,ZU*16+ZT
4050 RETURN
4060 XR=VPEEK((XT+14)+(XS+2)*32+6144)
4070 XR=(228+16)-XR
4080 VPOKE(XT+14)+(XS+2)*32+6144,XR
4090 XQ=XS:IFXT>7THENXQ=XS+16
4100 VPOKE&H0040+XQ,2^(7-(XTMOD8))XORVPEEK(&H0040+XQ)
4110 RETURN
4120 ZD=YC+(XZ-1)'find formula to cap at gameLength to avoid next if
4130 IFZD>YG-1THENZD=YG-1
4140 FORI=YCTOZD
4150 XP=1024-YF+I
4160 XO=VPEEK(&H0040+I-YC)
4170 VPOKEXP,VPEEK(XP)XOR255
4180 A$=CHR$(XO)
4190 LSETZJ$=A$:PUT#1,I
4200 VPOKEXP,XO
4210 NEXT
4220 RETURN
4230 CLS
4240 LOCATE0,0:PRINT"  CHANGE GRAPH KIT WW "+LEFT$(YM$,8)
4250 LOCATE1,2:PRINT"XWWWWWWWWWWWWWWWWWWWY"
4260 LOCATE1,3:PRINT"VÄ ä î û ® ≤ º ∆ – ⁄V"
4270 LOCATE1,4:PRINT"V                   V"
4280 LOCATE1,5:PRINT"VÅ ã ï ü © ≥ Ω « — €V"
4290 LOCATE1,6:PRINT"V                   V"
4300 LOCATE1,7:PRINT"VÇ å ñ † ™ ¥ æ » “ ‹V"
4310 LOCATE1,8:PRINT"V                   V"
4320 LOCATE1,9:PRINT"VÉ ç ó ° ´ µ ø … ” ›V"
4330 LOCATE1,10:PRINT"V                   V"
4340 LOCATE1,11:PRINT"VÑ é ò ¢ ¨ ∂ ¿   ‘ ﬁV"
4350 LOCATE1,12:PRINT"V                   V"
4360 LOCATE1,13:PRINT"VÖ è ô £ ≠ ∑ ¡ À ’ ﬂV"
4370 LOCATE1,14:PRINT"V                   V"
4380 LOCATE1,15:PRINT"VÜ ê ö § Æ ∏ ¬ Ã ÷ ‡V"
4390 LOCATE1,16:PRINT"V                   V"
4400 LOCATE1,17:PRINT"Vá ë õ • Ø π √ Õ ◊ ·V"
4410 LOCATE1,18:PRINT"V                   V"
4420 LOCATE1,19:PRINT"Và í ú ¶ ∞ ∫ ƒ Œ ÿ ‚V"
4430 LOCATE1,20:PRINT"V                   V"
4440 LOCATE1,21:PRINT"Vâ ì ù ß ± ª ≈ œ Ÿ „V"
4450 LOCATE1,22:PRINT"ZWWWWWWWWWWWWWWWWWWW["
4460 LOCATE23,03:PRINT"VOV Ovrw"
4470 LOCATE23,21:PRINT"VEV Back"
4480 VPOKE6912,200:VPOKE6916,200
4490 VPOKE6920,200:VPOKE6928,200
4500 IFZRTHENGOSUB4830
4510 A$=INKEY$
4520 IFA$="O"THENGOSUB4670
4530 IFA$=CHR$(&H1C)ANDYZ<9ANDZRTHENYZ=YZ+1:GOSUB4600
4540 IFA$=CHR$(&H1D)ANDYZ>0ANDZRTHENYZ=YZ-1:GOSUB4600
4550 IFA$=CHR$(&H1F)ANDYY<9ANDZRTHENYY=YY+1:GOSUB4600
4560 IFA$=CHR$(&H1E)ANDYY>0ANDZRTHENYY=YY-1:GOSUB4600
4570 IFA$=CHR$(13)ANDZRTHENYF=(YY*YW)+(YZ*(YW*10)):ZQ=-1:YC=YF:YB=16:YA=23:IFYF+799>YGTHENYF=YG-799:YB=16:YA=23:YC=YF:GOTO1510ELSEGOTO1510
4580 IFA$="E"GOTO1510
4590 GOTO4510
4600 VPOKE6912,(YY+1)*16+6:VPOKE6913,(YZ+1)*16
4610 VPOKE6916,(YY+1)*16+14:VPOKE6917,(YZ+1)*16
4620 YU=(YY*YW)+(YZ*(YW*10))
4630 IFYU+799>YGTHENYU=YG-799
4640 LOCATE27,13:PRINTSTRING$(4-LEN(HEX$(YU)),"0")+HEX$(YU)
4650 LOCATE27,15:PRINTSTRING$(4-LEN(HEX$(YU+799)),"0")+HEX$(YU+799)
4660 RETURN
4670 YX=0
4680 ZR=-1
4690 YW=(YG/100)
4700 YV=(9*YW)+(9*(YW*10))+8
4710 LOCATE2,2:PRINT"WWWWWWWSCANWWWWWWWW"
4720 LOCATE2,22:PRINT"WWWWWVÈVStopWWWWWWW"
4730 FORF=1TOYVSTEPYW
4740 FORI=FTOF+7
4750 VPOKE1024+YX,VPEEK(1024+YX)XOR255
4760 GET#1,I+1
4770 A$=ZJ$
4780 VPOKE1024+YX,ASC(A$)
4790 IFINKEY$=" "THEN4830
4800 YX=YX+1
4810 NEXT
4820 NEXT
4830 VPOKE6912,(YY+1)*16+6:VPOKE6913,(YZ+1)*16
4840 VPOKE6916,(YY+1)*16+14:VPOKE6917,(YZ+1)*16
4850 LOCATE23,05:PRINT"VÍV Move"
4860 LOCATE23,07:PRINT"VËV Go"
4870 LOCATE23,11:PRINT"Region"
4880 YU=(YY*YW)+(YZ*(YW*10))
4890 IFYU+799>YGTHENYU=YG-799
4900 LOCATE23,13:PRINT"St# "+STRING$(4-LEN(HEX$(YU)),"0")+HEX$(YU)
4910 LOCATE23,15:PRINT"Ed# "+STRING$(4-LEN(HEX$(YU+799)),"0")+HEX$(YU+799)
4920 LOCATE02,2:PRINT"WWWWWWWWWWWWWWWWWWW"
4930 LOCATE2,22:PRINT"WWWWWWWWWWWWWWWWWWW"
4940 RETURN
4950 END
4960 X=5:Y=10:W=21:H=2
4970 GOSUB5060
4980 POKEYQ+0,ZN:POKEYQ+1,ZM:POKEYQ+2,ZL:POKEYQ+3,ZK:A=USR2(0)
4990 LOCATE5,10:PRINT"XWWWWWWWWWWWWWWWWWWWY"
5000 LOCATE5,11:PRINT"VAre you sure? (Y/N)V"
5010 LOCATE5,12:PRINT"ZWWWWWWWWWWWWWWWWWWW[
5020 A$=INKEY$:IFA$<>"Y"ANDA$<>"N"THEN5020
5030 IFA$="Y"THENRETURN
5040 POKEYQ+0,ZN:POKEYQ+1,ZM:POKEYQ+2,ZL:POKEYQ+3,ZK:A=USR2(1)
5050 RETURN2080
5060 S=&H1800
5070 ZN=FNYO(X,Y,S):ZM=FNYN(X,Y,S)
5080 ZL=W+1:ZK=H+1
5090 IFYPTHENS=0:ZL=FNYO(W,H,S):ZK=FNYN(W,H,S)
5100 RETURN
5110 LOCATE13,15:PRINT"Sorry":LOCATE0,16:PRINT"The game must be over 800 bytes":LOCATE5,17:PRINT"Press space to restart"
5120 A$=INKEY$:IFA$<>" "THEN5120
5130 SCREEN0
5140 GOTO710
5150 IFERR=53ANDYT=2GOTO5320
5160 IFERR=56ANDYT=2GOTO5320
5170 IFERR=53ANDYT=4THENYT=0:YS=0:RESUME2720
5180 IFERR=56ANDYT=3THENYT=0:RESUME500
5190 IF(ERR=53ANDYT=1)ORERR=70GOTO5250
5200 XN=ERR:IFXN>25THENXN=XN-24
5210 FORF=YR(XN)TOYR(XN+1):PRINTCHR$(PEEK(&H3D75+F));:NEXT
5220 PRINT" at";ERL
5230 CLOSE
5240 END
5250 PRINT:PRINT"No files found"
5260 PRINT:PRINT"Press space to restart"
5270 A$=INKEY$:IFA$=" "THENPRINTELSE5270
5280 YT=0
5290 CLS
5300 RESUME710
5310 ONERRORGOTO0
5320 PRINT:PRINT
5330 IFERR=53THENPRINTYM$;" not found"
5340 IFERR=56THENPRINT"Invalid name"
5350 PRINT:PRINT"Press space to restart"
5360 A$=INKEY$:IFA$=" "THENPRINTELSE5360
5370 YT=0
5380 RESUME710
5390 ONERRORGOTO0
5400 ' Error Messages in ROM
5410 DATA0,13,26,43,52,66,75,89,110,132,147
5420 DATA164,178,192,210,223,239,253,271,287
5430 DATA304,311,328,344,359,371,383,396,410
5440 DATA429,444,459,475,501,520,531
5450 DATA0,17,30,51,63,85,94,108,130,153,173
5460 DATA190,205,219,239,255,282,297,321,338
5470 DATA351,361,382,400,416,437,452,467,483
5480 DATA498,516,531
5490 ' ML Routines at 0xd000 ASM Source on GitHub
5500 DATA00,00,00,00,00,00,00,00,c3,14,da,c3,27,da,c3,35
5510 DATAda,c3,5a,da,3a,00,da,47,21,40,00,cd,4a,00,ee,ff
5520 DATAcd,4d,00,23,10,f5,c9,3a,f8,f7,ed,4b,00,da,2a,02
5530 DATAda,cd,56,00,c9,3a,f8,f7,fe,00,ca,4c,da,ed,4b,02
5540 DATAda,ed,5b,00,da,21,93,da,cd,5c,00,c9,ed,4b,02,da
5550 DATA11,93,da,2a,00,da,cd,59,00,c9,11,40,00,21,4e,18
5560 DATA3a,00,da,47,c5,3a,01,da,47,c5,eb,cd,4a,00,eb,06
5570 DATA08,17,f5,38,1a,3e,10,cd,4d,00,f1,23,10,f3,13,d5
5580 DATA11,18,00,19,d1,c1,10,e1,21,56,18,c1,10,d6,c9,3e
5590 DATAe4,18,e4
5600 ' Character Shapes
5610 DATA255,128,128,128,128,128,128,255
5620 DATA255,0,0,0,0,0,0,255
5630 DATA255,1,1,1,1,1,1,255
5640 DATA255,129,129,129,129,129,129,255
5650 DATA255,255,255,255,255,255,255,255
5660 DATA0,126,126,126,126,126,126,0
5670 DATA4,4,36,100,252,96,32,0
5680 DATA0,0,219,154,82,211,0,0
5690 DATA231,195,165,24,24,165,195,231
5700 ' Sprite Shapes
5710 DATA255,129,0,0,0,0,0,0
5720 DATA129,255,0,0,0,0,0,0
5730 DATA0,128,128,128,128,128,128,0
5740 DATA255,129,129,129,129,129,129,255
5750 ' Functions Not Used
5760 ' Create Character Block
5770 C=127
5780 FORX=2TO11
5790 FORY=3TO12
5800 C=C+1:LOCATEX,Y:PRINT:PRINTCHR$(C)
5810 NEXT
5820 NEXT
5830 END
5840 ' Character Map
5850 FORI=0TO255
5860 X=IMOD32:Y=I\32
5870 C=I
5880 IFC<32ORC=127THENC=32
5890 LOCATEX,Y:PRINTCHR$(C)
5900 LOCATEX,Y+10:PRINTCHR$(1)+CHR$(C)
5910 NEXT
5920 END
