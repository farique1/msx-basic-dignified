10 'Converted with MSX Basic Dignified
20 'https://github.com/farique1/msx-basic-dignified
30 ' CHANGE GRAPH KIT
40 ' v1.6.1
50 ' Edit uncompressed graphics on MSX binary files on disk
60 '
70 ' Copyright (C) 1984-2020 - Fred Rique (farique)
80 ' https://github.com/farique1/Change-Graph-Kit
90 '
100 ' New
110 '   Fixed error lookup in machines with English language (or in MSX2?)
120 '   Improved error reporting routine to output to the new MSX Badig Build Monitor Execution
130 '   Improved ON STOP routine and added MSX Badig Build Monitor Execution reporting
140 '   Adjusted background and border colors on quit to 4 instead of 5
150 '
160 CLEAR200,&HDA00
170 DEFINTA-Z:MAXFILES=2
180 ONSTOPGOSUB5270:STOPON
190 ONERRORGOTO5160
200 DIMYL(36)
210 YK=0
220 YJ=-1
230 YI$=""
240 ZY=1:ZX=15:ZW=2:ZV=6:ZU=2:ZT=1
250 SCREEN0:COLORZX,ZY,ZY:WIDTH40:KEYOFF
260 LOCATE14,11:PRINT"INITIALIZING"
270 LOCATE14,13:PRINT" MAKING STR "
280 GOSUB1200
290 LOCATE14,13:PRINT" ERROR MSGS "
300 ' Using the time format in ROM to determine language
310 IF(PEEK(&H2B)AND112)=32THENRESTORE5470ELSERESTORE5510
320 FORF=1TO36:READA:YL(F)=A:NEXT
330 LOCATE14,13:PRINT"LOADING CONF"
340 GOSUB2690
350 LOCATE14,13:PRINT" ML SUPPORT "
360 YH=&HDA00
370 YK=3
380 BLOAD"CGKTools.com"
390 YG=0
400 RESTORE5670
410 GOTO470
420 LOCATE8,8:PRINT" CGKTools.bin not found"
430 LOCATE8,9:PRINT"Using internal fall back"
440 RESTORE5560
450 FORF=0TO146:READA$:LOCATE18,15:PRINT147-F:POKEYH+F,VAL("&h"+A$):NEXT:LOCATE18,15:PRINT"   "
460 YG=-1
470 DEFUSR0=YH+&H08' invert_VRAM 		v0=len
480 DEFUSR1=YH+&H0B' fill_VRAM 		v0-v1=len v2-v3=srt usr(ptrn)
490 DEFUSR2=YH+&H0E' copy_VRAM 		v0-v1=VRAM v2=width v3=height usr(direc)
500 DEFUSR3=YH+&H11' populate_edit 	v0=col_len v1=lin_len
510 DEFUSR4=YH+&H14' flip_VRAM		 	v0=len
520 DEFUSR5=YH+&H17' rotate_VRAM	 	v0=len
530 DEFUSR6=YH+&H1A' slide_VRAM	 	v0=len usr(direc)
540 DEFFNYF(X,Y,S)=(X+S+(Y*32))MOD256
550 DEFFNYE(X,Y,S)=INT((X+S+(Y*32))/256)
560 SCREEN0:WIDTH40
570 DEFFNZZ(X)=ABS(XMOD16+16)MOD16
580 ZS=0:ZR=0:ZQ=0:ZP=0
590 YD$=""' leave blank to enable file request
600 YC$=".bin"' leave blank to all
610 IFYC$=""THENYC$=".*"
620 IFYD$<>""GOTO1290
630 CLS
640 YK=1
650 LOCATE14,8:PRINT"Insert disk"
660 LOCATE11,10:PRINT"and press any key"
670 IFNOTYJTHENLOCATE9,18:PRINTYI$
680 IFINKEY$=""THEN680
690 YJ=-1
700 YI$=""
710 CLS
720 FILES"*"+YC$
730 PRINT:PRINT
740 PRINT":Load":PRINT":ARROWS choose:ENTER select:SPACE type";
750 FORF=0TO24
760 YB=0+40*F
770 IFCHR$(VPEEK(YB))=":"THENYA=F-1
780 NEXT
790 X=12:Y=0
800 YB=X+40*Y
810 GOSUB1040
820 A$=INKEY$
830 LOCATEX,Y:PRINT"{"
840 LOCATEX,Y:PRINT"<"
850 IFA$=""THEN820
860 LOCATEX,Y:PRINT" "
870 PX=X:PY=Y
880 IFA$=CHR$(&H1C)THENX=X+13:GOSUB970
890 IFA$=CHR$(&H1D)THENX=X-13:GOSUB970
900 IFA$=CHR$(&H1E)THENY=Y-1:GOSUB970
910 IFA$=CHR$(&H1F)THENY=Y+1:GOSUB970
920 IFA$=CHR$(&H0D)THEN1270
930 IFA$=" "THEN1230
940 LOCATEX,Y:PRINT"<"
950 GOSUB1040
960 GOTO820
970 IFX>=39THENX=12
980 IFX<=0THENX=38
990 IFY<=0THENY=0
1000 IFY>=24THENY=24
1010 YB=X+40*Y
1020 IFVPEEK(YB-12)=32THENX=PX:Y=PY:YB=X+40*Y
1030 RETURN
1040 XZ=0:YD$="":XY$=""
1050 LOCATE6,YA:PRINT"            "
1060 FORF=YB-12TOYB-1
1070 XY$=CHR$(VPEEK(F))
1080 YD$=YD$+XY$
1090 LOCATE6+XZ,YA:PRINTXY$
1100 XZ=XZ+1
1110 NEXT
1120 RETURN
1130 CLS
1140 LOCATE13,11:PRINT"Sorry"
1150 LOCATE00,12:PRINT"The game must be over 800 bytes"
1160 LOCATE05,13:PRINT"Press space to restart"
1170 IFINKEY$<>" "THEN1170
1180 SCREEN0
1190 RETURN
1200 XX$="W":XW$="_"
1210 FORF=0TO4:XX$=XX$+XX$:XW$=XW$+XW$:NEXT
1220 RETURN
1230 YK=2
1240 LOCATE6,YA:?"            "
1250 LOCATE6,YA:LINEINPUTYD$
1260 IFYD$=""THENGOSUB1040:GOTO820
1270 LOCATE39,YA+1:PRINT
1280 FILESYD$
1290 CLS:SCREEN1:WIDTH32
1300 POKEYH+0,&H20:POKEYH+1,&H03:POKEYH+2,&H00:POKEYH+3,&H04:A=USR1(0)
1310 VPOKE6914,0:VPOKE6918,1:VPOKE6922,2:VPOKE6926,3:VPOKE6930,2
1320 LOCATE10,11:PRINT"INITIALIZING"
1330 LOCATE10,13:PRINT"    GAME    "
1340 OPENYD$AS#1LEN=1
1350 FIELD#1,1ASZJ$
1360 GET#1,3:ZI$=ZJ$:GET#1,2:ZH$=ZJ$:ZG=(ASC(ZI$)*256+ASC(ZH$))-65535!
1370 GET#1,5:ZI$=ZJ$:GET#1,4:ZH$=ZJ$:ZF=(ASC(ZI$)*256+ASC(ZH$))-65535!
1380 ZD=ZF-ZG-1
1390 ZE=0:ZC=800:ZB=8:ZS=-1
1400 ZA=ZE:YZ=16:YY=23:YX=32
1410 IFZD<800THENCLOSE:GOSUB1130:GOTO630
1420 LOCATE10,13:PRINT"   SHAPES   "
1430 LOCATE15,15:PRINT"06"
1440 FORF=0TO23:READA:VPOKE&H0008+F,A:NEXT:LOCATE15,15:PRINT"05"
1450 FORF=0TO7:READA:VPOKE&H0080+F,A:NEXT:LOCATE15,15:PRINT"04"
1460 FORF=0TO7:READA:VPOKE&H00F8+F,A:NEXT:LOCATE15,15:PRINT"03"
1470 FORF=0TO7:READA:VPOKE&H0720+F,A:NEXT:LOCATE15,15:PRINT"02"
1480 FORF=0TO23:READA:VPOKE&H0740+F,A:NEXT:LOCATE15,15:PRINT"01"
1490 FORF=0TO31:READA:VPOKE&H3800+F,A:NEXT:LOCATE15,15:PRINT"00"
1500 POKEYH+0,&H20:POKEYH+1,&H00:POKEYH+2,&H60:POKEYH+3,&H00:A=USR1(0)
1510 LOCATE10,13:PRINT"   COLORS   "
1520 GOSUB2440
1530 CLS
1540 LOCATE0,0:PRINT"  CHANGE GRAPH KIT WW "+LEFT$(YD$,8)
1550 LOCATE1,2:PRINT"X";LEFT$(XX$,2*10);"Y"
1560 LOCATE1,3:PRINT"VÄäîû®≤º∆–⁄V"
1570 LOCATE1,4:PRINT"VÅãïü©≥Ω«—€V"
1580 LOCATE1,5:PRINT"VÇåñ†™¥æ»“‹V"
1590 LOCATE1,6:PRINT"VÉçó°´µø…”›V"
1600 LOCATE1,7:PRINT"VÑéò¢¨∂¿ ‘ﬁV"
1610 LOCATE1,8:PRINT"VÖèô£≠∑¡À’ﬂV"
1620 LOCATE1,9:PRINT"VÜêö§Æ∏¬Ã÷‡V"
1630 LOCATE1,10:PRINT"Váëõ•Øπ√Õ◊·V"
1640 LOCATE1,11:PRINT"Vàíú¶∞∫ƒŒÿ‚V"
1650 LOCATE1,12:PRINT"Vâìùß±ª≈œŸ„V"
1660 LOCATE1,13:PRINT"Z";LEFT$(XX$,2*10);"["
1670 LOCATE3,15:PRINT"Srt# End#"
1680 LOCATE1,17:PRINT"C"
1690 LOCATE3,17:PRINTSTRING$(4-LEN(HEX$(ZA)),"0")+HEX$(ZA)
1700 LOCATE8,17:PRINTSTRING$(4-LEN(HEX$(ZA+(YX-1))),"0")+HEX$(ZA+(YX-1))
1710 LOCATE1,19:PRINT"R"
1720 LOCATE3,19:PRINTSTRING$(4-LEN(HEX$(ZE)),"0")+HEX$(ZE)
1730 LOCATE8,19:PRINTSTRING$(4-LEN(HEX$(ZE+799)),"0")+HEX$(ZE+799)
1740 LOCATE1,21:PRINT"G"
1750 LOCATE3,21:PRINTSTRING$(4-LEN(HEX$(0)),"0")+HEX$(0)
1760 LOCATE8,21:PRINTSTRING$(4-LEN(HEX$(ZD)),"0")+HEX$(ZD)
1770 LOCATE13,2:PRINT"X";LEFT$(XX$,2*16);"Y"
1780 LOCATE13,3:PRINT"VCursor Stp #   "+RIGHT$(STR$(ZB),1)+"V"
1790 LOCATE13,4:PRINT"VRegion Stp # "+RIGHT$(HEX$(ZC),3)+"V"
1800 LOCATE13,5:PRINT"Z";LEFT$(XX$,2*16);"["
1810 ONZPGOTO1900
1820 LOCATE13,7:PRINT"VÍVMove VËVEdit   "
1830 LOCATE13,9:PRINT"VÈVStep VDVSize   "
1840 LOCATE13,11:PRINT"VBVClearVRVRefresh"
1850 LOCATE13,13:PRINT"VTVScan und cursor "
1860 LOCATE13,15:PRINT"VFVFreeze/Unfreeze"
1870 LOCATE13,17:PRINT"VEVExplode/Ovrview"
1880 LOCATE13,19:PRINT"                  "
1890 GOTO1970
1900 LOCATE13,7:PRINT"VNVNew  VPVExit  "
1910 LOCATE13,9:PRINT"VQVPrev VWVNext   "
1920 LOCATE13,11:PRINT"VAVP 4x VSVN 4x   "
1930 LOCATE13,13:PRINT"VZVSrtVXVMidVCVEnd"
1940 LOCATE13,15:PRINT"VK LVCfg Save Load"
1950 LOCATE13,17:PRINT"V1-8VChange Colors"
1960 LOCATE13,19:PRINT"                  "
1970 LOCATE13,19:PRINT"      VMVMore Keys"
1980 LOCATE13,21:PRINT"ABBBBBBBBBBBBBBBBC"
1990 GOSUB3140
2000 IFZR=-1THENLOCATE2,13:PRINT"WOverviewW"
2010 XV=YY+(YX-2):XU=0
2020 IFYY+(YX-2)>101THENXU=8:XV=23+(YY+(YX-2))-103
2030 IFYZ+XU>95THENXV=200
2040 VPOKE6912,YY-1:VPOKE6913,YZ
2050 VPOKE6916,XV+1:VPOKE6917,XU+YZ
2060 XT=ZE/(ZD/141)+105
2070 VPOKE6920,167:VPOKE6921,XT
2080 VPOKE6928,167:VPOKE6929,XT+(141/(ZD/800))
2090 IFZQTHENZQ=0:GOSUB2940
2100 A$=INKEY$
2110 IFA$=CHR$(&H1C)AND(YZ+8<95)AND(ZA+YX-2+80<ZD)THENYZ=YZ+8:ZA=ZA+80:GOSUB2780
2120 IFA$=CHR$(&H1D)AND(YZ-8>15)THENYZ=YZ-8:ZA=ZA-80:GOSUB2780
2130 IFA$=CHR$(&H1E)AND(YY-ZB>22)THENYY=YY-ZB:ZA=ZA-ZB:GOSUB2780
2140 IFA$=CHR$(&H1F)AND(YY+ZB<103)AND(ZA+YX-2+ZB<ZD)THENYY=YY+ZB:ZA=ZA+ZB:GOSUB2780
2150 IFA$="1"THENZY=ZY-1:GOSUB2440
2160 IFA$="2"THENZY=ZY+1:GOSUB2440
2170 IFA$="3"THENZX=ZX-1:GOSUB2440
2180 IFA$="4"THENZX=ZX+1:GOSUB2440
2190 IFA$="5"THENZW=ZW-1:GOSUB2440
2200 IFA$="6"THENZW=ZW+1:GOSUB2440
2210 IFA$="7"THENZV=ZV-1:GOSUB2440
2220 IFA$="8"THENZV=ZV+1:GOSUB2440
2230 IFA$=CHR$(&H0D)GOTO3210
2240 IFA$="E"GOTO4280
2250 IFA$="D"THENGOSUB2860
2260 IFA$=" "THENGOSUB3170
2270 IFA$="R"THENXS=0:GOSUB3070
2280 IFA$="M"THENZP=ABS(ZP-1):GOTO1810
2290 IFA$="B"THENPOKEYH+0,&H20:POKEYH+1,&H03:POKEYH+2,&H00:POKEYH+3,&H04:A=USR1(0)
2300 IFA$="N"THENGOSUB5020:CLOSE:RESTORE5670:GOTO560
2310 IFA$="P"THENGOSUB5020:CLOSE:CLEAR:SCREEN0:WIDTH40:COLOR15,4,4:NEW
2320 IFA$="K"THENGOSUB2590
2330 IFA$="T"THENGOSUB2740
2340 IFA$="L"THENGOSUB2690:GOSUB2440
2350 IFA$="Q"THENXS=ZA-ZE:ZE=ZE-ZC:GOSUB2940
2360 IFA$="W"THENXS=ZA-ZE:ZE=ZE+ZC:GOSUB2940
2370 IFA$="A"THENXS=ZA-ZE:ZE=ZE-ZC*4:GOSUB2940
2380 IFA$="S"THENXS=ZA-ZE:ZE=ZE+ZC*4:GOSUB2940
2390 IFA$="Z"THENXS=ZA-ZE:ZE=&H00:GOSUB2940
2400 IFA$="X"THENXS=ZA-ZE:ZE=(ZD/2:GOSUB2940-400)
2410 IFA$="C"THENXS=ZA-ZE:ZE=ZD-799:GOSUB2940
2420 IFA$="F"THENXS=0:ZS=NOTZS:IFZSTHENGOSUB3140:ELSE:GOSUB3070
2430 GOTO2100
2440 ZY=FNZZ(ZY)
2450 ZX=FNZZ(ZX)
2460 ZW=FNZZ(ZW)
2470 ZV=FNZZ(ZV)
2480 ZU=FNZZ(ZU)
2490 ZT=FNZZ(ZT)
2500 COLORZX,ZY,ZY
2510 VPOKE8194,ZV*16+ZY
2520 VPOKE8195,ZV*16+ZY
2530 VPOKE8192,ZV*16+ZW
2540 VPOKE8193,ZW*16+ZY
2550 VPOKE6915,ZX:VPOKE6919,ZX
2560 VPOKE6923,ZX:VPOKE6927,ZX:VPOKE6931,ZX
2570 FORF=0TO12:VPOKE8208+F,ZW*16+ZY:NEXT
2580 RETURN
2590 X=12:Y=10:W=8:H=2:GOSUB5100
2600 POKEYH+0,ZN:POKEYH+1,ZM:POKEYH+2,ZL:POKEYH+3,ZK:A=USR2(0)
2610 LOCATE12,10:PRINT"X";LEFT$(XX$,2*6);"Y"
2620 LOCATE12,11:PRINT"VSAVINGV"
2630 LOCATE12,12:PRINT"Z";LEFT$(XX$,2*6);"[
2640 OPEN"CGKConf.cfg"FOROUTPUTAS#2
2650 PRINT#2,ZY,ZX,ZW,ZV,ZU,ZT
2660 CLOSE#2
2670 POKEYH+0,ZN:POKEYH+1,ZM:POKEYH+2,ZL:POKEYH+3,ZK:A=USR2(1)
2680 RETURN
2690 YK=4
2700 OPEN"CGKConf.cfg"FORINPUTAS#2
2710 INPUT#2,ZY,ZX,ZW,ZV,ZU,ZT
2720 CLOSE#2
2730 RETURN
2740 YV=ZA+(YX-1)'find formula to cap at gameLength to avoid next if
2750 IFYV>ZD-1THENYV=ZD-1
2760 FORI=ZATOYV:GET#1,I+1:VPOKE1024-ZE+I,VPEEK(1024-ZE+I)XOR255:A$=ZJ$:VPOKE1024-ZE+I,ASC(A$):NEXT
2770 RETURN
2780 XV=YY+(YX-2):XU=0
2790 IFYY+(YX-2)>101THENXU=8:XV=23+(YY+(YX-2))-103
2800 IFYZ+XU>95THENXV=200
2810 VPOKE6912,YY-1:VPOKE6913,YZ
2820 VPOKE6916,XV+1:VPOKE6917,YZ+XU
2830 LOCATE3,17:PRINTSTRING$(4-LEN(HEX$(ZA)),"0")+HEX$(ZA)
2840 LOCATE8,17:PRINTSTRING$(4-LEN(HEX$(ZA+(YX-1))),"0")+HEX$(ZA+(YX-1))
2850 RETURN
2860 IFYX=32THENYX=8ELSEIFZA+YX+22<ZDTHENYX=32ELSERETURN
2870 XV=YY+(YX-2):XU=0
2880 IFYY+(YX-2)>101THENXU=8:XV=23+(YY+(YX-2))-103
2890 IFYZ+XU>95THENXV=200
2900 VPOKE6916,XV+1:VPOKE6917,YZ+XU
2910 LOCATE3,17:PRINTSTRING$(4-LEN(HEX$(ZA)),"0")+HEX$(ZA)
2920 LOCATE8,17:PRINTSTRING$(4-LEN(HEX$(ZA+(YX-1))),"0")+HEX$(ZA+(YX-1))
2930 RETURN
2940 IFZE<0THENZE=0
2950 IFZE+799>ZDTHENZE=ZD-799
2960 ZA=ZE+XS
2970 XT=ZE/(ZD/141)+105
2980 VPOKE6920,167:VPOKE6921,XT
2990 VPOKE6928,167:VPOKE6929,XT+(141/(ZD/800))
3000 LOCATE3,17:PRINTSTRING$(4-LEN(HEX$(ZA)),"0")+HEX$(ZA)
3010 LOCATE8,17:PRINTSTRING$(4-LEN(HEX$(ZA+7)),"0")+HEX$(ZA+7)
3020 LOCATE3,19:PRINTSTRING$(4-LEN(HEX$(ZE)),"0")+HEX$(ZE)
3030 LOCATE8,19:PRINTSTRING$(4-LEN(HEX$(ZE+799)),"0")+HEX$(ZE+799)
3040 IFZA+YX>ZDTHENYZ=95-7:YY=103-YX:ZA=ZD-YX+1:GOSUB2780
3050 IFNOTZSTHENGOSUB3070
3060 RETURN
3070 ZR=0
3080 LOCATE2,2:PRINTLEFT$(XX$,2*3);"SCAN";LEFT$(XX$,2*3)
3090 LOCATE2,13:PRINT"WVÈVStopWW"
3100 FORF=ZETOZE+799
3110 VPOKE1024-ZE+F,VPEEK(1024-ZE+F)XOR255:GET#1,F+1:A$=ZJ$:VPOKE1024-ZE+F,ASC(A$):IFINKEY$=" "THENF=ZE+800ELSENEXT
3120 GOSUB3140
3130 RETURN
3140 IFZSTHENLOCATE2,2:PRINT"WWFREEZEWW"ELSELOCATE2,2:PRINTLEFT$(XX$,2*10)
3150 LOCATE2,13:PRINTLEFT$(XX$,2*10)
3160 RETURN
3170 ZB=(8+1)-ZB
3180 ZC=(800+400)-ZC
3190 LOCATE29,3:PRINTRIGHT$(HEX$(ZB),1):LOCATE27,4:PRINTRIGHT$(HEX$(ZC),3)
3200 RETURN
3210 CLS
3220 VPOKE6920,200:VPOKE6928,200
3230 POKEYH+0,&H20:POKEYH+1,&H00:POKEYH+2,&H40:POKEYH+3,&H00:A=USR1(0)
3240 LOCATE0,0:PRINT"  CHANGE GRAPH KIT WW "+LEFT$(YD$,8)
3250 LOCATE1,2:PRINT"X";LEFT$(XX$,2*10);"Y"
3260 LOCATE1,3:PRINT"VÄäîû®≤º∆–⁄V"
3270 LOCATE1,4:PRINT"VÅãïü©≥Ω«—€V"
3280 LOCATE1,5:PRINT"VÇåñ†™¥æ»“‹V"
3290 LOCATE1,6:PRINT"VÉçó°´µø…”›V"
3300 LOCATE1,7:PRINT"VÑéò¢¨∂¿ ‘ﬁV"
3310 LOCATE1,8:PRINT"VÖèô£≠∑¡À’ﬂV"
3320 LOCATE1,9:PRINT"VÜêö§Æ∏¬Ã÷‡V"
3330 LOCATE1,10:PRINT"Váëõ•Øπ√Õ◊·V"
3340 LOCATE1,11:PRINT"Vàíú¶∞∫ƒŒÿ‚V"
3350 LOCATE1,12:PRINT"Vâìùß±ª≈œŸ„V"
3360 LOCATE1,13:PRINT"Z";LEFT$(XX$,2*10);"["
3370 LOCATE1,14:PRINT"X";LEFT$(XX$,2*2);"R";LEFT$(XX$,2*4);"R";LEFT$(XX$,2*2);"Y"
3380 LOCATE1,15:PRINT"VHJV    VLNV"
3390 LOCATE1,16:PRINT"VIKV    VMOV"
3400 LOCATE1,17:PRINT"Z";LEFT$(XX$,2*2);"Q";LEFT$(XX$,2*4);"Q";LEFT$(XX$,2*2);"["
3410 LOCATE5,15:PRINTSTRING$(4-LEN(HEX$(ZA)),"0")+HEX$(ZA)
3420 LOCATE5,16:PRINTSTRING$(4-LEN(HEX$(ZA+(YX-1))),"0")+HEX$(ZA+(YX-1))
3430 LOCATE14,2:PRINTLEFT$(XW$,2*16)
3440 LOCATE14,3:PRINTLEFT$(XW$,2*16)
3450 LOCATE14,4:PRINTLEFT$(XW$,2*16)
3460 LOCATE14,5:PRINTLEFT$(XW$,2*16)
3470 LOCATE14,6:PRINTLEFT$(XW$,2*16)
3480 LOCATE14,7:PRINTLEFT$(XW$,2*16)
3490 LOCATE14,8:PRINTLEFT$(XW$,2*16)
3500 LOCATE14,9:PRINTLEFT$(XW$,2*16)
3510 LOCATE14,10:PRINTLEFT$(XW$,2*16)
3520 LOCATE14,11:PRINTLEFT$(XW$,2*16)
3530 LOCATE14,12:PRINTLEFT$(XW$,2*16)
3540 LOCATE14,13:PRINTLEFT$(XW$,2*16)
3550 LOCATE14,14:PRINTLEFT$(XW$,2*16)
3560 LOCATE14,15:PRINTLEFT$(XW$,2*16)
3570 LOCATE14,16:PRINTLEFT$(XW$,2*16)
3580 LOCATE14,17:PRINTLEFT$(XW$,2*16)
3590 VPOKE6924,15:VPOKE6925,112
3600 IFYGTHENZO=0
3610 ONZOGOTO3660
3620 LOCATE01,19:PRINT"VCVCpyVVVPst"
3630 LOCATE07,21:PRINT"V#VCor"
3640 IFNOTYGTHENLOCATE01,21:PRINT"VMVKys"
3650 GOTO3680
3660 LOCATE01,19:PRINT"VRVRotVTVHmv"
3670 LOCATE01,21:PRINT"VFVFlpVGVVmv"
3680 LOCATE13,19:PRINT"VEVErzVÈVTglVLVRld"
3690 LOCATE13,21:PRINT"VDVInvVSVSavVËVBck"
3700 IFXR>=0THENXR=0:XQ=0:XP=0:GOSUB3950
3710 XR=0
3720 A$=INKEY$
3730 IFA$=CHR$(&H1C)ANDXQ<YWTHENXQ=XQ+1:VPOKE6925,112+(XQ*8)
3740 IFA$=CHR$(&H1D)ANDXQ>0THENXQ=XQ-1:VPOKE6925,112+(XQ*8)
3750 IFA$=CHR$(&H1E)ANDXP>0THENXP=XP-1:VPOKE6924,15+(XP*8)
3760 IFA$=CHR$(&H1F)ANDXP<YWTHENXP=XP+1:VPOKE6924,15+(XP*8)
3770 IFA$="E"THENXR=2:GOSUB3950
3780 IFA$="D"THENXR=1:GOSUB3950
3790 IFA$="R"THENXR=3:GOSUB3950
3800 IFA$="F"THENXR=4:GOSUB3950
3810 IFA$="T"THENXR=5:GOSUB3950
3820 IFA$="G"THENXR=6:GOSUB3950
3830 IFA$="C"THENFORF=0TOYU-1:VPOKE&H0060+F,VPEEK(&H0040+F):NEXT
3840 IFA$="V"THENFORF=0TOYU-1:VPOKE&H0040+F,VPEEK(&H0060+F):NEXT:POKEYH+0,YS:POKEYH+1,YT:A=USR3(0)
3850 IFA$=" "THENGOSUB4110
3860 IFA$="S"THENGOSUB4170
3870 IFA$="L"THENXR=0:GOSUB3950
3880 IFA$="M"THENZO=ABS(ZO-1):XR=-1:GOTO3600
3890 IFA$="1"THENZU=ZU-1:GOSUB4070
3900 IFA$="2"THENZU=ZU+1:GOSUB4070
3910 IFA$="3"THENZT=ZT-1:GOSUB4070
3920 IFA$="4"THENZT=ZT+1:GOSUB4070
3930 IFA$=CHR$(&H0D)THENVPOKE6924,200:GOTO1530
3940 GOTO3720
3950 YV=ZA+(YX-1)'find formula to cap at gameLength to avoid next if
3960 IFYV>ZD-1THENYV=ZD-1
3970 IFYX=8THENYW=7:YU=8:YT=8:YS=1:ELSEYW=15:YU=32:YT=16:YS=2
3980 IFXR=1THENPOKEYH+0,YU:A=USR0(0)
3990 IFXR=2THENPOKEYH+0,YU:POKEYH+1,&H00:POKEYH+2,&H40:POKEYH+3,&H00:A=USR1(0)
4000 IFXR=3ANDNOTYGTHENPOKEYH+0,YU:A=USR5(0)
4010 IFXR=4ANDNOTYGTHENPOKEYH+0,YU:A=USR4(0)
4020 IFXR=5ANDNOTYGTHENPOKEYH+0,YU:A=USR6(1)
4030 IFXR=6ANDNOTYGTHENPOKEYH+0,YU:A=USR6(0)
4040 IFXR=0THENFORI=ZATOYV:GET#1,I+1:VPOKE1024-ZE+I,VPEEK(1024-ZE+I)XOR255:A$=ZJ$:VPOKE&H0040+I-ZA,ASC(A$):VPOKE1024-ZE+I,ASC(A$):NEXT
4050 POKEYH+0,YS:POKEYH+1,YT:A=USR3(0)
4060 RETURN
4070 ZU=FNZZ(ZU)
4080 ZT=FNZZ(ZT)
4090 VPOKE8193,ZU*16+ZT
4100 RETURN
4110 XO=VPEEK((XQ+14)+(XP+2)*32+6144)
4120 XO=(228+16)-XO
4130 VPOKE(XQ+14)+(XP+2)*32+6144,XO
4140 XN=XP:IFXQ>7THENXN=XP+16
4150 VPOKE&H0040+XN,2^(7-(XQMOD8))XORVPEEK(&H0040+XN)
4160 RETURN
4170 YV=ZA+(YX-1)'find formula to cap at gameLength to avoid next if
4180 IFYV>ZD-1THENYV=ZD-1
4190 FORI=ZATOYV
4200 XM=1024-ZE+I
4210 XL=VPEEK(&H0040+I-ZA)
4220 VPOKEXM,VPEEK(XM)XOR255
4230 A$=CHR$(XL)
4240 LSETZJ$=A$:PUT#1,I
4250 VPOKEXM,XL
4260 NEXT
4270 RETURN
4280 CLS
4290 LOCATE0,0:PRINT"  CHANGE GRAPH KIT WW "+LEFT$(YD$,8)
4300 LOCATE1,2:PRINT"X";LEFT$(XX$,2*19);"Y"
4310 LOCATE1,3:PRINT"VÄ ä î û ® ≤ º ∆ – ⁄V"
4320 LOCATE1,4:PRINT"V                   V"
4330 LOCATE1,5:PRINT"VÅ ã ï ü © ≥ Ω « — €V"
4340 LOCATE1,6:PRINT"V                   V"
4350 LOCATE1,7:PRINT"VÇ å ñ † ™ ¥ æ » “ ‹V"
4360 LOCATE1,8:PRINT"V                   V"
4370 LOCATE1,9:PRINT"VÉ ç ó ° ´ µ ø … ” ›V"
4380 LOCATE1,10:PRINT"V                   V"
4390 LOCATE1,11:PRINT"VÑ é ò ¢ ¨ ∂ ¿   ‘ ﬁV"
4400 LOCATE1,12:PRINT"V                   V"
4410 LOCATE1,13:PRINT"VÖ è ô £ ≠ ∑ ¡ À ’ ﬂV"
4420 LOCATE1,14:PRINT"V                   V"
4430 LOCATE1,15:PRINT"VÜ ê ö § Æ ∏ ¬ Ã ÷ ‡V"
4440 LOCATE1,16:PRINT"V                   V"
4450 LOCATE1,17:PRINT"Vá ë õ • Ø π √ Õ ◊ ·V"
4460 LOCATE1,18:PRINT"V                   V"
4470 LOCATE1,19:PRINT"Và í ú ¶ ∞ ∫ ƒ Œ ÿ ‚V"
4480 LOCATE1,20:PRINT"V                   V"
4490 LOCATE1,21:PRINT"Vâ ì ù ß ± ª ≈ œ Ÿ „V"
4500 LOCATE1,22:PRINT"Z";LEFT$(XX$,2*19);"["
4510 LOCATE23,03:PRINT"VOV Ovrw"
4520 LOCATE23,21:PRINT"VEV Back"
4530 VPOKE6912,200:VPOKE6916,200
4540 VPOKE6920,200:VPOKE6928,200
4550 IFZRTHENGOSUB4900
4560 A$=INKEY$
4570 IFA$="O"THENGOSUB4720
4580 IFA$=CHR$(&H1C)ANDYR<9ANDZRTHENYR=YR+1:GOSUB4650
4590 IFA$=CHR$(&H1D)ANDYR>0ANDZRTHENYR=YR-1:GOSUB4650
4600 IFA$=CHR$(&H1E)ANDYQ>0ANDZRTHENYQ=YQ-1:GOSUB4650
4610 IFA$=CHR$(&H1F)ANDYQ<9ANDZRTHENYQ=YQ+1:GOSUB4650
4620 IFA$=CHR$(&H0D)ANDZRTHENZE=(YQ*YO)+(YR*(YO*10)):ZQ=-1:ZA=ZE:YZ=16:YY=23:IFZE+799>ZDTHENZE=ZD-799:YZ=16:YY=23:ZA=ZE:GOTO1530ELSEGOTO1530
4630 IFA$="E"GOTO1530
4640 GOTO4560
4650 VPOKE6912,(YQ+1)*16+6:VPOKE6913,(YR+1)*16
4660 VPOKE6916,(YQ+1)*16+14:VPOKE6917,(YR+1)*16
4670 YM=(YQ*YO)+(YR*(YO*10))
4680 IFYM+799>ZDTHENYM=ZD-799
4690 LOCATE27,13:PRINTSTRING$(4-LEN(HEX$(YM)),"0")+HEX$(YM)
4700 LOCATE27,15:PRINTSTRING$(4-LEN(HEX$(YM+799)),"0")+HEX$(YM+799)
4710 RETURN
4720 YP=0
4730 ZR=-1
4740 YO=(ZD/100)
4750 YN=(9*YO)+(9*(YO*10))+8
4760 LOCATE2,2:PRINTLEFT$(XX$,2*7);"SCAN";LEFT$(XX$,2*8)
4770 LOCATE2,22:PRINTLEFT$(XX$,2*5);"VÈVStop";LEFT$(XX$,2*7)
4780 FORF=1TOYNSTEPYO
4790 FORI=FTOF+7
4800 VPOKE1024+YP,VPEEK(1024+YP)XOR255
4810 GET#1,I+1
4820 A$=ZJ$
4830 VPOKE1024+YP,ASC(A$)
4840 YP=YP+1
4850 IFINKEY$=" "THENF=YN+1:I=F+8
4860 NEXT
4870 NEXT
4880 GOSUB4900
4890 RETURN
4900 VPOKE6912,(YQ+1)*16+6:VPOKE6913,(YR+1)*16
4910 VPOKE6916,(YQ+1)*16+14:VPOKE6917,(YR+1)*16
4920 LOCATE23,05:PRINT"VÍV Move"
4930 LOCATE23,07:PRINT"VËV Go"
4940 LOCATE23,11:PRINT"Region"
4950 YM=(YQ*YO)+(YR*(YO*10))
4960 IFYM+799>ZDTHENYM=ZD-799
4970 LOCATE23,13:PRINT"St# "+STRING$(4-LEN(HEX$(YM)),"0")+HEX$(YM)
4980 LOCATE23,15:PRINT"Ed# "+STRING$(4-LEN(HEX$(YM+799)),"0")+HEX$(YM+799)
4990 LOCATE02,2:PRINTLEFT$(XX$,2*19)
5000 LOCATE2,22:PRINTLEFT$(XX$,2*19)
5010 RETURN
5020 X=5:Y=10:W=21:H=2:GOSUB5100
5030 POKEYH+0,ZN:POKEYH+1,ZM:POKEYH+2,ZL:POKEYH+3,ZK:A=USR2(0)
5040 LOCATE5,10:PRINT"X";LEFT$(XX$,2*19);"Y"
5050 LOCATE5,11:PRINT"VAre you sure? (Y/N)V"
5060 LOCATE5,12:PRINT"Z";LEFT$(XX$,2*19);"[
5070 A$=INKEY$:IFA$<>"Y"ANDA$<>"N"THEN5070
5080 IFA$="N"THENPOKEYH+0,ZN:POKEYH+1,ZM:POKEYH+2,ZL:POKEYH+3,ZK:A=USR2(1):RETURN2100
5090 RETURN
5100 S=&H1800
5110 ZN=FNYF(X,Y,S):ZM=FNYE(X,Y,S)
5120 ZL=W+1:ZK=H+1
5130 IFYGTHENS=0:ZL=FNYF(W,H,S):ZK=FNYE(W,H,S)
5140 RETURN
5150 ' Error Handling Routines
5160 IFERR=53ANDYK=2GOTO5390
5170 IFERR=56ANDYK=2GOTO5390
5180 IFERR=55ANDYK=4THENYK=0:YJ=0:YI$="CONFIG FILE CORRUPTED":RESUME2720
5190 IFERR=53ANDYK=4THENYK=0:YJ=0:YI$="CONFIG FILE NOT FOUND":RESUME2720
5200 IFERR=53ANDYK=3THENYK=0:RESUME420
5210 IF(ERR=53ANDYK=1)ORERR=70GOTO5330
5220 XK=ERR:IFXK>25THENXK=XK-24
5230 LOCATE0,20:PRINTCHR$(&H0D)
5240 FORF=YL(XK)+1TOYL(XK+1)-1:PRINTCHR$(PEEK(&H3D75+F));
5250 NEXT
5260 PRINT" (";RIGHT$(STR$(ERR),LEN(STR$(ERR))-1);") at";ERL;CHR$(&H07)
5270 CLOSE
5280 STOPOFF
5290 ONERRORGOTO0
5300 LOCATE0,20:PRINTCHR$(&H0D)
5310 PRINT"Break";CHR$(&H07)
5320 END
5330 PRINT:PRINT"No files found"
5340 PRINT:PRINT"Press space to restart"
5350 IFINKEY$<>" "THEN5350
5360 YK=0
5370 CLS
5380 RESUME630
5390 PRINT:PRINT
5400 IFERR=53THENPRINTYD$;" not found"
5410 IFERR=56THENPRINT"Invalid name"
5420 PRINT:PRINT"Press space to restart"
5430 IFINKEY$<>" "THEN5430
5440 YK=0
5450 RESUME630
5460 ' Error Messages in ROM
5470 DATA0,13,26,43,52,66,75,89,110,132,147
5480 DATA164,178,192,210,223,239,253,271,287
5490 DATA304,311,328,344,359,371,383,396,410
5500 DATA429,444,459,475,501,520,531
5510 DATA0,17,30,51,63,85,94,108,130,153,173
5520 DATA190,205,219,239,255,282,297,321,338
5530 DATA351,361,382,400,416,437,452,467,483
5540 DATA498,516,531,545,570,590,604
5550 ' ML Routines at 0xd000. ASM Source on GitHub
5560 DATA00,00,00,00,00,00,00,00,c3,14,da,c3,27,da,c3,35
5570 DATAda,c3,5a,da,3a,00,da,47,21,40,00,cd,4a,00,ee,ff
5580 DATAcd,4d,00,23,10,f5,c9,3a,f8,f7,ed,4b,00,da,2a,02
5590 DATAda,cd,56,00,c9,3a,f8,f7,fe,00,ca,4c,da,ed,4b,02
5600 DATAda,ed,5b,00,da,21,93,da,cd,5c,00,c9,ed,4b,02,da
5610 DATA11,93,da,2a,00,da,cd,59,00,c9,11,40,00,21,4e,18
5620 DATA3a,00,da,47,c5,3a,01,da,47,c5,eb,cd,4a,00,eb,06
5630 DATA08,17,f5,38,1a,3e,10,cd,4d,00,f1,23,10,f3,13,d5
5640 DATA11,18,00,19,d1,c1,10,e1,21,56,18,c1,10,d6,c9,3e
5650 DATAe4,18,e4
5660 ' Character Shapes
5670 DATA255,128,128,128,128,128,128,255
5680 DATA255,0,0,0,0,0,0,255
5690 DATA255,1,1,1,1,1,1,255
5700 DATA255,129,129,129,129,129,129,255
5710 DATA255,255,255,255,255,255,255,255
5720 DATA0,126,126,126,126,126,126,0
5730 DATA4,4,36,100,252,96,32,0
5740 DATA0,0,219,154,82,211,0,0
5750 DATA231,195,165,24,24,165,195,231
5760 ' Sprite Shapes
5770 DATA255,129,0,0,0,0,0,0
5780 DATA129,255,0,0,0,0,0,0
5790 DATA0,128,128,128,128,128,128,0
5800 DATA255,129,129,129,129,129,129,255
5810 ' Functions Not Used
5820 ' Create Character Block
5830 C=127
5840 FORX=2TO11
5850 FORY=3TO12
5860 C=C+1:LOCATEX,Y:PRINT:PRINTCHR$(C)
5870 NEXT
5880 NEXT
5890 END
5900 ' Character Map
5910 FORI=0TO255
5920 X=IMOD32:Y=I\32
5930 C=I
5940 IFC<32ORC=127THENC=32
5950 LOCATEX,Y:PRINTCHR$(C)
5960 LOCATEX,Y+10:PRINTCHR$(1)+CHR$(C)
5970 NEXT
5980 END
