10 'Converted with MSX Basic Dignified
20 'https://github.com/farique1/msx-basic-dignified
30 ' CHANGE GRAPH KIT
40 ' v1.6
50 ' Edit uncompressed graphics on MSX binary files on disk
60 '
70 ' New
80 '   Updated most subroutines to the new FUNC proto-function
90 '	Replaced operators with the new +=, ++, etc where possible
100 '   "|M|Kys" not showing anymore on Edit screen if on ML fallback
110 '   Made DEFINEs for chr$ keys, keyboard scans and screen drawing
120 '   Error handling improvements
130 '   Small code adjustments, cleanup and optimizations
140 '   Fixed bug with a wrong error number when a support file was not found
150 '
160 ' Copyright (1984 - 2020) - Fred Rique (farique)
170 ' https://github.com/farique1/Change-Graph-Kit
180 '
190 CLEAR200,&HDA00
200 DEFINTA-Z:MAXFILES=2
210 ONSTOPGOSUB5290:STOPON
220 ONERRORGOTO5190
230 DIMYL(36)
240 YK=0
250 YJ=-1
260 YI$=""
270 ZY=1:ZX=15:ZW=2:ZV=6:ZU=2:ZT=1
280 SCREEN0:COLORZX,ZY,ZY:WIDTH40:KEYOFF
290 LOCATE14,11:PRINT"INITIALIZING"
300 LOCATE14,13:PRINT" MAKING STR "
310 GOSUB1230
320 LOCATE14,13:PRINT" ERROR MSGS "
330 ' Using the time format in ROM to determine language
340 IF(PEEK(&H2B)AND112)=32THENRESTORE5480ELSERESTORE5520
350 FORF=1TO36:READA:YL(F)=A:NEXT
360 LOCATE14,13:PRINT"LOADING CONF"
370 GOSUB2720
380 LOCATE14,13:PRINT" ML SUPPORT "
390 YH=&HDA00
400 YK=3
410 BLOAD"CGKTools.com"
420 YG=0
430 RESTORE5680
440 GOTO500
450 LOCATE8,8:PRINT" CGKTools.bin not found"
460 LOCATE8,9:PRINT"Using internal fall back"
470 RESTORE5570
480 FORF=0TO146:READA$:LOCATE18,15:PRINT147-F:POKEYH+F,VAL("&h"+A$):NEXT:LOCATE18,15:PRINT"   "
490 YG=-1
500 DEFUSR0=YH+&H08' invert_VRAM 		v0=len
510 DEFUSR1=YH+&H0B' fill_VRAM 		v0-v1=len v2-v3=srt usr(ptrn)
520 DEFUSR2=YH+&H0E' copy_VRAM 		v0-v1=VRAM v2=width v3=height usr(direc)
530 DEFUSR3=YH+&H11' populate_edit 	v0=col_len v1=lin_len
540 DEFUSR4=YH+&H14' flip_VRAM		 	v0=len
550 DEFUSR5=YH+&H17' rotate_VRAM	 	v0=len
560 DEFUSR6=YH+&H1A' slide_VRAM	 	v0=len usr(direc)
570 DEFFNYF(X,Y,S)=(X+S+(Y*32))MOD256
580 DEFFNYE(X,Y,S)=INT((X+S+(Y*32))/256)
590 SCREEN0:WIDTH40
600 DEFFNZZ(X)=ABS(XMOD16+16)MOD16
610 ZS=0:ZR=0:ZQ=0:ZP=0
620 YD$=""' leave blank to enable file request
630 YC$=".bin"' leave blank to all
640 IFYC$=""THENYC$=".*"
650 IFYD$<>""GOTO1320
660 CLS
670 YK=1
680 LOCATE14,8:PRINT"Insert disk"
690 LOCATE11,10:PRINT"and press any key"
700 IFNOTYJTHENLOCATE9,18:PRINTYI$
710 IFINKEY$=""THEN710
720 YJ=-1
730 YI$=""
740 CLS
750 FILES"*"+YC$
760 PRINT:PRINT
770 PRINT":Load":PRINT":ARROWS choose:ENTER select:SPACE type";
780 FORF=0TO24
790 YB=0+40*F
800 IFCHR$(VPEEK(YB))=":"THENYA=F-1
810 NEXT
820 X=12:Y=0
830 YB=X+40*Y
840 GOSUB1070
850 A$=INKEY$
860 LOCATEX,Y:PRINT"{"
870 LOCATEX,Y:PRINT"<"
880 IFA$=""THEN850
890 LOCATEX,Y:PRINT" "
900 PX=X:PY=Y
910 IFA$=CHR$(&H1C)THENX=X+13:GOSUB1000
920 IFA$=CHR$(&H1D)THENX=X-13:GOSUB1000
930 IFA$=CHR$(&H1E)THENY=Y-1:GOSUB1000
940 IFA$=CHR$(&H1F)THENY=Y+1:GOSUB1000
950 IFA$=CHR$(&H0D)THEN1300
960 IFA$=" "THEN1260
970 LOCATEX,Y:PRINT"<"
980 GOSUB1070
990 GOTO850
1000 IFX>=39THENX=12
1010 IFX<=0THENX=38
1020 IFY<=0THENY=0
1030 IFY>=24THENY=24
1040 YB=X+40*Y
1050 IFVPEEK(YB-12)=32THENX=PX:Y=PY:YB=X+40*Y
1060 RETURN
1070 XZ=0:YD$="":XY$=""
1080 LOCATE6,YA:PRINT"            "
1090 FORF=YB-12TOYB-1
1100 XY$=CHR$(VPEEK(F))
1110 YD$=YD$+XY$
1120 LOCATE6+XZ,YA:PRINTXY$
1130 XZ=XZ+1
1140 NEXT
1150 RETURN
1160 CLS
1170 LOCATE13,11:PRINT"Sorry"
1180 LOCATE00,12:PRINT"The game must be over 800 bytes"
1190 LOCATE05,13:PRINT"Press space to restart"
1200 IFINKEY$<>" "THEN1200
1210 SCREEN0
1220 RETURN
1230 XX$="W":XW$="_"
1240 FORF=0TO4:XX$=XX$+XX$:XW$=XW$+XW$:NEXT
1250 RETURN
1260 YK=2
1270 LOCATE6,YA:?"            "
1280 LOCATE6,YA:LINEINPUTYD$
1290 IFYD$=""THENGOSUB1070:GOTO850
1300 LOCATE39,YA+1:PRINT
1310 FILESYD$
1320 CLS:SCREEN1:WIDTH32
1330 POKEYH+0,&H20:POKEYH+1,&H03:POKEYH+2,&H00:POKEYH+3,&H04:A=USR1(0)
1340 VPOKE6914,0:VPOKE6918,1:VPOKE6922,2:VPOKE6926,3:VPOKE6930,2
1350 LOCATE10,11:PRINT"INITIALIZING"
1360 LOCATE10,13:PRINT"    GAME    "
1370 OPENYD$AS#1LEN=1
1380 FIELD#1,1ASZJ$
1390 GET#1,3:ZI$=ZJ$:GET#1,2:ZH$=ZJ$:ZG=(ASC(ZI$)*256+ASC(ZH$))-65535!
1400 GET#1,5:ZI$=ZJ$:GET#1,4:ZH$=ZJ$:ZF=(ASC(ZI$)*256+ASC(ZH$))-65535!
1410 ZD=ZF-ZG-1
1420 ZE=0:ZC=800:ZB=8:ZS=-1
1430 ZA=ZE:YZ=16:YY=23:YX=32
1440 IFZD<800THENCLOSE:GOSUB1160:GOTO660
1450 LOCATE10,13:PRINT"   SHAPES   "
1460 LOCATE15,15:PRINT"06"
1470 FORF=0TO23:READA:VPOKE&H0008+F,A:NEXT:LOCATE15,15:PRINT"05"
1480 FORF=0TO7:READA:VPOKE&H0080+F,A:NEXT:LOCATE15,15:PRINT"04"
1490 FORF=0TO7:READA:VPOKE&H00F8+F,A:NEXT:LOCATE15,15:PRINT"03"
1500 FORF=0TO7:READA:VPOKE&H0720+F,A:NEXT:LOCATE15,15:PRINT"02"
1510 FORF=0TO23:READA:VPOKE&H0740+F,A:NEXT:LOCATE15,15:PRINT"01"
1520 FORF=0TO31:READA:VPOKE&H3800+F,A:NEXT:LOCATE15,15:PRINT"00"
1530 POKEYH+0,&H20:POKEYH+1,&H00:POKEYH+2,&H60:POKEYH+3,&H00:A=USR1(0)
1540 LOCATE10,13:PRINT"   COLORS   "
1550 GOSUB2470
1560 CLS
1570 LOCATE0,0:PRINT"  CHANGE GRAPH KIT WW "+LEFT$(YD$,8)
1580 LOCATE1,2:PRINT"X";LEFT$(XX$,2*10);"Y"
1590 LOCATE1,3:PRINT"VÄäîû®≤º∆–⁄V"
1600 LOCATE1,4:PRINT"VÅãïü©≥Ω«—€V"
1610 LOCATE1,5:PRINT"VÇåñ†™¥æ»“‹V"
1620 LOCATE1,6:PRINT"VÉçó°´µø…”›V"
1630 LOCATE1,7:PRINT"VÑéò¢¨∂¿ ‘ﬁV"
1640 LOCATE1,8:PRINT"VÖèô£≠∑¡À’ﬂV"
1650 LOCATE1,9:PRINT"VÜêö§Æ∏¬Ã÷‡V"
1660 LOCATE1,10:PRINT"Váëõ•Øπ√Õ◊·V"
1670 LOCATE1,11:PRINT"Vàíú¶∞∫ƒŒÿ‚V"
1680 LOCATE1,12:PRINT"Vâìùß±ª≈œŸ„V"
1690 LOCATE1,13:PRINT"Z";LEFT$(XX$,2*10);"["
1700 LOCATE3,15:PRINT"Srt# End#"
1710 LOCATE1,17:PRINT"C"
1720 LOCATE3,17:PRINTSTRING$(4-LEN(HEX$(ZA)),"0")+HEX$(ZA)
1730 LOCATE8,17:PRINTSTRING$(4-LEN(HEX$(ZA+(YX-1))),"0")+HEX$(ZA+(YX-1))
1740 LOCATE1,19:PRINT"R"
1750 LOCATE3,19:PRINTSTRING$(4-LEN(HEX$(ZE)),"0")+HEX$(ZE)
1760 LOCATE8,19:PRINTSTRING$(4-LEN(HEX$(ZE+799)),"0")+HEX$(ZE+799)
1770 LOCATE1,21:PRINT"G"
1780 LOCATE3,21:PRINTSTRING$(4-LEN(HEX$(0)),"0")+HEX$(0)
1790 LOCATE8,21:PRINTSTRING$(4-LEN(HEX$(ZD)),"0")+HEX$(ZD)
1800 LOCATE13,2:PRINT"X";LEFT$(XX$,2*16);"Y"
1810 LOCATE13,3:PRINT"VCursor Stp #   "+RIGHT$(STR$(ZB),1)+"V"
1820 LOCATE13,4:PRINT"VRegion Stp # "+RIGHT$(HEX$(ZC),3)+"V"
1830 LOCATE13,5:PRINT"Z";LEFT$(XX$,2*16);"["
1840 ONZPGOTO1930
1850 LOCATE13,7:PRINT"VÍVMove VËVEdit   "
1860 LOCATE13,9:PRINT"VÈVStep VDVSize   "
1870 LOCATE13,11:PRINT"VBVClearVRVRefresh"
1880 LOCATE13,13:PRINT"VTVScan und cursor "
1890 LOCATE13,15:PRINT"VFVFreeze/Unfreeze"
1900 LOCATE13,17:PRINT"VEVExplode/Ovrview"
1910 LOCATE13,19:PRINT"                  "
1920 GOTO2000
1930 LOCATE13,7:PRINT"VNVNew  VPVExit  "
1940 LOCATE13,9:PRINT"VQVPrev VWVNext   "
1950 LOCATE13,11:PRINT"VAVP 4x VSVN 4x   "
1960 LOCATE13,13:PRINT"VZVSrtVXVMidVCVEnd"
1970 LOCATE13,15:PRINT"VK LVCfg Save Load"
1980 LOCATE13,17:PRINT"V1-8VChange Colors"
1990 LOCATE13,19:PRINT"                  "
2000 LOCATE13,19:PRINT"      VMVMore Keys"
2010 LOCATE13,21:PRINT"ABBBBBBBBBBBBBBBBC"
2020 GOSUB3170
2030 IFZR=-1THENLOCATE2,13:PRINT"WOverviewW"
2040 XV=YY+(YX-2):XU=0
2050 IFYY+(YX-2)>101THENXU=8:XV=23+(YY+(YX-2))-103
2060 IFYZ+XU>95THENXV=200
2070 VPOKE6912,YY-1:VPOKE6913,YZ
2080 VPOKE6916,XV+1:VPOKE6917,XU+YZ
2090 XT=ZE/(ZD/141)+105
2100 VPOKE6920,167:VPOKE6921,XT
2110 VPOKE6928,167:VPOKE6929,XT+(141/(ZD/800))
2120 IFZQTHENZQ=0:GOSUB2970
2130 A$=INKEY$
2140 IFA$=CHR$(&H1C)AND(YZ+8<95)AND(ZA+YX-2+80<ZD)THENYZ=YZ+8:ZA=ZA+80:GOSUB2810
2150 IFA$=CHR$(&H1D)AND(YZ-8>15)THENYZ=YZ-8:ZA=ZA-80:GOSUB2810
2160 IFA$=CHR$(&H1E)AND(YY-ZB>22)THENYY=YY-ZB:ZA=ZA-ZB:GOSUB2810
2170 IFA$=CHR$(&H1F)AND(YY+ZB<103)AND(ZA+YX-2+ZB<ZD)THENYY=YY+ZB:ZA=ZA+ZB:GOSUB2810
2180 IFA$="1"THENZY=ZY-1:GOSUB2470
2190 IFA$="2"THENZY=ZY+1:GOSUB2470
2200 IFA$="3"THENZX=ZX-1:GOSUB2470
2210 IFA$="4"THENZX=ZX+1:GOSUB2470
2220 IFA$="5"THENZW=ZW-1:GOSUB2470
2230 IFA$="6"THENZW=ZW+1:GOSUB2470
2240 IFA$="7"THENZV=ZV-1:GOSUB2470
2250 IFA$="8"THENZV=ZV+1:GOSUB2470
2260 IFA$=CHR$(&H0D)GOTO3240
2270 IFA$="E"GOTO4310
2280 IFA$="D"THENGOSUB2890
2290 IFA$=" "THENGOSUB3200
2300 IFA$="R"THENXS=0:GOSUB3100
2310 IFA$="M"THENZP=ABS(ZP-1):GOTO1840
2320 IFA$="B"THENPOKEYH+0,&H20:POKEYH+1,&H03:POKEYH+2,&H00:POKEYH+3,&H04:A=USR1(0)
2330 IFA$="N"THENGOSUB5050:CLOSE:RESTORE5680:GOTO590
2340 IFA$="P"THENGOSUB5050:CLOSE:CLEAR:SCREEN0:WIDTH40:COLOR15,5,5:NEW
2350 IFA$="K"THENGOSUB2620
2360 IFA$="T"THENGOSUB2770
2370 IFA$="L"THENGOSUB2720:GOSUB2470
2380 IFA$="Q"THENXS=ZA-ZE:ZE=ZE-ZC:GOSUB2970
2390 IFA$="W"THENXS=ZA-ZE:ZE=ZE+ZC:GOSUB2970
2400 IFA$="A"THENXS=ZA-ZE:ZE=ZE-ZC*4:GOSUB2970
2410 IFA$="S"THENXS=ZA-ZE:ZE=ZE+ZC*4:GOSUB2970
2420 IFA$="Z"THENXS=ZA-ZE:ZE=&H00:GOSUB2970
2430 IFA$="X"THENXS=ZA-ZE:ZE=(ZD/2:GOSUB2970-400)
2440 IFA$="C"THENXS=ZA-ZE:ZE=ZD-799:GOSUB2970
2450 IFA$="F"THENXS=0:ZS=NOTZS:IFZSTHENGOSUB3170:ELSE:GOSUB3100
2460 GOTO2130
2470 ZY=FNZZ(ZY)
2480 ZX=FNZZ(ZX)
2490 ZW=FNZZ(ZW)
2500 ZV=FNZZ(ZV)
2510 ZU=FNZZ(ZU)
2520 ZT=FNZZ(ZT)
2530 COLORZX,ZY,ZY
2540 VPOKE8194,ZV*16+ZY
2550 VPOKE8195,ZV*16+ZY
2560 VPOKE8192,ZV*16+ZW
2570 VPOKE8193,ZW*16+ZY
2580 VPOKE6915,ZX:VPOKE6919,ZX
2590 VPOKE6923,ZX:VPOKE6927,ZX:VPOKE6931,ZX
2600 FORF=0TO12:VPOKE8208+F,ZW*16+ZY:NEXT
2610 RETURN
2620 X=12:Y=10:W=8:H=2:GOSUB5130
2630 POKEYH+0,ZN:POKEYH+1,ZM:POKEYH+2,ZL:POKEYH+3,ZK:A=USR2(0)
2640 LOCATE12,10:PRINT"X";LEFT$(XX$,2*6);"Y"
2650 LOCATE12,11:PRINT"VSAVINGV"
2660 LOCATE12,12:PRINT"Z";LEFT$(XX$,2*6);"[
2670 OPEN"CGKConf.cfg"FOROUTPUTAS#2
2680 PRINT#2,ZY,ZX,ZW,ZV,ZU,ZT
2690 CLOSE#2
2700 POKEYH+0,ZN:POKEYH+1,ZM:POKEYH+2,ZL:POKEYH+3,ZK:A=USR2(1)
2710 RETURN
2720 YK=4
2730 OPEN"CGKConf.cfg"FORINPUTAS#2
2740 INPUT#2,ZY,ZX,ZW,ZV,ZU,ZT
2750 CLOSE#2
2760 RETURN
2770 YV=ZA+(YX-1)'find formula to cap at gameLength to avoid next if
2780 IFYV>ZD-1THENYV=ZD-1
2790 FORI=ZATOYV:GET#1,I+1:VPOKE1024-ZE+I,VPEEK(1024-ZE+I)XOR255:A$=ZJ$:VPOKE1024-ZE+I,ASC(A$):NEXT
2800 RETURN
2810 XV=YY+(YX-2):XU=0
2820 IFYY+(YX-2)>101THENXU=8:XV=23+(YY+(YX-2))-103
2830 IFYZ+XU>95THENXV=200
2840 VPOKE6912,YY-1:VPOKE6913,YZ
2850 VPOKE6916,XV+1:VPOKE6917,YZ+XU
2860 LOCATE3,17:PRINTSTRING$(4-LEN(HEX$(ZA)),"0")+HEX$(ZA)
2870 LOCATE8,17:PRINTSTRING$(4-LEN(HEX$(ZA+(YX-1))),"0")+HEX$(ZA+(YX-1))
2880 RETURN
2890 IFYX=32THENYX=8ELSEIFZA+YX+22<ZDTHENYX=32ELSERETURN
2900 XV=YY+(YX-2):XU=0
2910 IFYY+(YX-2)>101THENXU=8:XV=23+(YY+(YX-2))-103
2920 IFYZ+XU>95THENXV=200
2930 VPOKE6916,XV+1:VPOKE6917,YZ+XU
2940 LOCATE3,17:PRINTSTRING$(4-LEN(HEX$(ZA)),"0")+HEX$(ZA)
2950 LOCATE8,17:PRINTSTRING$(4-LEN(HEX$(ZA+(YX-1))),"0")+HEX$(ZA+(YX-1))
2960 RETURN
2970 IFZE<0THENZE=0
2980 IFZE+799>ZDTHENZE=ZD-799
2990 ZA=ZE+XS
3000 XT=ZE/(ZD/141)+105
3010 VPOKE6920,167:VPOKE6921,XT
3020 VPOKE6928,167:VPOKE6929,XT+(141/(ZD/800))
3030 LOCATE3,17:PRINTSTRING$(4-LEN(HEX$(ZA)),"0")+HEX$(ZA)
3040 LOCATE8,17:PRINTSTRING$(4-LEN(HEX$(ZA+7)),"0")+HEX$(ZA+7)
3050 LOCATE3,19:PRINTSTRING$(4-LEN(HEX$(ZE)),"0")+HEX$(ZE)
3060 LOCATE8,19:PRINTSTRING$(4-LEN(HEX$(ZE+799)),"0")+HEX$(ZE+799)
3070 IFZA+YX>ZDTHENYZ=95-7:YY=103-YX:ZA=ZD-YX+1:GOSUB2810
3080 IFNOTZSTHENGOSUB3100
3090 RETURN
3100 ZR=0
3110 LOCATE2,2:PRINTLEFT$(XX$,2*3);"SCAN";LEFT$(XX$,2*3)
3120 LOCATE2,13:PRINT"WVÈVStopWW"
3130 FORF=ZETOZE+799
3140 VPOKE1024-ZE+F,VPEEK(1024-ZE+F)XOR255:GET#1,F+1:A$=ZJ$:VPOKE1024-ZE+F,ASC(A$):IFINKEY$=" "THENF=ZE+800ELSENEXT
3150 GOSUB3170
3160 RETURN
3170 IFZSTHENLOCATE2,2:PRINT"WWFREEZEWW"ELSELOCATE2,2:PRINTLEFT$(XX$,2*10)
3180 LOCATE2,13:PRINTLEFT$(XX$,2*10)
3190 RETURN
3200 ZB=(8+1)-ZB
3210 ZC=(800+400)-ZC
3220 LOCATE29,3:PRINTRIGHT$(HEX$(ZB),1):LOCATE27,4:PRINTRIGHT$(HEX$(ZC),3)
3230 RETURN
3240 CLS
3250 VPOKE6920,200:VPOKE6928,200
3260 POKEYH+0,&H20:POKEYH+1,&H00:POKEYH+2,&H40:POKEYH+3,&H00:A=USR1(0)
3270 LOCATE0,0:PRINT"  CHANGE GRAPH KIT WW "+LEFT$(YD$,8)
3280 LOCATE1,2:PRINT"X";LEFT$(XX$,2*10);"Y"
3290 LOCATE1,3:PRINT"VÄäîû®≤º∆–⁄V"
3300 LOCATE1,4:PRINT"VÅãïü©≥Ω«—€V"
3310 LOCATE1,5:PRINT"VÇåñ†™¥æ»“‹V"
3320 LOCATE1,6:PRINT"VÉçó°´µø…”›V"
3330 LOCATE1,7:PRINT"VÑéò¢¨∂¿ ‘ﬁV"
3340 LOCATE1,8:PRINT"VÖèô£≠∑¡À’ﬂV"
3350 LOCATE1,9:PRINT"VÜêö§Æ∏¬Ã÷‡V"
3360 LOCATE1,10:PRINT"Váëõ•Øπ√Õ◊·V"
3370 LOCATE1,11:PRINT"Vàíú¶∞∫ƒŒÿ‚V"
3380 LOCATE1,12:PRINT"Vâìùß±ª≈œŸ„V"
3390 LOCATE1,13:PRINT"Z";LEFT$(XX$,2*10);"["
3400 LOCATE1,14:PRINT"X";LEFT$(XX$,2*2);"R";LEFT$(XX$,2*4);"R";LEFT$(XX$,2*2);"Y"
3410 LOCATE1,15:PRINT"VHJV    VLNV"
3420 LOCATE1,16:PRINT"VIKV    VMOV"
3430 LOCATE1,17:PRINT"Z";LEFT$(XX$,2*2);"Q";LEFT$(XX$,2*4);"Q";LEFT$(XX$,2*2);"["
3440 LOCATE5,15:PRINTSTRING$(4-LEN(HEX$(ZA)),"0")+HEX$(ZA)
3450 LOCATE5,16:PRINTSTRING$(4-LEN(HEX$(ZA+(YX-1))),"0")+HEX$(ZA+(YX-1))
3460 LOCATE14,2:PRINTLEFT$(XW$,2*16)
3470 LOCATE14,3:PRINTLEFT$(XW$,2*16)
3480 LOCATE14,4:PRINTLEFT$(XW$,2*16)
3490 LOCATE14,5:PRINTLEFT$(XW$,2*16)
3500 LOCATE14,6:PRINTLEFT$(XW$,2*16)
3510 LOCATE14,7:PRINTLEFT$(XW$,2*16)
3520 LOCATE14,8:PRINTLEFT$(XW$,2*16)
3530 LOCATE14,9:PRINTLEFT$(XW$,2*16)
3540 LOCATE14,10:PRINTLEFT$(XW$,2*16)
3550 LOCATE14,11:PRINTLEFT$(XW$,2*16)
3560 LOCATE14,12:PRINTLEFT$(XW$,2*16)
3570 LOCATE14,13:PRINTLEFT$(XW$,2*16)
3580 LOCATE14,14:PRINTLEFT$(XW$,2*16)
3590 LOCATE14,15:PRINTLEFT$(XW$,2*16)
3600 LOCATE14,16:PRINTLEFT$(XW$,2*16)
3610 LOCATE14,17:PRINTLEFT$(XW$,2*16)
3620 VPOKE6924,15:VPOKE6925,112
3630 IFYGTHENZO=0
3640 ONZOGOTO3690
3650 LOCATE01,19:PRINT"VCVCpyVVVPst"
3660 LOCATE07,21:PRINT"V#VCor"
3670 IFNOTYGTHENLOCATE01,21:PRINT"VMVKys"
3680 GOTO3710
3690 LOCATE01,19:PRINT"VRVRotVTVHmv"
3700 LOCATE01,21:PRINT"VFVFlpVGVVmv"
3710 LOCATE13,19:PRINT"VEVErzVÈVTglVLVRld"
3720 LOCATE13,21:PRINT"VDVInvVSVSavVËVBck"
3730 IFXR>=0THENXR=0:XQ=0:XP=0:GOSUB3980
3740 XR=0
3750 A$=INKEY$
3760 IFA$=CHR$(&H1C)ANDXQ<YWTHENXQ=XQ+1:VPOKE6925,112+(XQ*8)
3770 IFA$=CHR$(&H1D)ANDXQ>0THENXQ=XQ-1:VPOKE6925,112+(XQ*8)
3780 IFA$=CHR$(&H1E)ANDXP>0THENXP=XP-1:VPOKE6924,15+(XP*8)
3790 IFA$=CHR$(&H1F)ANDXP<YWTHENXP=XP+1:VPOKE6924,15+(XP*8)
3800 IFA$="E"THENXR=2:GOSUB3980
3810 IFA$="D"THENXR=1:GOSUB3980
3820 IFA$="R"THENXR=3:GOSUB3980
3830 IFA$="F"THENXR=4:GOSUB3980
3840 IFA$="T"THENXR=5:GOSUB3980
3850 IFA$="G"THENXR=6:GOSUB3980
3860 IFA$="C"THENFORF=0TOYU-1:VPOKE&H0060+F,VPEEK(&H0040+F):NEXT
3870 IFA$="V"THENFORF=0TOYU-1:VPOKE&H0040+F,VPEEK(&H0060+F):NEXT:POKEYH+0,YS:POKEYH+1,YT:A=USR3(0)
3880 IFA$=" "THENGOSUB4140
3890 IFA$="S"THENGOSUB4200
3900 IFA$="L"THENXR=0:GOSUB3980
3910 IFA$="M"THENZO=ABS(ZO-1):XR=-1:GOTO3630
3920 IFA$="1"THENZU=ZU-1:GOSUB4100
3930 IFA$="2"THENZU=ZU+1:GOSUB4100
3940 IFA$="3"THENZT=ZT-1:GOSUB4100
3950 IFA$="4"THENZT=ZT+1:GOSUB4100
3960 IFA$=CHR$(&H0D)THENVPOKE6924,200:GOTO1560
3970 GOTO3750
3980 YV=ZA+(YX-1)'find formula to cap at gameLength to avoid next if
3990 IFYV>ZD-1THENYV=ZD-1
4000 IFYX=8THENYW=7:YU=8:YT=8:YS=1:ELSEYW=15:YU=32:YT=16:YS=2
4010 IFXR=1THENPOKEYH+0,YU:A=USR0(0)
4020 IFXR=2THENPOKEYH+0,YU:POKEYH+1,&H00:POKEYH+2,&H40:POKEYH+3,&H00:A=USR1(0)
4030 IFXR=3ANDNOTYGTHENPOKEYH+0,YU:A=USR5(0)
4040 IFXR=4ANDNOTYGTHENPOKEYH+0,YU:A=USR4(0)
4050 IFXR=5ANDNOTYGTHENPOKEYH+0,YU:A=USR6(1)
4060 IFXR=6ANDNOTYGTHENPOKEYH+0,YU:A=USR6(0)
4070 IFXR=0THENFORI=ZATOYV:GET#1,I+1:VPOKE1024-ZE+I,VPEEK(1024-ZE+I)XOR255:A$=ZJ$:VPOKE&H0040+I-ZA,ASC(A$):VPOKE1024-ZE+I,ASC(A$):NEXT
4080 POKEYH+0,YS:POKEYH+1,YT:A=USR3(0)
4090 RETURN
4100 ZU=FNZZ(ZU)
4110 ZT=FNZZ(ZT)
4120 VPOKE8193,ZU*16+ZT
4130 RETURN
4140 XO=VPEEK((XQ+14)+(XP+2)*32+6144)
4150 XO=(228+16)-XO
4160 VPOKE(XQ+14)+(XP+2)*32+6144,XO
4170 XN=XP:IFXQ>7THENXN=XP+16
4180 VPOKE&H0040+XN,2^(7-(XQMOD8))XORVPEEK(&H0040+XN)
4190 RETURN
4200 YV=ZA+(YX-1)'find formula to cap at gameLength to avoid next if
4210 IFYV>ZD-1THENYV=ZD-1
4220 FORI=ZATOYV
4230 XM=1024-ZE+I
4240 XL=VPEEK(&H0040+I-ZA)
4250 VPOKEXM,VPEEK(XM)XOR255
4260 A$=CHR$(XL)
4270 LSETZJ$=A$:PUT#1,I
4280 VPOKEXM,XL
4290 NEXT
4300 RETURN
4310 CLS
4320 LOCATE0,0:PRINT"  CHANGE GRAPH KIT WW "+LEFT$(YD$,8)
4330 LOCATE1,2:PRINT"X";LEFT$(XX$,2*19);"Y"
4340 LOCATE1,3:PRINT"VÄ ä î û ® ≤ º ∆ – ⁄V"
4350 LOCATE1,4:PRINT"V                   V"
4360 LOCATE1,5:PRINT"VÅ ã ï ü © ≥ Ω « — €V"
4370 LOCATE1,6:PRINT"V                   V"
4380 LOCATE1,7:PRINT"VÇ å ñ † ™ ¥ æ » “ ‹V"
4390 LOCATE1,8:PRINT"V                   V"
4400 LOCATE1,9:PRINT"VÉ ç ó ° ´ µ ø … ” ›V"
4410 LOCATE1,10:PRINT"V                   V"
4420 LOCATE1,11:PRINT"VÑ é ò ¢ ¨ ∂ ¿   ‘ ﬁV"
4430 LOCATE1,12:PRINT"V                   V"
4440 LOCATE1,13:PRINT"VÖ è ô £ ≠ ∑ ¡ À ’ ﬂV"
4450 LOCATE1,14:PRINT"V                   V"
4460 LOCATE1,15:PRINT"VÜ ê ö § Æ ∏ ¬ Ã ÷ ‡V"
4470 LOCATE1,16:PRINT"V                   V"
4480 LOCATE1,17:PRINT"Vá ë õ • Ø π √ Õ ◊ ·V"
4490 LOCATE1,18:PRINT"V                   V"
4500 LOCATE1,19:PRINT"Và í ú ¶ ∞ ∫ ƒ Œ ÿ ‚V"
4510 LOCATE1,20:PRINT"V                   V"
4520 LOCATE1,21:PRINT"Vâ ì ù ß ± ª ≈ œ Ÿ „V"
4530 LOCATE1,22:PRINT"Z";LEFT$(XX$,2*19);"["
4540 LOCATE23,03:PRINT"VOV Ovrw"
4550 LOCATE23,21:PRINT"VEV Back"
4560 VPOKE6912,200:VPOKE6916,200
4570 VPOKE6920,200:VPOKE6928,200
4580 IFZRTHENGOSUB4930
4590 A$=INKEY$
4600 IFA$="O"THENGOSUB4750
4610 IFA$=CHR$(&H1C)ANDYR<9ANDZRTHENYR=YR+1:GOSUB4680
4620 IFA$=CHR$(&H1D)ANDYR>0ANDZRTHENYR=YR-1:GOSUB4680
4630 IFA$=CHR$(&H1E)ANDYQ>0ANDZRTHENYQ=YQ-1:GOSUB4680
4640 IFA$=CHR$(&H1F)ANDYQ<9ANDZRTHENYQ=YQ+1:GOSUB4680
4650 IFA$=CHR$(&H0D)ANDZRTHENZE=(YQ*YO)+(YR*(YO*10)):ZQ=-1:ZA=ZE:YZ=16:YY=23:IFZE+799>ZDTHENZE=ZD-799:YZ=16:YY=23:ZA=ZE:GOTO1560ELSEGOTO1560
4660 IFA$="E"GOTO1560
4670 GOTO4590
4680 VPOKE6912,(YQ+1)*16+6:VPOKE6913,(YR+1)*16
4690 VPOKE6916,(YQ+1)*16+14:VPOKE6917,(YR+1)*16
4700 YM=(YQ*YO)+(YR*(YO*10))
4710 IFYM+799>ZDTHENYM=ZD-799
4720 LOCATE27,13:PRINTSTRING$(4-LEN(HEX$(YM)),"0")+HEX$(YM)
4730 LOCATE27,15:PRINTSTRING$(4-LEN(HEX$(YM+799)),"0")+HEX$(YM+799)
4740 RETURN
4750 YP=0
4760 ZR=-1
4770 YO=(ZD/100)
4780 YN=(9*YO)+(9*(YO*10))+8
4790 LOCATE2,2:PRINTLEFT$(XX$,2*7);"SCAN";LEFT$(XX$,2*8)
4800 LOCATE2,22:PRINTLEFT$(XX$,2*5);"VÈVStop";LEFT$(XX$,2*7)
4810 FORF=1TOYNSTEPYO
4820 FORI=FTOF+7
4830 VPOKE1024+YP,VPEEK(1024+YP)XOR255
4840 GET#1,I+1
4850 A$=ZJ$
4860 VPOKE1024+YP,ASC(A$)
4870 YP=YP+1
4880 IFINKEY$=" "THENF=YN+1:I=F+8
4890 NEXT
4900 NEXT
4910 GOSUB4930
4920 RETURN
4930 VPOKE6912,(YQ+1)*16+6:VPOKE6913,(YR+1)*16
4940 VPOKE6916,(YQ+1)*16+14:VPOKE6917,(YR+1)*16
4950 LOCATE23,05:PRINT"VÍV Move"
4960 LOCATE23,07:PRINT"VËV Go"
4970 LOCATE23,11:PRINT"Region"
4980 YM=(YQ*YO)+(YR*(YO*10))
4990 IFYM+799>ZDTHENYM=ZD-799
5000 LOCATE23,13:PRINT"St# "+STRING$(4-LEN(HEX$(YM)),"0")+HEX$(YM)
5010 LOCATE23,15:PRINT"Ed# "+STRING$(4-LEN(HEX$(YM+799)),"0")+HEX$(YM+799)
5020 LOCATE02,2:PRINTLEFT$(XX$,2*19)
5030 LOCATE2,22:PRINTLEFT$(XX$,2*19)
5040 RETURN
5050 X=5:Y=10:W=21:H=2:GOSUB5130
5060 POKEYH+0,ZN:POKEYH+1,ZM:POKEYH+2,ZL:POKEYH+3,ZK:A=USR2(0)
5070 LOCATE5,10:PRINT"X";LEFT$(XX$,2*19);"Y"
5080 LOCATE5,11:PRINT"VAre you sure? (Y/N)V"
5090 LOCATE5,12:PRINT"Z";LEFT$(XX$,2*19);"[
5100 A$=INKEY$:IFA$<>"Y"ANDA$<>"N"THEN5100
5110 IFA$="N"THENPOKEYH+0,ZN:POKEYH+1,ZM:POKEYH+2,ZL:POKEYH+3,ZK:A=USR2(1):RETURN2130
5120 RETURN
5130 S=&H1800
5140 ZN=FNYF(X,Y,S):ZM=FNYE(X,Y,S)
5150 ZL=W+1:ZK=H+1
5160 IFYGTHENS=0:ZL=FNYF(W,H,S):ZK=FNYE(W,H,S)
5170 RETURN
5180 ' Error Handling Routines
5190 IFERR=53ANDYK=2GOTO5390
5200 IFERR=56ANDYK=2GOTO5390
5210 IFERR=55ANDYK=4THENYK=0:YJ=0:YI$="CONFIG FILE CORRUPTED":RESUME2750:ONERRORGOTO0
5220 IFERR=53ANDYK=4THENYK=0:YJ=0:YI$="CONFIG FILE NOT FOUND":RESUME2750:ONERRORGOTO0
5230 IFERR=53ANDYK=3THENYK=0:RESUME450:ONERRORGOTO0
5240 IF(ERR=53ANDYK=1)ORERR=70GOTO5320
5250 XK=ERR:IFXK>25THENXK=XK-24
5260 LOCATE0,21
5270 FORF=YL(XK)TOYL(XK+1):PRINTCHR$(PEEK(&H3D75+F));:NEXT
5280 PRINT" at";ERL;"(";ERR;") "
5290 CLOSE
5300 LOCATE0,22
5310 END
5320 PRINT:PRINT"No files found"
5330 PRINT:PRINT"Press space to restart"
5340 IFINKEY$<>" "THEN5340
5350 YK=0
5360 CLS
5370 RESUME660
5380 ONERRORGOTO0
5390 PRINT:PRINT
5400 IFERR=53THENPRINTYD$;" not found"
5410 IFERR=56THENPRINT"Invalid name"
5420 PRINT:PRINT"Press space to restart"
5430 IFINKEY$<>" "THEN5430
5440 YK=0
5450 RESUME660
5460 ONERRORGOTO0
5470 ' Error Messages in ROM
5480 DATA0,13,26,43,52,66,75,89,110,132,147
5490 DATA164,178,192,210,223,239,253,271,287
5500 DATA304,311,328,344,359,371,383,396,410
5510 DATA429,444,459,475,501,520,531
5520 DATA0,17,30,51,63,85,94,108,130,153,173
5530 DATA190,205,219,239,255,282,297,321,338
5540 DATA351,361,382,400,416,437,452,467,483
5550 DATA498,516,531
5560 ' ML Routines at 0xd000. ASM Source on GitHub
5570 DATA00,00,00,00,00,00,00,00,c3,14,da,c3,27,da,c3,35
5580 DATAda,c3,5a,da,3a,00,da,47,21,40,00,cd,4a,00,ee,ff
5590 DATAcd,4d,00,23,10,f5,c9,3a,f8,f7,ed,4b,00,da,2a,02
5600 DATAda,cd,56,00,c9,3a,f8,f7,fe,00,ca,4c,da,ed,4b,02
5610 DATAda,ed,5b,00,da,21,93,da,cd,5c,00,c9,ed,4b,02,da
5620 DATA11,93,da,2a,00,da,cd,59,00,c9,11,40,00,21,4e,18
5630 DATA3a,00,da,47,c5,3a,01,da,47,c5,eb,cd,4a,00,eb,06
5640 DATA08,17,f5,38,1a,3e,10,cd,4d,00,f1,23,10,f3,13,d5
5650 DATA11,18,00,19,d1,c1,10,e1,21,56,18,c1,10,d6,c9,3e
5660 DATAe4,18,e4
5670 ' Character Shapes
5680 DATA255,128,128,128,128,128,128,255
5690 DATA255,0,0,0,0,0,0,255
5700 DATA255,1,1,1,1,1,1,255
5710 DATA255,129,129,129,129,129,129,255
5720 DATA255,255,255,255,255,255,255,255
5730 DATA0,126,126,126,126,126,126,0
5740 DATA4,4,36,100,252,96,32,0
5750 DATA0,0,219,154,82,211,0,0
5760 DATA231,195,165,24,24,165,195,231
5770 ' Sprite Shapes
5780 DATA255,129,0,0,0,0,0,0
5790 DATA129,255,0,0,0,0,0,0
5800 DATA0,128,128,128,128,128,128,0
5810 DATA255,129,129,129,129,129,129,255
5820 ' Functions Not Used
5830 ' Create Character Block
5840 C=127
5850 FORX=2TO11
5860 FORY=3TO12
5870 C=C+1:LOCATEX,Y:PRINT:PRINTCHR$(C)
5880 NEXT
5890 NEXT
5900 END
5910 ' Character Map
5920 FORI=0TO255
5930 X=IMOD32:Y=I\32
5940 C=I
5950 IFC<32ORC=127THENC=32
5960 LOCATEX,Y:PRINTCHR$(C)
5970 LOCATEX,Y+10:PRINTCHR$(1)+CHR$(C)
5980 NEXT
5990 END
