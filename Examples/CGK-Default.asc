10 ' Converted with MSX Basic Dignified
20 ' https://github.com/farique1/msx-basic-dignified
30 ' CHANGE GRAPH KIT
40 ' v1.6.1
50 ' Edit uncompressed graphics on MSX binary files on disk
60 '
70 ' Copyright (C) 1984-2020 - Fred Rique (farique)
80 ' https://github.com/farique1/Change-Graph-Kit
90 '
100 ' New
110 '   Fixed error lookup in machines with English language (or in MSX2?)
120 '   Improved error reporting routine to output to the new MSX Badig Build Monitor Execution
130 '   Improved ON STOP routine and added MSX Badig Build Monitor Execution reporting
140 '   Adjusted background and border colors on quit to 4 instead of 5
150 '
160 CLEAR 200,&HDA00
170 DEFINT A-Z:MAXFILES=2
180 ON STOP GOSUB 5720:STOP ON
190 ON ERROR GOTO 5600
200 DIM YL(36)
210 YK=0
220 YJ=-1
230 YI$=""
240 ZY=1:ZX=15:ZW=2:ZV=6:ZU=2:ZT=1
250 SCREEN 0:COLOR ZX,ZY,ZY:WIDTH 40:KEY OFF
260 LOCATE 14,11:PRINT "INITIALIZING"
270 LOCATE 14,13:PRINT " MAKING STR "
280 GOSUB 1280
290 LOCATE 14,13:PRINT " ERROR MSGS "
300 ' Using the time format in ROM to determine language
310 IF (PEEK(&H2B) AND 112)=32 THEN RESTORE 5950 ELSE RESTORE 6000
320 FOR F=1 TO 36:READ A:YL(F)=A:NEXT
330 LOCATE 14,13:PRINT "LOADING CONF"
340 GOSUB 2880
350 LOCATE 14,13:PRINT " ML SUPPORT "
360 YH=&HDA00
370 YK=3
380 BLOAD "CGKTools.com"
390 YG=0
400 RESTORE 6180
410 GOTO 480
420 ' {ml_fallback}
430 LOCATE 8,8:PRINT " CGKTools.bin not found"
440 LOCATE 8,9:PRINT "Using internal fall back"
450 RESTORE 6060
460 FOR F=0 TO 146:READ A$:LOCATE 18,15:PRINT 147-F:POKE YH+F,VAL("&h"+A$):NEXT:LOCATE 18,15:PRINT "   "
470 YG=-1
480 ' {ml_setup}
490 DEFUSR0=YH+&H08 ' invert_VRAM 		v0=len
500 DEFUSR1=YH+&H0B ' fill_VRAM 		v0-v1=len v2-v3=srt usr(ptrn)
510 DEFUSR2=YH+&H0E ' copy_VRAM 		v0-v1=VRAM v2=width v3=height usr(direc)
520 DEFUSR3=YH+&H11 ' populate_edit 	v0=col_len v1=lin_len
530 DEFUSR4=YH+&H14 ' flip_VRAM		 	v0=len
540 DEFUSR5=YH+&H17 ' rotate_VRAM	 	v0=len
550 DEFUSR6=YH+&H1A ' slide_VRAM	 	v0=len usr(direc)
560 DEF FN YF(X,Y,S)=(X+S+(Y*32)) MOD 256
570 DEF FN YE(X,Y,S)=INT((X+S+(Y*32))/256)
580 ' {start}
590 SCREEN 0:WIDTH 40
600 DEF FN ZZ(X)=ABS(X MOD 16+16) MOD 16
610 ZS=0:ZR=0:ZQ=0:ZP=0
620 YD$="" ' leave blank to enable file request
630 YC$=".bin" ' leave blank to all
640 IF YC$="" THEN YC$=".*"
650 IF YD$<>"" THEN GOTO 1400
660 ' {insert_disk}
670 CLS
680 YK=1
690 LOCATE 14,8:PRINT "Insert disk"
700 LOCATE 11,10:PRINT "and press any key"
710 IF NOT YJ THEN LOCATE 9,18:PRINT YI$
720 IF INKEY$=""THEN720
730 YJ=-1
740 YI$=""
750 CLS
760 FILES "*"+YC$
770 PRINT:PRINT
780 PRINT ":Load":PRINT ":ARROWS choose:ENTER select:SPACE type";
790 FOR F=0 TO 24
800 YB=0+40*F
810 IF CHR$(VPEEK(YB))=":" THEN YA=F-1
820 NEXT
830 X=12:Y=0
840 YB=X+40*Y
850 GOSUB 1100
860 ' {keys}
870 A$=INKEY$
880 LOCATE X,Y:PRINT "{"
890 LOCATE X,Y:PRINT "<"
900 IF A$="" THEN 860
910 LOCATE X,Y:PRINT " "
920 PX=X:PY=Y
930 IF A$=CHR$(&H1C) THEN X=X+13:GOSUB 1020
940 IF A$=CHR$(&H1D) THEN X=X-13:GOSUB 1020
950 IF A$=CHR$(&H1E) THEN Y=Y-1:GOSUB 1020
960 IF A$=CHR$(&H1F) THEN Y=Y+1:GOSUB 1020
970 IF A$=CHR$(&H0D) THEN 1370
980 IF A$=" " THEN 1320
990 LOCATE X,Y:PRINT "<"
1000 GOSUB 1100
1010 GOTO 860
1020 ' {move_cursor_files}
1030 IF X>=39 THEN X=12
1040 IF X<=0 THEN X=38
1050 IF Y<=0 THEN Y=0
1060 IF Y>=24 THEN Y=24
1070 YB=X+40*Y
1080 IF VPEEK(YB-12)=32 THEN X=PX:Y=PY:YB=X+40*Y
1090 RETURN
1100 ' {show_content}
1110 XZ=0:YD$="":XY$=""
1120 LOCATE 6,YA:PRINT "            "
1130 FOR F=YB-12 TO YB-1
1140 XY$=CHR$(VPEEK(F))
1150 YD$=YD$+XY$
1160 LOCATE 6+XZ,YA:PRINT XY$
1170 XZ=XZ+1
1180 NEXT
1190 RETURN
1200 ' {game_small}
1210 CLS
1220 LOCATE 13,11:PRINT "Sorry"
1230 LOCATE 00,12:PRINT "The game must be over 800 bytes"
1240 LOCATE 05,13:PRINT "Press space to restart"
1250 IF INKEY$<>" "THEN1250
1260 SCREEN 0
1270 RETURN
1280 ' {createStrings}
1290 XX$="W":XW$="_"
1300 FOR F=0 TO 4:XX$=XX$+XX$:XW$=XW$+XW$:NEXT
1310 RETURN
1320 ' {type_name}
1330 YK=2
1340 LOCATE 6,YA:? "            "
1350 LOCATE 6,YA:LINE INPUT YD$
1360 IF YD$="" THEN GOSUB 1100:GOTO 860
1370 ' {continue}
1380 LOCATE 39,YA+1:PRINT
1390 FILES YD$
1400 ' {inicializacao}
1410 CLS:SCREEN 1:WIDTH 32
1420 POKE YH+0,&H20:POKE YH+1,&H03:POKE YH+2,&H00:POKE YH+3,&H04:A=USR1(0)
1430 VPOKE 6914,0:VPOKE 6918,1:VPOKE 6922,2:VPOKE 6926,3:VPOKE 6930,2
1440 LOCATE 10,11:PRINT "INITIALIZING"
1450 LOCATE 10,13:PRINT "    GAME    "
1460 OPEN YD$ AS #1 LEN=1
1470 FIELD #1,1 AS ZJ$
1480 GET #1,3:ZI$=ZJ$:GET #1,2:ZH$=ZJ$:ZG=(ASC(ZI$)*256+ASC(ZH$))-65535!
1490 GET #1,5:ZI$=ZJ$:GET #1,4:ZH$=ZJ$:ZF=(ASC(ZI$)*256+ASC(ZH$))-65535!
1500 ZD=ZF-ZG-1
1510 ZE=0:ZC=800:ZB=8:ZS=-1
1520 ZA=ZE:YZ=16:YY=23:YX=32
1530 IF ZD<800 THEN CLOSE:GOSUB 1200:GOTO 660
1540 LOCATE 10,13:PRINT "   SHAPES   "
1550 LOCATE 15,15:PRINT "06"
1560 FOR F=0 TO 23:READ A:VPOKE &H0008+F,A:NEXT:LOCATE 15,15:PRINT "05"
1570 FOR F=0 TO 7:READ A:VPOKE &H0080+F,A:NEXT:LOCATE 15,15:PRINT "04"
1580 FOR F=0 TO 7:READ A:VPOKE &H00F8+F,A:NEXT:LOCATE 15,15:PRINT "03"
1590 FOR F=0 TO 7:READ A:VPOKE &H0720+F,A:NEXT:LOCATE 15,15:PRINT "02"
1600 FOR F=0 TO 23:READ A:VPOKE &H0740+F,A:NEXT:LOCATE 15,15:PRINT "01"
1610 FOR F=0 TO 31:READ A:VPOKE &H3800+F,A:NEXT:LOCATE 15,15:PRINT "00"
1620 POKE YH+0,&H20:POKE YH+1,&H00:POKE YH+2,&H60:POKE YH+3,&H00:A=USR1(0)
1630 LOCATE 10,13:PRINT "   COLORS   "
1640 GOSUB 2610
1650 ' {search_screen}
1660 CLS
1670 LOCATE 0,0:PRINT "  CHANGE GRAPH KIT WW "+LEFT$(YD$,8)
1680 LOCATE 1,2:PRINT "X";LEFT$(XX$,2*10);"Y"
1690 LOCATE 1,3:PRINT "VÄäîû®≤º∆–⁄V"
1700 LOCATE 1,4:PRINT "VÅãïü©≥Ω«—€V"
1710 LOCATE 1,5:PRINT "VÇåñ†™¥æ»“‹V"
1720 LOCATE 1,6:PRINT "VÉçó°´µø…”›V"
1730 LOCATE 1,7:PRINT "VÑéò¢¨∂¿ ‘ﬁV"
1740 LOCATE 1,8:PRINT "VÖèô£≠∑¡À’ﬂV"
1750 LOCATE 1,9:PRINT "VÜêö§Æ∏¬Ã÷‡V"
1760 LOCATE 1,10:PRINT "Váëõ•Øπ√Õ◊·V"
1770 LOCATE 1,11:PRINT "Vàíú¶∞∫ƒŒÿ‚V"
1780 LOCATE 1,12:PRINT "Vâìùß±ª≈œŸ„V"
1790 LOCATE 1,13:PRINT "Z";LEFT$(XX$,2*10);"["
1800 LOCATE 3,15:PRINT "Srt# End#"
1810 LOCATE 1,17:PRINT "C"
1820 LOCATE 3,17:PRINT STRING$(4-LEN(HEX$(ZA)),"0")+HEX$(ZA)
1830 LOCATE 8,17:PRINT STRING$(4-LEN(HEX$(ZA+( YX-1))),"0")+HEX$(ZA+( YX-1))
1840 LOCATE 1,19:PRINT "R"
1850 LOCATE 3,19:PRINT STRING$(4-LEN(HEX$(ZE)),"0")+HEX$(ZE)
1860 LOCATE 8,19:PRINT STRING$(4-LEN(HEX$(ZE+799)),"0")+HEX$(ZE+799)
1870 LOCATE 1,21:PRINT "G"
1880 LOCATE 3,21:PRINT STRING$(4-LEN(HEX$(0)),"0")+HEX$(0)
1890 LOCATE 8,21:PRINT STRING$(4-LEN(HEX$(ZD)),"0")+HEX$(ZD)
1900 LOCATE 13,2:PRINT "X";LEFT$(XX$,2*16);"Y"
1910 LOCATE 13,3:PRINT "VCursor Stp #   "+RIGHT$(STR$(ZB),1)+"V"
1920 LOCATE 13,4:PRINT "VRegion Stp # "+RIGHT$(HEX$(ZC),3)+"V"
1930 LOCATE 13,5:PRINT "Z";LEFT$(XX$,2*16);"["
1940 ' {keys_page_start}
1950 ON ZP GOTO 2040
1960 LOCATE 13,7:PRINT "VÍVMove VËVEdit   "
1970 LOCATE 13,9:PRINT "VÈVStep VDVSize   "
1980 LOCATE 13,11:PRINT "VBVClearVRVRefresh"
1990 LOCATE 13,13:PRINT "VTVScan und cursor "
2000 LOCATE 13,15:PRINT "VFVFreeze/Unfreeze"
2010 LOCATE 13,17:PRINT "VEVExplode/Ovrview"
2020 LOCATE 13,19:PRINT "                  "
2030 GOTO 2120
2040 ' {keys_page_2}
2050 LOCATE 13,7:PRINT "VNVNew  VPVExit  "
2060 LOCATE 13,9:PRINT "VQVPrev VWVNext   "
2070 LOCATE 13,11:PRINT "VAVP 4x VSVN 4x   "
2080 LOCATE 13,13:PRINT "VZVSrtVXVMidVCVEnd"
2090 LOCATE 13,15:PRINT "VK LVCfg Save Load"
2100 LOCATE 13,17:PRINT "V1-8VChange Colors"
2110 LOCATE 13,19:PRINT "                  "
2120 ' {keys_page_end}
2130 LOCATE 13,19:PRINT "      VMVMore Keys"
2140 LOCATE 13,21:PRINT "ABBBBBBBBBBBBBBBBC"
2150 GOSUB 3400
2160 IF ZR=-1 THEN LOCATE 2,13:PRINT "WOverviewW"
2170 XV=YY+(YX-2):XU=0
2180 IF YY+(YX-2)>101 THEN XU=8:XV=23+(YY+(YX-2))-103
2190 IF YZ+XU>95 THEN XV=200
2200 VPOKE 6912,YY-1:VPOKE 6913,YZ
2210 VPOKE 6916,XV+1:VPOKE 6917,XU+YZ
2220 XT=ZE/(ZD/141)+105
2230 VPOKE 6920,167:VPOKE 6921,XT
2240 VPOKE 6928,167:VPOKE 6929,XT+(141/(ZD/800))
2250 IF ZQ THEN ZQ=0:GOSUB 3180
2260 ' {read_keyboard_main}
2270 A$=INKEY$
2280 IF A$=CHR$(&H1C) AND (YZ+8<95) AND (ZA+YX-2+80<ZD) THEN YZ=YZ+8:ZA=ZA+80:GOSUB 3000
2290 IF A$=CHR$(&H1D) AND (YZ-8>15) THEN YZ=YZ-8:ZA=ZA-80:GOSUB 3000
2300 IF A$=CHR$(&H1E) AND (YY-ZB>22) THEN YY=YY-ZB:ZA=ZA-ZB:GOSUB 3000
2310 IF A$=CHR$(&H1F) AND (YY+ZB<103) AND (ZA+YX-2+ZB<ZD) THEN YY=YY+ZB:ZA=ZA+ZB:GOSUB 3000
2320 IF A$="1" THEN ZY=ZY-1:GOSUB 2610
2330 IF A$="2" THEN ZY=ZY+1:GOSUB 2610
2340 IF A$="3" THEN ZX=ZX-1:GOSUB 2610
2350 IF A$="4" THEN ZX=ZX+1:GOSUB 2610
2360 IF A$="5" THEN ZW=ZW-1:GOSUB 2610
2370 IF A$="6" THEN ZW=ZW+1:GOSUB 2610
2380 IF A$="7" THEN ZV=ZV-1:GOSUB 2610
2390 IF A$="8" THEN ZV=ZV+1:GOSUB 2610
2400 IF A$=CHR$(&H0D) THEN GOTO 3490
2410 IF A$="E" THEN GOTO 4650
2420 IF A$="D" THEN GOSUB 3090
2430 IF A$=" " THEN GOSUB 3440
2440 IF A$="R" THEN XS=0:GOSUB 3320
2450 IF A$="M" THEN ZP=ABS(ZP-1):GOTO 1940
2460 IF A$="B" THEN POKE YH+0,&H20:POKE YH+1,&H03:POKE YH+2,&H00:POKE YH+3,&H04:A=USR1(0)
2470 IF A$="N" THEN GOSUB 5440:CLOSE:RESTORE 6180:GOTO 580
2480 IF A$="P" THEN GOSUB 5440:CLOSE:CLEAR:SCREEN 0:WIDTH 40:COLOR 15,4,4:NEW
2490 IF A$="K" THEN GOSUB 2770
2500 IF A$="T" THEN GOSUB 2950
2510 IF A$="L" THEN GOSUB 2880:GOSUB 2610
2520 IF A$="Q" THEN XS=ZA-ZE:ZE=ZE-ZC:GOSUB 3180
2530 IF A$="W" THEN XS=ZA-ZE:ZE=ZE+ZC:GOSUB 3180
2540 IF A$="A" THEN XS=ZA-ZE:ZE=ZE-ZC*4:GOSUB 3180
2550 IF A$="S" THEN XS=ZA-ZE:ZE=ZE+ZC*4:GOSUB 3180
2560 IF A$="Z" THEN XS=ZA-ZE:ZE=&H00:GOSUB 3180
2570 IF A$="X" THEN XS=ZA-ZE:ZE=(ZD/2:GOSUB 3180-400)
2580 IF A$="C" THEN XS=ZA-ZE:ZE=ZD-799:GOSUB 3180
2590 IF A$="F" THEN XS=0:ZS=NOT ZS:IF ZS THEN GOSUB 3400:ELSE:GOSUB 3320
2600 GOTO 2260
2610 ' {set_color}
2620 ZY=FN ZZ(ZY)
2630 ZX=FN ZZ(ZX)
2640 ZW=FN ZZ(ZW)
2650 ZV=FN ZZ(ZV)
2660 ZU=FN ZZ(ZU)
2670 ZT=FN ZZ(ZT)
2680 COLOR ZX,ZY,ZY
2690 VPOKE 8194,ZV*16+ZY
2700 VPOKE 8195,ZV*16+ZY
2710 VPOKE 8192,ZV*16+ZW
2720 VPOKE 8193,ZW*16+ZY
2730 VPOKE 6915,ZX:VPOKE 6919,ZX
2740 VPOKE 6923,ZX:VPOKE 6927,ZX:VPOKE 6931,ZX
2750 FOR F=0 TO 12:VPOKE 8208+F,ZW*16+ZY:NEXT
2760 RETURN
2770 ' {save_config}
2780 X=12:Y=10:W=8:H=2:GOSUB 5530
2790 POKE YH+0,ZN:POKE YH+1,ZM:POKE YH+2,ZL:POKE YH+3,ZK:A=USR2(0)
2800 LOCATE 12,10:PRINT "X";LEFT$(XX$,2*6);"Y"
2810 LOCATE 12,11:PRINT "VSAVINGV"
2820 LOCATE 12,12:PRINT "Z";LEFT$(XX$,2*6);"[
2830 OPEN "CGKConf.cfg" FOR OUTPUT AS #2
2840 PRINT #2,ZY,ZX,ZW,ZV,ZU,ZT
2850 CLOSE #2
2860 POKE YH+0,ZN:POKE YH+1,ZM:POKE YH+2,ZL:POKE YH+3,ZK:A=USR2(1)
2870 RETURN
2880 ' {load_config}
2890 YK=4
2900 OPEN "CGKConf.cfg" FOR INPUT AS #2
2910 INPUT #2,ZY,ZX,ZW,ZV,ZU,ZT
2920 ' {config_failed}
2930 CLOSE #2
2940 RETURN
2950 ' {refresh_cursor_area}
2960 YV=ZA+(YX-1) 'find formula to cap at gameLength to avoid next if
2970 IF YV>ZD-1 THEN YV=ZD-1
2980 FOR I=ZA TO YV:GET #1,I+1:VPOKE 1024-ZE+I,VPEEK(1024-ZE+I) XOR 255:A$=ZJ$:VPOKE 1024-ZE+I,ASC(A$):NEXT
2990 RETURN
3000 ' {move_scan_sprite}
3010 XV=YY+( YX-2):XU=0
3020 IF YY+( YX-2)>101 THEN XU=8:XV=23+(YY+( YX-2))-103
3030 IF YZ+XU>95 THEN XV=200
3040 VPOKE 6912,YY-1:VPOKE 6913,YZ
3050 VPOKE 6916,XV+1:VPOKE 6917,YZ+XU
3060 LOCATE 3,17:PRINT STRING$(4-LEN(HEX$(ZA)),"0")+HEX$(ZA)
3070 LOCATE 8,17:PRINT STRING$(4-LEN(HEX$(ZA+( YX-1))),"0")+HEX$(ZA+( YX-1))
3080 RETURN
3090 ' {change_sprite_size}
3100 IF YX=32 THEN YX=8 ELSE IF ZA+YX+22<ZD THEN YX=32 ELSE RETURN
3110 XV=YY+(YX-2):XU=0
3120 IF YY+(YX-2)>101 THEN XU=8:XV=23+(YY+(YX-2))-103
3130 IF YZ+XU>95 THEN XV=200
3140 VPOKE 6916,XV+1:VPOKE 6917,YZ+XU
3150 LOCATE 3,17:PRINT STRING$(4-LEN(HEX$(ZA)),"0")+HEX$(ZA)
3160 LOCATE 8,17:PRINT STRING$(4-LEN(HEX$(ZA+( YX-1))),"0")+HEX$(ZA+( YX-1))
3170 RETURN
3180 ' {update_memory_position}
3190 IF ZE<0 THEN ZE=0
3200 IF ZE+799>ZD THEN ZE=ZD-799
3210 ZA=ZE+XS
3220 XT=ZE/(ZD/141)+105
3230 VPOKE 6920,167:VPOKE 6921,XT
3240 VPOKE 6928,167:VPOKE 6929,XT+(141/(ZD/800))
3250 LOCATE 3,17:PRINT STRING$(4-LEN(HEX$(ZA)),"0")+HEX$(ZA)
3260 LOCATE 8,17:PRINT STRING$(4-LEN(HEX$(ZA+7)),"0")+HEX$(ZA+7)
3270 LOCATE 3,19:PRINT STRING$(4-LEN(HEX$(ZE)),"0")+HEX$(ZE)
3280 LOCATE 8,19:PRINT STRING$(4-LEN(HEX$(ZE+799)),"0")+HEX$(ZE+799)
3290 IF ZA+YX>ZD THEN YZ=95-7:YY=103-YX:ZA=ZD-YX+1:GOSUB 3000
3300 IF NOT ZS THEN GOSUB 3320
3310 RETURN
3320 ' {scan}
3330 ZR=0
3340 LOCATE 2,2:PRINT LEFT$(XX$,2*3);"SCAN";LEFT$(XX$,2*3)
3350 LOCATE 2,13:PRINT "WVÈVStopWW"
3360 FOR F=ZE TO ZE+799
3370 VPOKE 1024-ZE+F,VPEEK(1024-ZE+F) XOR 255:GET #1,F+1:A$=ZJ$:VPOKE 1024-ZE+F,ASC(A$):IF INKEY$=" " THEN F=ZE+800 ELSE NEXT
3380 GOSUB 3400
3390 RETURN
3400 ' {end_scan}
3410 IF ZS THEN LOCATE 2,2:PRINT "WWFREEZEWW" ELSE LOCATE 2,2:PRINT LEFT$(XX$,2*10)
3420 LOCATE 2,13:PRINT LEFT$(XX$,2*10)
3430 RETURN
3440 ' {change_movement_step}
3450 ZB=( 8+1)-ZB
3460 ZC=(800+400)-ZC
3470 LOCATE 29,3:PRINT RIGHT$(HEX$(ZB),1):LOCATE 27,4:PRINT RIGHT$(HEX$(ZC),3)
3480 RETURN
3490 ' {edit_screen}
3500 CLS
3510 VPOKE 6920,200:VPOKE 6928,200
3520 POKE YH+0,&H20:POKE YH+1,&H00:POKE YH+2,&H40:POKE YH+3,&H00:A=USR1(0)
3530 LOCATE 0,0:PRINT "  CHANGE GRAPH KIT WW "+LEFT$(YD$,8)
3540 LOCATE 1,2:PRINT "X";LEFT$(XX$,2*10);"Y"
3550 LOCATE 1,3:PRINT "VÄäîû®≤º∆–⁄V"
3560 LOCATE 1,4:PRINT "VÅãïü©≥Ω«—€V"
3570 LOCATE 1,5:PRINT "VÇåñ†™¥æ»“‹V"
3580 LOCATE 1,6:PRINT "VÉçó°´µø…”›V"
3590 LOCATE 1,7:PRINT "VÑéò¢¨∂¿ ‘ﬁV"
3600 LOCATE 1,8:PRINT "VÖèô£≠∑¡À’ﬂV"
3610 LOCATE 1,9:PRINT "VÜêö§Æ∏¬Ã÷‡V"
3620 LOCATE 1,10:PRINT "Váëõ•Øπ√Õ◊·V"
3630 LOCATE 1,11:PRINT "Vàíú¶∞∫ƒŒÿ‚V"
3640 LOCATE 1,12:PRINT "Vâìùß±ª≈œŸ„V"
3650 LOCATE 1,13:PRINT "Z";LEFT$(XX$,2*10);"["
3660 LOCATE 1,14:PRINT "X";LEFT$(XX$,2*2);"R";LEFT$(XX$,2*4);"R";LEFT$(XX$,2*2);"Y"
3670 LOCATE 1,15:PRINT "VHJV    VLNV"
3680 LOCATE 1,16:PRINT "VIKV    VMOV"
3690 LOCATE 1,17:PRINT "Z";LEFT$(XX$,2*2);"Q";LEFT$(XX$,2*4);"Q";LEFT$(XX$,2*2);"["
3700 LOCATE 5,15:PRINT STRING$(4-LEN(HEX$(ZA)),"0")+HEX$(ZA)
3710 LOCATE 5,16:PRINT STRING$(4-LEN(HEX$(ZA+( YX-1))),"0")+HEX$(ZA+( YX-1))
3720 LOCATE 14,2:PRINT LEFT$(XW$,2*16)
3730 LOCATE 14,3:PRINT LEFT$(XW$,2*16)
3740 LOCATE 14,4:PRINT LEFT$(XW$,2*16)
3750 LOCATE 14,5:PRINT LEFT$(XW$,2*16)
3760 LOCATE 14,6:PRINT LEFT$(XW$,2*16)
3770 LOCATE 14,7:PRINT LEFT$(XW$,2*16)
3780 LOCATE 14,8:PRINT LEFT$(XW$,2*16)
3790 LOCATE 14,9:PRINT LEFT$(XW$,2*16)
3800 LOCATE 14,10:PRINT LEFT$(XW$,2*16)
3810 LOCATE 14,11:PRINT LEFT$(XW$,2*16)
3820 LOCATE 14,12:PRINT LEFT$(XW$,2*16)
3830 LOCATE 14,13:PRINT LEFT$(XW$,2*16)
3840 LOCATE 14,14:PRINT LEFT$(XW$,2*16)
3850 LOCATE 14,15:PRINT LEFT$(XW$,2*16)
3860 LOCATE 14,16:PRINT LEFT$(XW$,2*16)
3870 LOCATE 14,17:PRINT LEFT$(XW$,2*16)
3880 VPOKE 6924,15:VPOKE 6925,112
3890 ' {keys_edit_start}
3900 IF YG THEN ZO=0
3910 ON ZO GOTO 3960
3920 LOCATE 01,19:PRINT "VCVCpyVVVPst"
3930 LOCATE 07,21:PRINT "V#VCor"
3940 IF NOT YG THEN LOCATE 01,21:PRINT "VMVKys"
3950 GOTO 3990
3960 ' {keys_edit_2}
3970 LOCATE 01,19:PRINT "VRVRotVTVHmv"
3980 LOCATE 01,21:PRINT "VFVFlpVGVVmv"
3990 ' {keys_edit_end}
4000 LOCATE 13,19:PRINT "VEVErzVÈVTglVLVRld"
4010 LOCATE 13,21:PRINT "VDVInvVSVSavVËVBck"
4020 IF XR>=0 THEN XR=0:XQ=0:XP=0:GOSUB 4280
4030 XR=0
4040 ' {read_keyboard_edit}
4050 A$=INKEY$
4060 IF A$=CHR$(&H1C) AND XQ<YW THEN XQ=XQ+1:VPOKE 6925,112+(XQ*8)
4070 IF A$=CHR$(&H1D) AND XQ>0 THEN XQ=XQ-1:VPOKE 6925,112+(XQ*8)
4080 IF A$=CHR$(&H1E) AND XP>0 THEN XP=XP-1:VPOKE 6924,15+(XP*8)
4090 IF A$=CHR$(&H1F) AND XP<YW THEN XP=XP+1:VPOKE 6924,15+(XP*8)
4100 IF A$="E" THEN XR=2:GOSUB 4280
4110 IF A$="D" THEN XR=1:GOSUB 4280
4120 IF A$="R" THEN XR=3:GOSUB 4280
4130 IF A$="F" THEN XR=4:GOSUB 4280
4140 IF A$="T" THEN XR=5:GOSUB 4280
4150 IF A$="G" THEN XR=6:GOSUB 4280
4160 IF A$="C" THEN FOR F=0 TO YU-1:VPOKE &H0060+F,VPEEK(&H0040+F):NEXT
4170 IF A$="V" THEN FOR F=0 TO YU-1:VPOKE &H0040+F,VPEEK(&H0060+F):NEXT:POKE YH+0,YS:POKE YH+1,YT:A=USR3(0)
4180 IF A$=" " THEN GOSUB 4460
4190 IF A$="S" THEN GOSUB 4530
4200 IF A$="L" THEN XR=0:GOSUB 4280
4210 IF A$="M" THEN ZO=ABS(ZO-1):XR=-1:GOTO 3890
4220 IF A$="1" THEN ZU=ZU-1:GOSUB 4410
4230 IF A$="2" THEN ZU=ZU+1:GOSUB 4410
4240 IF A$="3" THEN ZT=ZT-1:GOSUB 4410
4250 IF A$="4" THEN ZT=ZT+1:GOSUB 4410
4260 IF A$=CHR$(&H0D) THEN VPOKE 6924,200:GOTO 1650
4270 GOTO 4040
4280 ' {fill_edit_area}
4290 YV=ZA+(YX-1) 'find formula to cap at gameLength to avoid next if
4300 IF YV>ZD-1 THEN YV=ZD-1
4310 IF YX=8 THEN YW=7:YU=8:YT=8:YS=1:ELSE YW=15:YU=32:YT=16:YS=2
4320 IF XR=1 THEN POKE YH+0,YU:A=USR0(0)
4330 IF XR=2 THEN POKE YH+0,YU:POKE YH+1,&H00:POKE YH+2,&H40:POKE YH+3,&H00:A=USR1(0)
4340 IF XR=3 AND NOT YG THEN POKE YH+0,YU:A=USR5(0)
4350 IF XR=4 AND NOT YG THEN POKE YH+0,YU:A=USR4(0)
4360 IF XR=5 AND NOT YG THEN POKE YH+0,YU:A=USR6(1)
4370 IF XR=6 AND NOT YG THEN POKE YH+0,YU:A=USR6(0)
4380 IF XR=0 THEN FOR I=ZA TO YV:GET #1,I+1:VPOKE 1024-ZE+I,VPEEK(1024-ZE+I) XOR 255:A$=ZJ$:VPOKE &H0040+I-ZA,ASC(A$):VPOKE 1024-ZE+I,ASC(A$):NEXT
4390 POKE YH+0,YS:POKE YH+1,YT:A=USR3(0)
4400 RETURN
4410 ' {set_minipreview_color}
4420 ZU=FN ZZ(ZU)
4430 ZT=FN ZZ(ZT)
4440 VPOKE 8193,ZU*16+ZT
4450 RETURN
4460 ' {change_bit}
4470 XO=VPEEK ((XQ+14)+(XP+2)*32+6144)
4480 XO=(228+16)-XO
4490 VPOKE (XQ+14)+(XP+2)*32+6144,XO
4500 XN=XP:IF XQ>7 THEN XN=XP+16
4510 VPOKE &H0040+XN,2^(7-(XQ MOD 8)) XOR VPEEK(&H0040+XN)
4520 RETURN
4530 ' {save_drawing}
4540 YV=ZA+(YX-1) 'find formula to cap at gameLength to avoid next if
4550 IF YV>ZD-1 THEN YV=ZD-1
4560 FOR I=ZA TO YV
4570 XM=1024-ZE+I
4580 XL=VPEEK(&H0040+I-ZA)
4590 VPOKE XM,VPEEK(XM) XOR 255
4600 A$=CHR$(XL)
4610 LSET ZJ$=A$:PUT #1,I
4620 VPOKE XM,XL
4630 NEXT
4640 RETURN
4650 ' {explode_screen}
4660 CLS
4670 LOCATE 0,0:PRINT "  CHANGE GRAPH KIT WW "+LEFT$(YD$,8)
4680 LOCATE 1,2:PRINT "X";LEFT$(XX$,2*19);"Y"
4690 LOCATE 1,3:PRINT "VÄ ä î û ® ≤ º ∆ – ⁄V"
4700 LOCATE 1,4:PRINT "V                   V"
4710 LOCATE 1,5:PRINT "VÅ ã ï ü © ≥ Ω « — €V"
4720 LOCATE 1,6:PRINT "V                   V"
4730 LOCATE 1,7:PRINT "VÇ å ñ † ™ ¥ æ » “ ‹V"
4740 LOCATE 1,8:PRINT "V                   V"
4750 LOCATE 1,9:PRINT "VÉ ç ó ° ´ µ ø … ” ›V"
4760 LOCATE 1,10:PRINT "V                   V"
4770 LOCATE 1,11:PRINT "VÑ é ò ¢ ¨ ∂ ¿   ‘ ﬁV"
4780 LOCATE 1,12:PRINT "V                   V"
4790 LOCATE 1,13:PRINT "VÖ è ô £ ≠ ∑ ¡ À ’ ﬂV"
4800 LOCATE 1,14:PRINT "V                   V"
4810 LOCATE 1,15:PRINT "VÜ ê ö § Æ ∏ ¬ Ã ÷ ‡V"
4820 LOCATE 1,16:PRINT "V                   V"
4830 LOCATE 1,17:PRINT "Vá ë õ • Ø π √ Õ ◊ ·V"
4840 LOCATE 1,18:PRINT "V                   V"
4850 LOCATE 1,19:PRINT "Và í ú ¶ ∞ ∫ ƒ Œ ÿ ‚V"
4860 LOCATE 1,20:PRINT "V                   V"
4870 LOCATE 1,21:PRINT "Vâ ì ù ß ± ª ≈ œ Ÿ „V"
4880 LOCATE 1,22:PRINT "Z";LEFT$(XX$,2*19);"["
4890 LOCATE 23,03:PRINT "VOV Ovrw"
4900 LOCATE 23,21:PRINT "VEV Back"
4910 VPOKE 6912,200:VPOKE 6916,200
4920 VPOKE 6920,200:VPOKE 6928,200
4930 IF ZR THEN GOSUB 5310
4940 ' {explode_keys}
4950 A$=INKEY$
4960 IF A$="O" THEN GOSUB 5120
4970 IF A$=CHR$(&H1C) AND YR<9 AND ZR THEN YR=YR+1:GOSUB 5040
4980 IF A$=CHR$(&H1D) AND YR>0 AND ZR THEN YR=YR-1:GOSUB 5040
4990 IF A$=CHR$(&H1E) AND YQ>0 AND ZR THEN YQ=YQ-1:GOSUB 5040
5000 IF A$=CHR$(&H1F) AND YQ<9 AND ZR THEN YQ=YQ+1:GOSUB 5040
5010 IF A$=CHR$(&H0D) AND ZR THEN ZE=(YQ*YO)+(YR*(YO*10)):ZQ=-1:ZA=ZE:YZ=16:YY=23:IF ZE+799>ZD THEN ZE=ZD-799:YZ=16:YY=23:ZA=ZE:GOTO 1650 ELSE GOTO 1650
5020 IF A$="E" THEN GOTO 1650
5030 GOTO 4940
5040 ' {move_overview_sprite}
5050 VPOKE 6912,(YQ+1)*16+6:VPOKE 6913,(YR+1)*16
5060 VPOKE 6916,(YQ+1)*16+14:VPOKE 6917,(YR+1)*16
5070 YM=(YQ*YO)+(YR*(YO*10))
5080 IF YM+799>ZD THEN YM=ZD-799
5090 LOCATE 27,13:PRINT STRING$(4-LEN(HEX$(YM)),"0")+HEX$(YM)
5100 LOCATE 27,15:PRINT STRING$(4-LEN(HEX$(YM+799)),"0")+HEX$(YM+799)
5110 RETURN
5120 ' {overview}
5130 YP=0
5140 ZR=-1
5150 YO=(ZD/100)
5160 YN=(9*YO)+(9*(YO*10))+8
5170 LOCATE 2,2:PRINT LEFT$(XX$,2*7);"SCAN";LEFT$(XX$,2*8)
5180 LOCATE 2,22:PRINT LEFT$(XX$,2*5);"VÈVStop";LEFT$(XX$,2*7)
5190 FOR F=1 TO YN STEP YO
5200 FOR I=F TO F+7
5210 VPOKE 1024+YP,VPEEK(1024+YP) XOR 255
5220 GET #1,I+1
5230 A$=ZJ$
5240 VPOKE 1024+YP,ASC(A$)
5250 YP=YP+1
5260 IF INKEY$=" " THEN F=YN+1:I=F+8
5270 NEXT
5280 NEXT
5290 GOSUB 5310
5300 RETURN
5310 ' {end_overview}
5320 VPOKE 6912,(YQ+1)*16+6:VPOKE 6913,(YR+1)*16
5330 VPOKE 6916,(YQ+1)*16+14:VPOKE 6917,(YR+1)*16
5340 LOCATE 23,05:PRINT "VÍV Move"
5350 LOCATE 23,07:PRINT "VËV Go"
5360 LOCATE 23,11:PRINT "Region"
5370 YM=(YQ*YO)+(YR*(YO*10))
5380 IF YM+799>ZD THEN YM=ZD-799
5390 LOCATE 23,13:PRINT "St# "+STRING$(4-LEN(HEX$(YM)),"0")+HEX$(YM)
5400 LOCATE 23,15:PRINT "Ed# "+STRING$(4-LEN(HEX$(YM+799)),"0")+HEX$(YM+799)
5410 LOCATE 02,2:PRINT LEFT$(XX$,2*19)
5420 LOCATE 2,22:PRINT LEFT$(XX$,2*19)
5430 RETURN
5440 ' {window_requester}
5450 X=5:Y=10:W=21:H=2:GOSUB 5530
5460 POKE YH+0,ZN:POKE YH+1,ZM:POKE YH+2,ZL:POKE YH+3,ZK:A=USR2(0)
5470 LOCATE 5,10:PRINT "X";LEFT$(XX$,2*19);"Y"
5480 LOCATE 5,11:PRINT "VAre you sure? (Y/N)V"
5490 LOCATE 5,12:PRINT "Z";LEFT$(XX$,2*19);"[
5500 A$=INKEY$:IF A$<>"Y" AND A$<>"N" THEN 5500
5510 IF A$="N" THEN POKE YH+0,ZN:POKE YH+1,ZM:POKE YH+2,ZL:POKE YH+3,ZK:A=USR2(1):RETURN 2260
5520 RETURN
5530 ' {vram_conversion}
5540 S=&H1800
5550 ZN=FN YF(X,Y,S):ZM=FN YE(X,Y,S)
5560 ZL=W+1:ZK=H+1
5570 IF YG THEN S=0:ZL=FN YF(W,H,S):ZK=FN YE(W,H,S)
5580 RETURN
5590 ' Error Handling Routines
5600 ' {error}
5610 IF ERR=53 AND YK=2 THEN GOTO 5860
5620 IF ERR=56 AND YK=2 THEN GOTO 5860
5630 IF ERR=55 AND YK=4 THEN YK=0:YJ=0:YI$="CONFIG FILE CORRUPTED":RESUME 2920
5640 IF ERR=53 AND YK=4 THEN YK=0:YJ=0:YI$="CONFIG FILE NOT FOUND":RESUME 2920
5650 IF ERR=53 AND YK=3 THEN YK=0:RESUME 420
5660 IF (ERR=53 AND YK=1) OR ERR=70 THEN GOTO 5790
5670 XK=ERR:IF XK>25 THEN XK=XK-24
5680 LOCATE 0,20:PRINTCHR$(&H0D)
5690 FOR F=YL(XK)+1 TO YL(XK+1)-1:PRINT CHR$(PEEK(&H3D75+F));
5700 NEXT
5710 PRINT " (";RIGHT$(STR$(ERR),LEN(STR$(ERR))-1);") at";ERL;CHR$(&H07)
5720 ' {stopped}
5730 CLOSE
5740 STOP OFF
5750 ON ERROR GOTO 0
5760 LOCATE 0,20:PRINTCHR$(&H0D)
5770 PRINT "Break";CHR$(&H07)
5780 END
5790 ' {file_not_found}
5800 PRINT:PRINT "No files found"
5810 PRINT:PRINT "Press space to restart"
5820 IF INKEY$<>" "THEN5820
5830 YK=0
5840 CLS
5850 RESUME 660
5860 ' {bad_file_name}
5870 PRINT:PRINT
5880 IF ERR=53 THEN PRINT YD$;" not found"
5890 IF ERR=56 THEN PRINT "Invalid name"
5900 PRINT:PRINT "Press space to restart"
5910 IF INKEY$<>" "THEN5910
5920 YK=0
5930 RESUME 660
5940 ' Error Messages in ROM
5950 ' {portuguese_ROM}
5960 DATA 0,13,26,43,52,66,75,89,110,132,147
5970 DATA 164,178,192,210,223,239,253,271,287
5980 DATA 304,311,328,344,359,371,383,396,410
5990 DATA 429,444,459,475,501,520,531
6000 ' {english_ROM}
6010 DATA 0,17,30,51,63,85,94,108,130,153,173
6020 DATA 190,205,219,239,255,282,297,321,338
6030 DATA 351,361,382,400,416,437,452,467,483
6040 DATA 498,516,531,545,570,590,604
6050 ' ML Routines at 0xd000. ASM Source on GitHub
6060 ' {ml_routines}
6070 DATA 00,00,00,00,00,00,00,00,c3,14,da,c3,27,da,c3,35
6080 DATA da,c3,5a,da,3a,00,da,47,21,40,00,cd,4a,00,ee,ff
6090 DATA cd,4d,00,23,10,f5,c9,3a,f8,f7,ed,4b,00,da,2a,02
6100 DATA da,cd,56,00,c9,3a,f8,f7,fe,00,ca,4c,da,ed,4b,02
6110 DATA da,ed,5b,00,da,21,93,da,cd,5c,00,c9,ed,4b,02,da
6120 DATA 11,93,da,2a,00,da,cd,59,00,c9,11,40,00,21,4e,18
6130 DATA 3a,00,da,47,c5,3a,01,da,47,c5,eb,cd,4a,00,eb,06
6140 DATA 08,17,f5,38,1a,3e,10,cd,4d,00,f1,23,10,f3,13,d5
6150 DATA 11,18,00,19,d1,c1,10,e1,21,56,18,c1,10,d6,c9,3e
6160 DATA e4,18,e4
6170 ' Character Shapes
6180 ' {character_shapes}
6190 DATA 255,128,128,128,128,128,128,255
6200 DATA 255,0,0,0,0,0,0,255
6210 DATA 255,1,1,1,1,1,1,255
6220 DATA 255,129,129,129,129,129,129,255
6230 DATA 255,255,255,255,255,255,255,255
6240 DATA 0,126,126,126,126,126,126,0
6250 DATA 4,4,36,100,252,96,32,0
6260 DATA 0,0,219,154,82,211,0,0
6270 DATA 231,195,165,24,24,165,195,231
6280 ' Sprite Shapes
6290 DATA 255,129,0,0,0,0,0,0
6300 DATA 129,255,0,0,0,0,0,0
6310 DATA 0,128,128,128,128,128,128,0
6320 DATA 255,129,129,129,129,129,129,255
6330 ' Functions Not Used
6340 ' Create Character Block
6350 C=127
6360 FOR X=2 TO 11
6370 FOR Y=3 TO 12
6380 C=C+1:LOCATE X,Y:PRINT:PRINT CHR$(C)
6390 NEXT
6400 NEXT
6410 END
6420 ' Character Map
6430 FOR I=0 TO 255
6440 X=I MOD 32:Y=I\32
6450 C=I
6460 IF C<32 OR C=127 THEN C=32
6470 LOCATE X,Y:PRINT CHR$(C)
6480 LOCATE X,Y+10:PRINT CHR$(1)+CHR$(C)
6490 NEXT
6500 END
